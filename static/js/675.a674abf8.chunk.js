(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[675],{9114:(e,t,o)=>{"use strict";o.d(t,{Z:()=>te});var n=o(2791),i=o(6934),r=o(697),a=o(5228),l=o(5193),s=o(3896),c=o(890),d=o(6084),u=o(6314),h=o(3967),p=o(8096),x=o(9321),m=o(5022),g=o(4454),v=o(9055),f=o(9955),b=o(1889),y=o(1918),j=o(3746),S=o(184);const Z="Display All Series",w=48,C=8;function k(e){const{items:t,selectorID:o,allowMultiple:i,onSeriesSelection:r}=e,a=(0,h.Z)(),l={PaperProps:{style:{maxHeight:5.55*w+C,overflow:"visible !important",background:a.palette.customAlternateBackground}},anchorOrigin:{vertical:-6,horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"},getContentAnchorEl:null},[s,d]=(0,n.useState)(t),[k,T]=(0,n.useState)(i);(0,n.useEffect)((()=>{d(t)}),[t]),(0,n.useEffect)((()=>{T(s.every((e=>e.selected)))}),[s]);const A=e=>{const{target:{value:t}}=e;if(t.includes(Z)){const e=s.map(((e,t)=>({...e,selected:0==t||!k})));r(e),T(!k)}else{const e=s.filter((e=>t.includes(e.label))),o=s.map((t=>({...t,selected:e.some((e=>e.label===t.label))})));r(o),T(!1)}},D=e=>{const t=s.map((t=>t.label===e.label?{...t,selected:!t.selected}:t));r(t)};return(0,S.jsxs)(u.Z,{spacing:1,direction:"row",alignItems:"center",children:[(0,S.jsx)(p.Z,{sx:{[a.breakpoints.down("sm")]:{width:"100%"},minWidth:"200px","& .MuiInputBase-root":{mt:1,borderRadius:a.spacing(1)}},size:"small",children:(0,S.jsxs)(x.Z,{labelId:"".concat(o,"-label"),id:o,multiple:i,value:s.filter((e=>e.selected)).map((e=>e.label)),onChange:A,MenuProps:l,renderValue:e=>(e=>(0,S.jsxs)(u.Z,{direction:"row",alignItems:"center",spacing:.5,children:[(0,S.jsx)(j.Z,{fontSize:"1.5rem",sx:{color:a.palette.text.secondary}}),(0,S.jsx)(c.Z,{variant:"caption",color:"text.secondary",children:i?"".concat(e.length," series displayed").concat(k?" (all)":""):e})]}))(e),sx:{fontSize:"0.75em"},children:[s.map((e=>(0,S.jsxs)(m.Z,{disabled:!(1!==s.filter((e=>e.selected)).length||!e.selected),value:e.label,sx:{backgroundColor:"unset !important","&:hover":{backgroundColor:"inherit !important"}},children:[i?(0,S.jsx)(g.Z,{checked:e.selected,onClick:()=>D(e),sx:{p:.25,transform:"scale(0.8)"}}):(0,S.jsx)(v.Z,{checked:e.selected,onChange:()=>A(e),sx:{p:.25,transform:"scale(0.8)"}}),(0,S.jsx)(c.Z,{variant:"caption",children:e.label})]},e.label))),i&&(0,S.jsx)(m.Z,{value:Z,sx:{borderTop:"solid 0.5px",borderColor:a.palette.text.secondary,position:"sticky",bottom:0,zIndex:99999,marginBottom:a.spacing(-1),background:a.palette.customAlternateBackground,"&:hover":{background:a.palette.customAlternateBackground}},children:(0,S.jsxs)(u.Z,{direction:"row",width:"100%",alignItems:"center",justifyContent:"space-between",children:[(0,S.jsx)(c.Z,{fontWeight:500,variant:"caption",sx:{pl:1},children:Z}),(0,S.jsx)(f.Z,{checked:k,onClick:()=>D(Z),sx:{transform:"scale(0.8)"}})]})},Z)]})}),i&&(0,S.jsx)(b.ZP,{container:!0,spacing:1,sx:{[a.breakpoints.down("sm")]:{display:"none"}},children:s.filter((e=>e.selected)).map((e=>(0,S.jsx)(b.ZP,{item:!0,children:(0,S.jsx)(y.Z,{label:(0,S.jsx)(c.Z,{variant:"caption",children:e.label}),size:"small",...1!==s.filter((e=>e.selected)).length&&{onDelete:()=>D(e)}})},e.label)))})]})}const T={CategoryFilter:{position:"top",stackDirection:"column"},DateRangeFilter:{position:"bottom",stackDirection:"column-reverse"},ChartRangeFilter:{position:"bottom",stackDirection:"column-reverse"},NumberRangeFilter:{position:"top",stackDirection:"column"}},A=e=>({min:e.reduce(((e,t)=>t<e?t:e)),max:e.reduce(((e,t)=>t>e?t:e))}),D=e=>({min:Math.min(...e),max:Math.max(...e)}),I=()=>Math.random().toString(36).substr(2,9),P={stem:{length:0},textStyle:{opacity:0},boxStyle:null},z=e=>{let{isPortrait:t,isSmaller:o}=e;return o?t?6:8:t?8:10},E=e=>{var t,o,n,i,r,a,l,s,c,d,u,h,p,x,m,g,v,f,b,y,j,S,Z,w,C,k,T,A,D,I,E,M,_,R,O,W,F,L,N,B,Q;const{chartData:U,subchartIndex:H,isPortrait:q,isHomepage:V,theme:G}=e,Y={italic:!1,bold:!0,color:G.palette.chart.axisTitle,fontSize:z({isPortrait:q})},$={color:G.palette.chart.axisText,fontSize:z({isPortrait:q})};let X=null!==(t=U.subcharts)&&void 0!==t&&t[H].options?{...U.subcharts[H].options}:{};if(X={...X,...U.options,theme:"material",curveType:X.curveType||(null===(o=U.options)||void 0===o?void 0:o.curveType)||"function",crosshair:{orientation:"both",trigger:"focus",opacity:.5},backgroundColor:{fill:"transparent"},chartArea:{...null===(n=U.options)||void 0===n?void 0:n.chartArea,width:q?(null===(i=U.options)||void 0===i||null===(r=i.chartArea)||void 0===r||null===(a=r.width)||void 0===a?void 0:a.portrait)||"80%":(null===(l=U.options)||void 0===l||null===(s=l.chartArea)||void 0===s||null===(c=s.width)||void 0===c?void 0:c.landscape)||"75%",height:q?(null===(d=U.options)||void 0===d||null===(u=d.chartArea)||void 0===u||null===(h=u.height)||void 0===h?void 0:h.portrait)||"60%":(null===(p=U.options)||void 0===p||null===(x=p.chartArea)||void 0===x||null===(m=x.height)||void 0===m?void 0:m.landscape)||"70%"},width:q?(null===(g=U.options)||void 0===g||null===(v=g.width)||void 0===v?void 0:v.portrait)||"100%":(null===(f=U.options)||void 0===f||null===(b=f.width)||void 0===b?void 0:b.landscape)||"100%",height:U.height||"100%",tooltip:{isHtml:!0,showColorCode:!1},legend:{alignment:q?"center":"start",position:null!==(y=null===(j=U.options)||void 0===j||null===(S=j.legend)||void 0===S?void 0:S.position)&&void 0!==y?y:q?"top":"right",scrollArrows:{activeColor:G.palette.chart.axisTitle,inactiveColor:G.palette.text.secondary},pagingTextStyle:{fontSize:10,color:G.palette.chart.axisTitle,bold:!0}}},X.vAxis={...X.vAxis,format:null!==(Z=null===(w=X.vAxis)||void 0===w?void 0:w.format)&&void 0!==Z?Z:"decimal",title:null!==(C=null===(k=X.vAxis)||void 0===k?void 0:k.title)&&void 0!==C?C:"",viewWindow:{min:null!==(T=null===(A=X.vAxis)||void 0===A||null===(D=A.viewWindow)||void 0===D?void 0:D.min)&&void 0!==T?T:0}},X.hAxis={...X.hAxis,title:null!==(I=null===(E=X.hAxis)||void 0===E?void 0:E.title)&&void 0!==I?I:""},q&&(X.hAxis={...X.hAxis,slantedText:!0,slantedTextAngle:30}),"string"!==typeof X.colors&&X.colors||(X.colors=G.palette.chart.optionsColors[X.colors||"multiColor"]),X.series&&Object.values(X.series).forEach((e=>{const t=e;"default"===t.color&&(t.color=G.palette.primary.main)})),X.trendlines&&X.trendlines.forEach((e=>{e.color=G.palette.primary.main})),X.colorAxis)switch(X.colorAxis.colors){case"matchingColor":X.colorAxis.colors=[G.palette.chart.colorAxisFirstColor,G.palette.chart.optionsColors.multiColor[X.colorAxis.colorIndex]];break;case"default":X.colorAxis.colors=[G.palette.chart.colorAxisFirstColor,G.palette.NYUpurple];break;case"aqi":X.colorAxis=G.palette.chart.aqiColorAxis}return X.vAxis={...X.vAxis,titleTextStyle:Y,textStyle:$,gridlines:{...null===(M=X.vAxis)||void 0===M?void 0:M.gridlines,color:(null===(_=X.vAxis)||void 0===_||null===(R=_.gridlines)||void 0===R?void 0:R.color)||G.palette.chart.gridlines},minorGridlines:{count:0}},X.hAxis={...X.hAxis,titleTextStyle:Y,textStyle:$,gridlines:{...null===(O=X.hAxis)||void 0===O?void 0:O.gridlines,color:(null===(W=X.hAxis)||void 0===W||null===(F=W.gridlines)||void 0===F?void 0:F.color)||G.palette.chart.gridlines},minorGridlines:{...null===(L=X.hAxis)||void 0===L?void 0:L.minorGridlines,color:(null===(N=X.hAxis)||void 0===N||null===(B=N.gridlines)||void 0===B?void 0:B.color)||G.palette.chart.gridlines}},X.legend={...X.legend,textStyle:$},X.annotations={...X.annotations,highContrast:!0,textStyle:{color:G.palette.primary.contrastText,fontSize:z({isPortrait:q,isSmaller:!0}),opacity:.8},stem:{...null===(Q=X.annotations)||void 0===Q?void 0:Q.stem,color:G.palette.chart.axisTitle,thickness:2},boxStyle:{rx:G.shape.borderRadius,ry:G.shape.borderRadius,fill:G.palette.chart.annotationBoxFill,fillOpacity:.5}},V&&(X={...X,chartArea:{...X.chartArea,width:"80%",height:"80%"},seriesSelector:!1,pointSize:0,enableInteractivity:!1,annotations:P,legend:"none",vAxis:{...X.vAxis,textPosition:"none",titleTextStyle:{...X.vAxis.titleTextStyle,bold:!1},gridlines:{color:"transparent",count:0},viewWindowMode:"maximized"},hAxis:{...X.hAxis,textPosition:"none",gridlines:{color:"transparent",count:0},titleTextStyle:{...X.hAxis.titleTextStyle,bold:!1}}}),X},M=e=>{const t=R({cellSizeMin:14,cellSizeMax:18});return{...e,width:t.chartWidth,calendar:{cellSize:t.cellSize,yearLabel:{fontSize:t.yearLabelFontSize}},noDataPattern:{backgroundColor:"none",color:"none"}}},_=e=>{var t;const{chartControl:o,mainChartData:n,mainChartOptions:i,subchartIndex:r,theme:a,isPortrait:l}=e;let s={...null===(t=o.options)||void 0===t?void 0:t.ui,snapToData:!0};var c,d,u,h,p,x,m,g;"ChartRangeFilter"===o.controlType&&(s={...s,chartType:n.chartType,chartView:{columns:n.columns||n.subcharts&&n.subcharts[r].columns||null},chartOptions:{...i,...null===(c=o.options)||void 0===c||null===(d=c.ui)||void 0===d?void 0:d.chartOptions,hAxis:{...null===(u=o.options)||void 0===u||null===(h=u.ui)||void 0===h||null===(p=h.chartOptions)||void 0===p?void 0:p.hAxis,textPosition:"out",textStyle:{color:a.palette.chart.axisText,fontSize:z({isPortrait:l,isSmaller:!0})}},vAxis:{...null===(x=o.options)||void 0===x||null===(m=x.ui)||void 0===m||null===(g=m.chartOptions)||void 0===g?void 0:g.vAxis,title:null},annotations:P,legend:null}});return s},R=e=>{let{cellSizeMin:t,cellSizeMax:o}=e;const n=Math.min(Math.max(.9*window.innerWidth/58,t),o);return{chartWidth:56*n,cellSize:n,yearLabelFontSize:2*n}},O=e=>{let{controlWrapper:t,chartID:o}=e;const n=e=>{var t=e.changedTouches[0],o="";switch(e.type){case"touchstart":o="mousedown";break;case"touchmove":o="mousemove";break;case"touchend":o="mouseup";break;default:return}var n=new MouseEvent(o,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,button:0,relatedTarget:null});t.target.dispatchEvent(n),e.preventDefault()};let i=!0;if(!t)return;const r=document.querySelector("#control-".concat(o));return r?(["touchstart","touchmove","touchend","touchcancel"].forEach((e=>{r.addEventListener(e,n,{capture:!0})})),()=>{i=!1,["touchstart","touchmove","touchend","touchcancel"].forEach((e=>{r.removeEventListener(e,n,{capture:!0})}))}):void 0},W=(0,i.ZP)(r.Z)((e=>{let{theme:t,isPortrait:o}=e;return{"& .google-visualization-tooltip, .nivo-tooltip":{width:"unset !important",maxWidth:"350px",height:"unset",padding:"1em",boxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",mozBoxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",webkitBoxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",border:"solid 1px",borderColor:t.palette.text.secondaryRGB,fontSize:"".concat(o?9:12,"px"),color:t.palette.chart.tooltip.text,background:t.palette.chart.tooltip.background,borderRadius:t.spacing(.5),"& ul":{margin:"0 !important","& li":{margin:"0 !important",padding:"0 !important","& span":{fontSize:"".concat(o?9:12,"px !important"),color:"".concat(t.palette.chart.tooltip.text," !important")}}}},"& .goog-menuitem-highlight, .goog-menuitem-hover":{backgroundColor:"".concat(t.palette.primary," !important")},"& .google-visualization-controls-categoryfilter":{fontSize:"0.85rem",marginTop:"0.75rem",marginBottom:"-0.75rem","& .goog-inline-block > .goog-menu-button":{marginTop:0},"& .goog-menu-button-hover .goog-menu-button-outer-box, .goog-menu-button-hover .goog-menu-button-inner-box":{borderColor:"inherit !important"},"& .google-visualization-controls-label":{color:t.palette.text.secondary,fontWeight:500,verticalAlign:"middle",marginBottom:"0.25rem"},"& .goog-menu-button-outer-box":{backgroundColor:t.palette.background.paper,border:"unset","& .goog-menu-button-inner-box":{paddingTop:t.spacing(.5),paddingBottom:t.spacing(.5),paddingLeft:t.spacing(2),paddingRight:t.spacing(2),border:"solid",borderWidth:"0.5px",borderRadius:t.spacing(.5),borderColor:t.palette.text.secondary,"& .goog-menu-button-caption":{color:t.palette.text.secondary}}}},"& .google-visualization-controls-rangefilter":{width:"100%",fontSize:"0.75rem","& .goog-inline-block":{width:"100%"},"& .google-visualization-controls-slider-horizontal":{width:"90%",margin:"0 5%"},"& .google-visualization-controls-rangefilter-thumblabel:nth-of-type(1)":{position:"absolute",top:"1.5em",left:"5%"},"& .google-visualization-controls-rangefilter-thumblabel:nth-of-type(2)":{position:"absolute",top:"1.5em",right:"5%"},"& .google-visualization-controls-slider-handle":{background:t.palette.primary.main},"& .google-visualization-controls-rangefilter-thumblabel":{color:t.palette.text.secondary,padding:0,fontWeight:500},"& .google-visualization-controls-slider-thumb":{background:t.palette.primary.main,border:"unset",borderRadius:"4px"}},'& path[stroke-opacity="0.3"], path[stroke-opacity="0.1"], path[stroke-opacity="0.05"], rect[stroke-opacity]':{stroke:t.palette.text.primary,strokeWidth:3},"& [column-id]:not(:empty)":{cursor:"pointer",":hover":{fontWeight:600}}}}));var F=o(6694),L=o(5276),N=o(8970),B=o(3540),Q=o(9755);const U=40,H=e=>e?{top:20,right:0,bottom:0,left:20}:{top:30,right:40,bottom:0,left:40},q=e=>{var t,o,n,i,r,a,l;const{data:s,dateRange:c,valueRange:d,isPortrait:u,options:p}=e,x=H(u),m=(0,h.Z)(),g=(e,t)=>{const o=new Date(e),n=o.getDay(),i=0===n||1===n,r=new Date(t.min).getFullYear(),a=o.getFullYear()===r;return i&&a},v=null!==p&&void 0!==p&&null!==(t=p.colorAxis)&&void 0!==t&&t.isGradient?Y(null===p||void 0===p||null===(o=p.colorAxis)||void 0===o?void 0:o.colors[0],null===p||void 0===p||null===(n=p.colorAxis)||void 0===n?void 0:n.colors[1],100):null===p||void 0===p||null===(i=p.colorAxis)||void 0===i?void 0:i.colors;return(0,S.jsxs)(S.Fragment,{children:["none"!==(null===p||void 0===p||null===(r=p.legend)||void 0===r?void 0:r.position)&&(()=>{var e;return(0,S.jsx)(G,{valueRange:d,colors:null===p||void 0===p||null===(e=p.colorAxis)||void 0===e?void 0:e.colors,isPortrait:u})})(),(0,S.jsx)(N.DQ,{data:s,from:null===c||void 0===c?void 0:c.min,to:null===c||void 0===c?void 0:c.max,emptyColor:"transparent",theme:{text:{fill:m.palette.text.secondary},tooltip:{container:{background:"dark"===m.palette.mode?"#2b2b2b":"#fff",color:m.palette.text.primary}},axis:{ticks:{line:{stroke:"dark"===m.palette.mode?"#2b2b2b":"#fff"},text:{fill:m.palette.text.primary}}},grid:{line:{stroke:"dark"===m.palette.mode?"#2b2b2b":"#fff"}}},colors:v,minValue:null===p||void 0===p||null===(a=p.colorAxis)||void 0===a?void 0:a.minValue,maxValue:null===p||void 0===p||null===(l=p.colorAxis)||void 0===l?void 0:l.maxValue,margin:x,yearSpacing:U,monthBorderColor:m.palette.text.primary,monthBorderWidth:1,daySpacing:.25,dayBorderWidth:0,tooltip:e=>{let{day:t,value:o,color:n}=e;const i=s.find((e=>e.day===t)),r=i?(a=i.tooltip,(new DOMParser).parseFromString(a,"text/html").body.innerHTML):"";var a;return(0,S.jsx)(V,{day:t,color:n,tooltipText:r,dateRange:c,inFirstTwoRowsOfChart:g})}})]})},V=e=>{let{day:t,color:o,tooltipText:i,dateRange:a,inFirstTwoRowsOfChart:l}=e;const s=(0,n.useRef)(null);return(0,n.useEffect)((()=>{if(s.current&&l(t,a)){const e=s.current.parentElement;e&&(e.style.top="11vh")}}),[s,l]),(0,S.jsxs)(r.Z,{ref:s,className:"nivo-tooltip",children:[(0,S.jsx)(y.Z,{sx:{backgroundColor:o,mr:.5,height:"10px",width:"10px",borderRadius:"50%"}}),(0,B.ZP)(i,{replace:Q.T})]})},G=e=>{let{valueRange:t,colors:o,isPortrait:n}=e;if(null===(null===t||void 0===t?void 0:t.min)||null===(null===t||void 0===t?void 0:t.max))return null;const i=(0,h.Z)(),a=o.map(((e,t,o)=>{const n=t/(o.length-1)*100;return"".concat(e," ").concat(n,"%")})).join(", "),l={position:"sticky",width:"fit-content",marginTop:"1rem",left:n?"58%":"74%"},s={background:"linear-gradient(to right, ".concat(a,")"),color:i.palette.text.primary,border:"1px solid ".concat(i.palette.text.primary),minWidth:"150px",height:"1.1rem",maxHeight:"1.25rem",display:"flex",justifyContent:"space-between"},c={position:"relative",top:"-1.15rem",fontSize:"0.8rem"};return(0,S.jsx)(r.Z,{style:l,children:(0,S.jsxs)(r.Z,{style:s,children:[(0,S.jsx)("span",{style:c,children:t.min}),(0,S.jsx)("span",{style:c,children:t.max})]})})},Y=(e,t,o)=>{function n(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,o,n){return t+t+o+o+n+n}));const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[null,null,null]}function i(e,t,o){return"#"+[e,t,o].map((e=>{const t=e.toString(16);return 1===t.length?"0"+t:t})).join("")}function r(e,t,o){let n=e.slice();for(let i=0;i<3;i++)n[i]=Math.round(n[i]+o*(t[i]-e[i]));return n}let a=n(e),l=n(t),s=[];for(let c=0;c<o;c++){let e=r(a,l,c/(o-1));s.push(i(...e))}return s};function $(e){var t,o;const{chartData:i,subchartIndex:a,windowSize:l,isPortrait:s,isHomepage:c,height:p,maxHeight:x}=e,m=null===(t=i.subcharts)||void 0===t?void 0:t[a].chartSubstituteComponentName;if(m)return(0,S.jsx)(L.default,{chartSubstituteComponentName:m});const g=i.customClassName?"".concat(i.chartType," ").concat(i.customClassName):i.chartType,[v,f]=(0,n.useContext)(d.R),[b,y]=(0,n.useState)(),[j,Z]=(0,n.useState)(),[w,C]=(0,n.useState)(),[P,z]=(0,n.useState)(),R=(0,h.Z)(),[N,B]=(0,n.useState)(!0),[Q,V]=(0,n.useState)(),[G,Y]=(0,n.useState)(),[$,X]=(0,n.useState)(),[K,J]=(0,n.useState)(I()),[ee,te]=(0,n.useState)(200);let oe=(0,n.useMemo)((()=>{let t=E({...e,theme:R});return"Calendar"===i.chartType&&(t=M(t)),t}),[e,R,i.chartType]);const[ne,ie]=(0,n.useState)(null),[re,ae]=(0,n.useState)(200),[le,se]=(0,n.useState)(1200);if("Calendar"===i.chartType)return(0,n.useEffect)((()=>{const e=i.dataArray||i.subcharts&&i.subcharts[a].dataArray||null;if(!e)return;const t=e.map((e=>e.day)),o=e.map((e=>e.value)),n=A(t);ie({data:e,dateRange:n,valueRange:D(o)});const r=new Date(n.min).getFullYear(),l=new Date(n.max).getFullYear()-r+1,c=7*Math.min(le/60,20),d=H(s);let u;u=1==l?c+U+d.top+d.bottom:l*(c+U)+d.top+d.bottom,ae(u)}),[i]),(0,S.jsx)(W,{isPortrait:s,className:g,position:"relative",minWidth:"700px",minHeight:s?"200px":re+"px",height:re+"px",maxHeight:s&&"550px",children:ne?(0,S.jsx)(q,{data:ne.data,dateRange:ne.dateRange,valueRange:ne.valueRange,isPortrait:s,options:oe}):(0,S.jsx)(r.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,S.jsx)(F.Z,{})})});let ce,de=!1,ue=i.control||(null===(o=i.subcharts)||void 0===o?void 0:o[a].control);ue&&!0!==c&&(de=!0,ce={...ue.options,ui:_({chartControl:ue,mainChartData:i,mainChartOptions:oe,subchartIndex:a,theme:R,isPortrait:s})},"ChartRangeFilter"===ue.controlType&&(0,n.useEffect)((()=>O({controlWrapper:P,chartID:K})),[P]));const he=oe.seriesSelector||!1;(0,n.useEffect)((()=>{he?me(G):(null===j||void 0===j||j.setOptions({...oe,..."Calendar"===i.chartType&&{height:ee}}),null===j||void 0===j||j.draw(),de&&(null===P||void 0===P||P.setOptions(ce),null===P||void 0===P||P.draw()))}),[R,s,l,ee]),(0,n.useEffect)((()=>{G&&he&&"setViewColumn"==he.method&&(pe({dataColumns:G}),me(G))}),[R]);const pe=e=>{let{dataColumns:t}=e;t.forEach((e=>{var t;e.color=oe.colors[e.seriesIndex%oe.colors.length],e.serieAttribute=null===(t=oe.series)||void 0===t?void 0:t[e.seriesIndex]}))},xe=e=>{let t,o,{dataTable:n,allInitialColumns:i}=e;return i.forEach(((e,i)=>{if(0===i)return;const r=n.getColumnRange(e.sourceColumn);!isNaN(r.min)&&r.min&&(t=t?Math.min(t,r.min):r.min),!isNaN(r.max)&&r.max&&(o=o?Math.max(o,r.max):r.max)})),{min:t,max:o}},me=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j;if(Q){if(Y(e),"toggleVisibility"===he.method||null===he.method){const o={};e.forEach((e=>{e.selected||(o[e.seriesIndex]={color:"transparent",enableInteractivity:!1,visibleInLegend:!1})})),null===t||void 0===t||t.setOptions({...oe,series:{...oe.series,...o}})}else if("setViewColumn"===he.method){let o=[];o.push(0),e.forEach((e=>{if(e.selected){o.push(e);for(let t=e.indexInAllInitialColumns+1;t<Q.length&&"data"!==Q[t].role;t++)o.push(Q[t])}})),null===t||void 0===t||t.setView({columns:o});const n={...oe};n.colors=e.filter((e=>e.selected)).map((e=>e.color));const i={};let r=0;e.forEach((e=>{e.selected&&(null!=e.serieAttribute&&(i[r]=e.serieAttribute),r++)})),n.series=i,null===t||void 0===t||t.setOptions(n)}null===t||void 0===t||t.draw(),de&&(null===P||void 0===P||P.draw())}};(0,n.useEffect)((()=>{if(v&&i){if("Calendar"===i.chartType)return;const e=i.dataArray||i.subcharts&&i.subcharts[a].dataArray||null;if(!e)return;const t=v.visualization.arrayToDataTable(e);y(t);const o=(e=>{if(!e)return;const t=[];for(const o of e)if("number"===typeof o)t.push(o);else if("object"===typeof o)if(o.calc&&"stringify"!==o.calc){const e=new Function("dataTable","rowNum",o.calc);t.push({...o,calc:e})}else t.push(o);return t})(i.columns||i.subcharts&&i.subcharts[a].columns||null),n=new v.visualization.ChartWrapper({chartType:i.chartType,dataTable:de?void 0:t,options:oe,view:{columns:o},containerId:K});if(Z(n),de){const e=new v.visualization.Dashboard(document.getElementById("dashboard-".concat(K)));C(e),v.visualization.events.addListener(e,"ready",ge);const o=new v.visualization.ControlWrapper({controlType:ue.controlType,options:ce,containerId:"control-".concat(K)});z(o),e.bind(o,n),e.draw(t)}else v.visualization.events.addListener(n,"ready",ge),n.draw();if(he){const e=(e=>{let{chartWrapper:t,dataTable:o,seriesSelector:n}=e;var i=t.getView();if(null==i.columns){const e=new v.visualization.DataView(o);t.setView({columns:e.columns}),i=t.getView()}let r=!0,a=0;const l=i.columns.map(((e,t)=>("number"===typeof e&&(e={role:r?"domain":"data",sourceColumn:e}),e.label=o.getColumnLabel(e.sourceColumn),e.indexInAllInitialColumns=t,r=r&&!1,"data"===e.role&&(null!==n&&void 0!==n&&n.allowMultiple?e.selected=!0:e.selected=0===a,e.seriesIndex=a,a++),e)));V(l);const s=xe({dataTable:o,allInitialColumns:l});X(s);const c=l.filter((e=>{var t,o;return"data"===e.role&&!1!==(null===(t=oe.series)||void 0===t||null===(o=t[e.seriesIndex])||void 0===o?void 0:o.visibleInLegend)}));return"setViewColumn"===n.method&&pe({dataColumns:c}),Y(c),c})({chartWrapper:n,dataTable:t,seriesSelector:he});me(e,n)}}}),[v,i]);const ge=()=>{N&&B(!1)};return(0,S.jsxs)(W,{isPortrait:s,className:g,position:"relative",height:"100%",minHeight:"Calendar"===i.chartType&&"200px",children:[N&&(0,S.jsx)(r.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,S.jsx)(F.Z,{})}),he&&!N&&(0,S.jsx)(k,{items:G,allowMultiple:he.allowMultiple,selectorID:"".concat(i.title,"-selector"),onSeriesSelection:me}),(()=>{var e;return de?(0,S.jsxs)(u.Z,{id:"dashboard-".concat(K),direction:(null===(e=T[ue.controlType])||void 0===e?void 0:e.stackDirection)||"column-reverse",sx:{height:"100%"},children:[(0,S.jsx)(r.Z,{id:"control-".concat(K),sx:{height:"calc(".concat(p," / 8)"),opacity:.8,filter:"saturate(0.3)"}}),(0,S.jsx)(r.Z,{id:K,sx:{height:p,maxHeight:x}})]}):(0,S.jsx)(r.Z,{id:K,sx:{height:p,maxHeight:x}})})()]})}var X=o(3767);const K=function(e){let{text:t,wordLimit:o=40,reference:i}=e;const[a,s]=(0,n.useState)(!1),d=(0,h.Z)(),u=(0,l.Z)(d.breakpoints.down("sm")),p=(0,n.useRef)(null),x=t.split(" ");if(!u||x.length/o<=1.4)return(0,S.jsxs)(r.Z,{children:[(0,S.jsx)(c.Z,{children:(0,B.ZP)(t,{replace:Q.T})}),i&&(0,S.jsx)(c.Z,{variant:"caption",color:"text.secondary",children:(0,B.ZP)(i,{replace:Q.T})})]});let m=x.slice(0,o).join(" ");const g=m.lastIndexOf(".");return-1!==g&&(m=m.slice(0,g+1)),(0,S.jsx)(X.d,{onClickAway:e=>{(e=>{let{target:t}=e;const o=p.current.closest(".MuiContainer-root"),n=new Set(["rect","path","svg","circle"]);for(;null!=t;){if(n.has(t.tagName))return t.closest(".MuiContainer-root")===o;t=t.parentNode}return!1})(e)||s(!1)},children:(0,S.jsx)(r.Z,{ref:p,onClick:()=>s(!a),style:{cursor:"pointer"},children:a?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(c.Z,{children:(0,B.ZP)(t,{replace:Q.T})}),i&&(0,S.jsx)(c.Z,{variant:"caption",color:"text.secondary",children:(0,B.ZP)(i,{replace:Q.T})})]}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(c.Z,{display:"inline",children:[(0,B.ZP)(m,{replace:Q.T}),"..."]}),(0,S.jsx)(c.Z,{display:"inline",color:"text.primary",fontWeight:"500",sx:{ml:.5,"& :hover":{textDecoration:"underline"}},children:"See more"})]})})})};o(9019);const J=(0,i.ZP)(r.Z)((e=>{let{theme:t}=e;return{..."dark"===t.palette.mode&&{filter:"saturate(0.85)","& .heat-map-iframe":{filter:"invert(0.848) hue-rotate(180deg)"}},'& .historical-snapshot-aqi svg [clip-path*="ABSTRACT_RENDERER"] > g:nth-of-type(1), .historical-snapshot-aqi [id*="googlechart-control"] svg [clip-path*="ABSTRACT_RENDERER"] > g:nth-of-type(2)':{opacity:.6},"& .Calendar [dir]:not(:empty)":{margin:"auto"},"& .Calendar > div > div:last-of-type > div":{overflowX:"auto",overflowY:"hidden",scrollbarGutter:"stable"}}})),ee=(0,i.ZP)(a.Z)((e=>{let{theme:t}=e;return{"& .MuiTabScrollButton-root":{color:t.palette.text.primary},"& .MuiTab-root":{[t.breakpoints.down("sm")]:{fontSize:"0.75rem",paddingLeft:t.spacing(1),paddingRight:t.spacing(1)}}}}));const te=function(e){const{generalChartSubtitle:t,generalChartReference:o,chartData:i,chartHeight:a,isHomepage:d}=e,u=(0,l.Z)((e=>e.breakpoints.down("sm"))),[h,p]=(0,n.useState)(window.matchMedia("(orientation: portrait)").matches),[x,m]=(0,n.useState)([window.innerWidth,window.innerHeight]);let g,v=a;const f=i,[b,y]=(0,n.useState)(0);(0,n.useEffect)((()=>{y(0);let e=null;const t=()=>{clearTimeout(e),e=setTimeout((()=>{p(window.matchMedia("(orientation: portrait)").matches),m([window.innerWidth,window.innerHeight])}),100)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}}),[f]),"Calendar"===f.chartType||v||(v=h?"80vw":"35vw",g=h?"800px":"500px");const j=(e,t)=>{y(t)};return(0,S.jsxs)(J,{height:"100%",children:[f.subcharts?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(ee,{value:b,onChange:j,variant:u?"fullWidth":"standard",children:f.subcharts.map(((e,t)=>(0,S.jsx)(s.Z,{value:t,label:f.subcharts[t].subchartTitle},t)))}),(0,S.jsx)(r.Z,{position:"relative",sx:{overflowX:h&&"auto",WebkitOverflowScrolling:h&&"touch",overflowY:"hidden"},children:f.subcharts.map(((e,t)=>(0,S.jsx)(r.Z,{width:"100%",height:"100%",role:"tabpanel",sx:{transition:"0.35s",position:0===t?"":"absolute",opacity:b===t?"1":"0",pointerEvents:b===t?"auto":"none",top:0===t?"":0},children:(0,S.jsx)($,{chartData:f,subchartIndex:t,isPortrait:h,isHomepage:d,windowSize:x,height:f.height?f.height:v,maxHeight:["Calendar"].includes(f.chartType)?"":g})},t)))})]}):(0,S.jsx)($,{chartData:f,isPortrait:h,isHomepage:d,windowSize:x,height:f.height?f.height:v}),(0,S.jsx)(r.Z,{sx:{my:3},children:(0,S.jsx)(c.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{mb:1},children:(0,S.jsx)(K,{text:(()=>{var e;let o=t||"";return f.subcharts&&null!==(e=f.subcharts[b])&&void 0!==e&&e.subchartSubtitle&&(o+="<br/>",o+=f.subcharts[b].subchartSubtitle),o})(),reference:(()=>{var e;let t=o||"";return f.subcharts&&null!==(e=f.subcharts[b])&&void 0!==e&&e.reference&&(t+="<br/>",t+=f.subcharts[b].reference),t})()})})})]})}},8416:(e,t,o)=>{"use strict";o.r(t),o.d(t,{StyledTable:()=>g,default:()=>v});var n=o(6934),i=o(9836),r=o(697),a=o(6890),l=o(5855),s=o(3994),c=o(3382),d=o(3540),u=o(9755),h=o(9114),p=o(3511),x=o(604),m=o(184);const g=(0,n.ZP)(i.Z)((e=>{let{theme:t,isTiny:o}=e;return{minWidth:o||700,"& th, td":{fontSize:o?"0.625rem":"0.6875rem",color:t.palette.text.secondary,[t.breakpoints.down("sm")]:{fontSize:o?"0.5rem":"0.6875rem"}},"& th":{fontWeight:500,color:t.palette.text.primary,lineHeight:"1rem"}}}));const v=function(e){const{isTiny:t,hideAQIDescription:o,themePreference:n}=e;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(r.Z,{overflow:"auto",children:(0,m.jsxs)(g,{size:"small",isTiny:t,children:[(0,m.jsx)(a.Z,{children:(0,m.jsxs)(l.Z,{children:[(0,m.jsx)(s.Z,{sx:{pr:0},children:(0,m.jsx)(r.Z,{sx:{width:"1em",height:"1em"}})}),(0,m.jsx)(s.Z,{sx:{pl:1},children:"Category"}),(0,m.jsx)(s.Z,{align:"right",children:"US AQI"}),(0,m.jsxs)(s.Z,{align:"right",children:["PM2.5 Concentration (\xb5g/m",(0,m.jsx)("sup",{children:"3"}),")"]}),!o&&(0,m.jsx)(s.Z,{align:"left",children:"Description"}),!o&&(0,m.jsx)(s.Z,{align:"left",children:"CITIESair' Suggested Actions"})]})}),(0,m.jsx)(c.Z,{children:p.Z.map(((e,t)=>(0,m.jsxs)(l.Z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[(0,m.jsx)(s.Z,{sx:{pr:0},children:(0,m.jsx)(r.Z,{sx:{width:"1em",height:"1em",backgroundColor:n===x.Z.light?e.lightThemeColor:e.darkThemeColor}})}),(0,m.jsx)(s.Z,{sx:{pl:1},children:e.category}),(0,m.jsxs)(s.Z,{align:"right",children:[e.aqiUS.low,"\xa0 - \xa0",e.aqiUS.high]}),(0,m.jsxs)(s.Z,{align:"right",children:[e.rawPM2_5.low,"\xa0 - \xa0",e.rawPM2_5.high]}),!o&&(0,m.jsx)(s.Z,{align:"left",children:e.description}),!o&&(0,m.jsx)(s.Z,{align:"left",children:(0,d.ZP)(e.healthSuggestions.outdoors,{replace:u.T})})]},t)))})]})}),(e=>{let{shouldRender:t}=e,o=null;if(t){const e=[["category"],["US AQI"]];for(let t=0;t<p.Z.length;t+=1)e[0].push(p.Z[t].category),e[1].push(50*Math.ceil((p.Z[t].aqiUS.high-p.Z[t].aqiUS.low)/50));o=(0,m.jsx)(h.Z,{chartHeight:"4rem",chartData:{dataArray:e,chartType:"BarChart",options:{enableInteractivity:!1,legend:{position:"none"},hAxis:{ticks:[0,50,100,150,200,300,500]},chartArea:{width:{portrait:"98%",landscape:"50%"},height:{portrait:"20%",landscape:"30%"}},isStacked:!0,colors:"aqi",bar:{groupWidth:"100%"}}}})}return o})({shouldRender:!o})]})}},5276:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>a});var n=o(2791),i=o(6694),r=o(184);function a(e){let{chartSubstituteComponentName:t}=e;return(0,r.jsx)(n.Suspense,{fallback:(0,r.jsx)(i.Z,{}),children:(()=>{const e=(0,n.lazy)((()=>o(6598)("./".concat(t))));return(0,r.jsx)(e,{})})()})}},4675:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>Me});var n=o(2791),i=o(7689),r=o(8914),a=o(5973),l=o(3540),s=o(9114),c=o(1745),d=o(472),u=o(68),h=o(1918),p=o(7047),x=o(1889),m=o(697),g=o(9164),v=o(890),f=o(6314),b=o(4721),y=o(3967),j=o(604),S=o(173),Z=o(9877),w=o(5396),C=o(2003),k=o(5527),T=o(1162),A=o(8388),D=o(7438),I=o(8416),P=o(184);function z(e){const[t,o]=(0,n.useState)(null),i=e=>{o(e.currentTarget),D.y(D.z.airQualityIndexLegendQuickGlance)},r=()=>{o(null)},a=Boolean(t);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(A.T,{...e,distanceFromBottomOfWindow:"5.5rem",children:(0,P.jsx)(Z.Z,{sx:{mt:1},"aria-owns":a?D.z.airQualityIndexLegendQuickGlance:void 0,"aria-haspopup":"true",onMouseEnter:i,onMouseLeave:r,onClick:e=>S.tq&&(a?r():i(e)),"aria-label":D.z.airQualityIndexLegendQuickGlance,color:"primary",children:(0,P.jsxs)(f.Z,{direction:"column",alignItems:"center",children:[(0,P.jsx)(T.Z,{fontSize:"1rem"}),(0,P.jsx)(v.Z,{variant:"body2",fontWeight:"500",children:"AQI"})]})})}),(0,P.jsx)(w.Z,{id:D.z.airQualityIndexLegendQuickGlance,sx:{pointerEvents:"none",mt:-1},open:a,anchorEl:t,placement:"top-end",onClose:r,keepMounted:!0,disableRestoreFocus:!0,transition:!0,children:e=>{let{TransitionProps:t}=e;return(0,P.jsx)(C.Z,{...t,timeout:350,children:(0,P.jsxs)(k.Z,{elevation:8,sx:{py:.5,mb:1},children:[(0,P.jsx)(v.Z,{sx:{mx:2,mt:1},color:"text.disabled",variant:"body1",fontWeight:500,children:"AQI at quick glance"}),(0,P.jsx)(I.default,{isTiny:!0,hideAQIDescription:!0,themePreference:!0})]})})}})]})}var E=o(1478),M=o(501),_=o(4281),R=(o(4058),o(4853)),O=o(9161),W=o(9755),F=o(5193),L=o(4294),N=o(9818),B=o(7123),Q=o(195),U=o(43),H=o(9836),q=o(6890),V=o(5855),G=o(3994),Y=o(3382),$=o(8096),X=o(9321),K=o(5022),J=o(8821),ee=o(1566),te=o(1009),oe=o(8206),ne=o(6694);function ie(e){const{schoolID:t,initialSensorList:o}=e,[i,r]=(0,n.useState)(o),[a,l]=(0,n.useState)("placeholder");(0,n.useEffect)((()=>{r(o)}),[o]);const s=(0,y.Z)(),c=(0,F.Z)(s.breakpoints.down("sm")),[d,u]=(0,n.useState)(!1),p=()=>{r(o),u(!1)};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(L.Z,{onClick:()=>{l(null),u(!0),D.y(D.z.rawDatasetButtonClicked)},variant:"contained",children:[(0,P.jsx)(ee.Z,{sx:{fontSize:"1rem"}}),"\xa0Raw Dataset"]}),(0,P.jsxs)(N.Z,{open:d,onClose:p,maxWidth:"lg",fullWidth:!0,fullScreen:c,keepMounted:!0,children:[c&&(0,P.jsx)(B.Z,{justifyContent:"flex-start",children:(0,P.jsxs)(L.Z,{autoFocus:!0,onClick:p,children:[(0,P.jsx)(te.Z,{sx:{fontSize:"1rem"}}),"Back"]})}),(0,P.jsxs)(Q.Z,{sx:{px:c?2:3,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"start",height:"100%"},children:[(0,P.jsx)(h.Z,{label:t?"School: ".concat(t.toUpperCase()):"No School",size:"small",sx:{mb:1}}),(0,P.jsx)(v.Z,{variant:"h6",children:"Preview and download raw dataset(s)"}),(0,P.jsx)(re,{sensorsDatasets:i,updateSensorsDatasets:r,previewingDataset:a,setPreviewingDataset:l,smallScreen:c,schoolID:t}),i&&(0,P.jsxs)(v.Z,{variant:"caption",sx:{my:3,fontStyle:"italic"},children:["These datasets are provided by CITIESair from sensors operated by CITIESair. Should you intend to utilize them for your project, research, or publication, we kindly request that you notify us at ",(0,P.jsx)(U.Z,{href:"mailto:nyuad.cities@nyu.edu",children:"nyuad.cities@nyu.edu"})," to discuss citation requirements."]})]})]})]})}const re=e=>{const{sensorsDatasets:t,updateSensorsDatasets:o,previewingDataset:i,setPreviewingDataset:a,smallScreen:l,schoolID:s}=e;return(0,n.useEffect)((()=>{if(Object.keys(t).length>0&&!i){const e=Object.keys(t)[0],n=oe.M$.hourly;if(a({sensor:e,datasetType:n}),t[e].rawDatasets[n].sample)return;const i=(0,oe.OM)({school_id:s,sensor_location_short:e,datasetType:n,isSample:!0});(0,r.m)({url:i,extension:"csv",needsAuthorization:!0}).then((i=>{const r={...t};r[e].rawDatasets[n].sample=i,o(r)})).catch((e=>console.log(e)))}}),[t,i]),(0,P.jsxs)(x.ZP,{container:!0,justifyContent:"center",alignItems:"start",spacing:3,children:[(0,P.jsx)(x.ZP,{item:!0,sm:12,md:6,children:(0,P.jsx)(ae,{schoolID:s,sensorsDatasets:t,updateSensorsDatasets:o,smallScreen:l,previewingDataset:i,setPreviewingDataset:a})}),(0,P.jsx)(x.ZP,{item:!0,sm:12,md:6,maxWidth:l?"100%":"unset",sx:{mt:1},children:(0,P.jsx)(se,{sensorsDatasets:t,updateSensorsDatasets:o,previewingDataset:i,schoolID:s,smallScreen:l})})]})},ae=e=>{const{schoolID:t,sensorsDatasets:o,smallScreen:n,previewingDataset:i,setPreviewingDataset:r,updateSensorsDatasets:a}=e;return(0,P.jsxs)(H.Z,{size:"small",sx:{tableLayout:"fixed","& td, div, .MuiMenuItem-root":{fontSize:n?"0.625rem":"0.8rem"}},children:[(0,P.jsx)(q.Z,{children:(0,P.jsxs)(V.Z,{children:[(0,P.jsx)(G.Z,{sx:{pl:1},children:"Sensor Location"}),(0,P.jsx)(G.Z,{sx:{width:n?"9.5rem":"11rem"},children:"Dataset Type"})]})}),(0,P.jsx)(Y.Z,{children:Object.keys(o).map((e=>(0,P.jsx)(le,{schoolID:t,smallScreen:n,sensor:e,sensorsDatasets:o,previewingDataset:i,setPreviewingDataset:r,isPreviewing:e===(null===i||void 0===i?void 0:i.sensor),updateSensorsDatasets:a})))})]})},le=e=>{const{schoolID:t,sensorsDatasets:o,sensor:i,previewingDataset:a,setPreviewingDataset:l,isPreviewing:s,updateSensorsDatasets:c}=e,[d,u]=(0,n.useState)(oe.M$.hourly);(0,n.useEffect)((()=>{d!==oe.M$.hourly&&u(oe.M$.hourly)}),[t]);const h=e=>{if(!o[i].rawDatasets[e].sample){const n=(0,oe.OM)({school_id:t,sensor_location_short:o[i].location_short,datasetType:e,isSample:!0});(0,r.m)({url:n,extension:"csv",needsAuthorization:!0}).then((t=>{const n={...o};n[i].rawDatasets[e].sample=t,c(n)}))}},p=(0,y.Z)();return(0,P.jsx)(P.Fragment,{children:(0,P.jsxs)(V.Z,{children:[(0,P.jsx)(G.Z,{sx:{pl:1,cursor:"pointer",background:s&&p.palette.background.NYUpurpleLight},onClick:()=>{(null===a||void 0===a?void 0:a.sensor)!==i&&(l({datasetType:d,sensor:i}),h(d))},children:o[i].location_long}),(0,P.jsx)(G.Z,{sx:{position:"relative",background:s&&p.palette.background.NYUpurpleLight},children:(0,P.jsx)($.Z,{size:"small",children:(0,P.jsx)(X.Z,{value:d,onChange:e=>{const t=e.target.value;u(t),l({datasetType:t,sensor:i}),h(t)},variant:"standard",MenuProps:{disablePortal:!0},children:Object.keys(o[i].rawDatasets).reverse().map(((e,t)=>(0,P.jsx)(K.Z,{value:e,children:(0,P.jsx)(f.Z,{direction:"row",alignItems:"center",children:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()})},t)))})})})]},i)})},se=e=>{const{sensorsDatasets:t,updateSensorsDatasets:o,previewingDataset:i,schoolID:a,smallScreen:l}=e,s=(0,y.Z)(),[c,d]=(0,n.useState)("Not previewing any dataset"),[u,h]=(0,n.useState)("No dataset"),[p,x]=(0,n.useState)(!1),g=e=>{const t=new Blob([e],{type:"application/octet-stream"}),o=URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download=u,document.body.appendChild(n),n.click(),URL.revokeObjectURL(o),document.body.removeChild(n)},[b,j]=(0,n.useState)(""),[S,Z]=(0,n.useState)("");return(0,n.useEffect)((()=>{var e,o;if(!i)return;d("Previewing: ".concat(i.sensor," (").concat(i.datasetType,")"));const n=null===(e=t[i.sensor])||void 0===e||null===(o=e.rawDatasets[i.datasetType])||void 0===o?void 0:o.sample;if(!n)return Z(null),j(null),h("Loading..."),void x(!0);p&&x(!1);const r=n.split("\n"),l=r[0].split(","),s=r.slice(1);let c;if(Z(["",...s.map((e=>e.split(",")[0]))].join("\n")),j([l.slice(1).join(","),...s.map((e=>e.split(",").slice(1).join(",")))].join("\n")),s.length>0){const e=s[s.length-1].split(",");if(e.length>=2){c=e[1].split("T")[0]}}const u="".concat(a,"-").concat(i.sensor,"-").concat(i.datasetType,"-").concat(c,".csv");h(u)}),[i,t]),(0,P.jsxs)(f.Z,{spacing:1,children:[(0,P.jsxs)(m.Z,{sx:{"& *":{fontFamily:"monospace !important"}},children:[(0,P.jsx)(f.Z,{direction:"row",children:(0,P.jsx)(v.Z,{variant:"body2",gutterBottom:!0,fontWeight:500,children:c})}),(0,P.jsx)(m.Z,{component:"pre",sx:{overflowX:"auto",color:s.palette.text.secondary,backgroundColor:s.palette.customBackground,p:2,pt:1.5,borderRadius:s.spacing(1),borderTopLeftRadius:0,height:l?"11.8rem":"14rem",width:l?"100%":"unset",marginTop:0},children:(0,P.jsx)(f.Z,{direction:"row",sx:{fontSize:l?"0.625rem !important":"0.8rem !important"},children:b?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(m.Z,{sx:{mr:2,userSelect:"none"},children:S}),(0,P.jsx)(m.Z,{children:b})]}):(0,P.jsx)(ne.Z,{optionalText:"Loading"})})})]}),(0,P.jsx)(m.Z,{textAlign:"center",children:(0,P.jsxs)(L.Z,{variant:"contained",sx:{textTransform:"none",textAlign:"left",lineHeight:1.1,px:1.5,py:1},onClick:()=>{(()=>{if(!i)return;const e=t[i.sensor].rawDatasets[i.datasetType].full;if(e)g(e);else{const e=(0,oe.OM)({school_id:a,sensor_location_short:i.sensor,datasetType:i.datasetType,isSample:!1});(0,r.m)({url:e,extension:"csv",needsAuthorization:!0}).then((e=>{const n={...t};n[i.sensor].rawDatasets[i.datasetType].full=e,o(n),g(e)}))}})(),D.y(D.z.rawDatasetDownloaded,{dataset_type:null===i||void 0===i?void 0:i.datasetType,sensor:null===i||void 0===i?void 0:i.sensor})},disabled:p,children:[(0,P.jsx)(J.Z,{sx:{fontSize:"1.25rem",mr:.5}}),u]})})]})};var ce=o(1087),de=o(2981),ue=o(8313),he=o(6886),pe=o(5570),xe=o(1131),me=o(1440);const ge=e=>{let{schoolID:t,screens:o}=e;return(0,P.jsx)(he.ZP,{variant:"popover",popupId:"tv-screens-list",children:e=>(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(L.Z,{variant:"contained",...(0,pe.b8)(e),...(0,pe.bs)(e),children:[(0,P.jsx)(de.Z,{sx:{fontSize:"1rem"}}),"\xa0TV Screens List"]}),(0,P.jsx)(ue.Z,{...(0,pe.wK)(e),anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},onClick:e.close,children:o.map(((e,o)=>(0,P.jsx)(xe.ZP,{behavior:me.Z.toNewPage,to:"/screen/".concat(t,"/").concat(e.screen_name),label:e.location_long,sx:{fontSize:"0.8rem"}},o)))})]})})},ve=e=>{let{url:t}=e;return(0,P.jsxs)(L.Z,{variant:"contained",component:ce.rU,to:t,children:[(0,P.jsx)(de.Z,{sx:{fontSize:"1rem"}}),"\xa0TV Screen"]})},fe=e=>{let{schoolID:t,screens:o}=e;return Array.isArray(o)?o.length<=1?(0,P.jsx)(ve,{url:"/screen/".concat(t)}):(0,P.jsx)(ge,{schoolID:t,screens:o}):null};var be=o(6344),ye=o(8124),je=o(5117),Se=o(5028),Ze=o(8562),we=o(6071),Ce=o(8610);const ke=e=>{const{allowSelect:t,currentSchoolID:o,currentSchoolName:r,allowedSchools:a,fetchDataForDashboard:l}=e;if(!1===t||!Array.isArray(a)||a.length<=1)return(0,P.jsx)(ze,{icon:(0,P.jsx)(Ze.Z,{}),label:r,tooltipTitle:"School"});const[s,c]=(0,n.useState)(""),[d,u]=(0,n.useState)(null),h=()=>{u(null)},p=(0,i.s0)(),x=e=>()=>{o!==e&&(localStorage.setItem(we.m.schoolID,e),c(e),D.y(D.z.internalNavigation,{origin_school:o,destination_school_id:e,origin_id:"school_selector"}),p("".concat(Ce.f.dashboard,"/").concat(e))),h()};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(ze,{icon:(0,P.jsx)(Ze.Z,{}),label:r,tooltipTitle:"Click to Select School",clickable:!0,onClick:e=>{u(e.currentTarget)},"aria-controls":open?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":open?"true":void 0}),(0,P.jsx)(je.Z,{anchorEl:d,open:Boolean(d),onClose:h,MenuListProps:{"aria-labelledby":"basic-button"},children:(0,P.jsx)(Se.Z,{dense:!0,children:a.map(((e,t)=>(0,P.jsx)(K.Z,{onClick:x(e.school_id),children:e.name},t)))})})]})};var Te=o(2826);const Ae={title:"Explanation of the US Air Quality Index (AQI)",subtitle:"CITIESair uses the <a href='https://www.airnow.gov/aqi/aqi-basics/'>Air Quality Index (AQI)</a> developed by the United States Environmental Protection Agency (EPA) to effectively communicate different levels of PM2.5 air pollution. To calculate the AQI from the raw measurement of PM2.5 concentration (\xb5g/m\xb3), different breakpoints and piecewise linear function are utilized (read more <a href='https://en.wikipedia.org/wiki/Air_quality_index#United_States'>here</a>). Higher AQI values correspond to poorer air quality and greater heath risks to humans.<br><br>The US EPA sets thresholds for PM2.5 concentration: <sup>[1]</sup><ul><li><b>Annual average</b>: 12.0 \xb5g/m\xb3, corresponding to US AQI <b>50</b></li><li><b>24-hour average</b>: 35.0 \xb5g/m\xb3, corresponding to US AQI <b>100</b></li></ul>In 2021, the World's Heath Organization (WHO) proposed a new guideline for PM2.5<sup>[2]</sup> with stricter thresholds than those of the US EPA:<ul><li><b>Annual average</b>: 5.0 \xb5g/m\xb3, corresponding to US AQI <b>21</b></li><li><b>24-hour average</b>: 15.0 \xb5g/m\xb3, corresponding to US AQI <b>56</b></li></ul>",reference:'[1] "National Ambient Air Quality Standards (NAAQS) for PM." EPA, Environmental Protection Agency, https://www.epa.gov/pm-pollution/national-ambient-air-quality-standards-naaqs-pm.<br>[2] World Health Organization. "WHO global air quality guidelines: particulate matter (PM2. 5 and PM10), ozone, nitrogen dioxide, sulfur dioxide and carbon monoxide: executive summary." (2021).'};var De=o(1781),Ie=o(445),Pe=(o(8518),o(6459));const ze=e=>{const{tooltipTitle:t,label:o,...n}=e;return(0,P.jsx)(u.Z,{title:t,enterDelay:0,leaveDelay:200,children:(0,P.jsx)(h.Z,{size:"small",label:o||(0,P.jsx)(p.Z,{variant:"text",sx:{minWidth:"5rem"}}),...n})})},Ee=e=>{var t;let{themePreference:o,schoolMetadata:i,currentData:r,dashboardData:u,fetchDataForDashboard:h,temperatureUnitPreference:S}=e;const[Z,w,C,k]=(0,n.useContext)(a.F);let T;const{user:A}=(0,n.useContext)(De.S),[F,L,N]=(0,n.useContext)(Ie.c),[B,Q]=(0,n.useState)(!1),[U,H]=(0,n.useState)(!1),[q,V]=(0,n.useState)({});(0,n.useEffect)((()=>{if("nyuad"===(null===i||void 0===i?void 0:i.school_id))return Q(!0),void H(!0);Q(!1),H(!1)}),[i]),(0,n.useEffect)((()=>{B&&null===F&&L().then((e=>{N(e)}))}),[B]),(0,n.useEffect)((()=>{if(null===u||void 0===u||!u.charts)return;const e=null===u||void 0===u?void 0:u.charts.map(((e,t)=>({chartTitle:e.title,chartID:"chart-".concat(t+1)})));k(e)}),[u]),(0,n.useEffect)((()=>{if(!r)return;const e=r.filter((e=>e&&e.sensor)).reduce(((e,t)=>(e[t.sensor.location_short]={location_type:t.sensor.location_type,location_short:t.sensor.location_short,location_long:t.sensor.location_long,last_seen:t.sensor.last_seen.split("T")[0],rawDatasets:Object.keys(oe.M$).reduce(((e,t)=>(e[oe.M$[t]]={sample:null,full:null},e)),{})},e)),{});V(e)}),[r]);const G=(0,y.Z)(),Y=()=>{var e,t;return(0,P.jsxs)(x.ZP,{container:!0,spacing:1,sx:{mt:-3,pb:3},children:[(0,P.jsx)(x.ZP,{item:!0,children:(0,P.jsx)(ke,{currentSchoolID:null===i||void 0===i?void 0:i.school_id,currentSchoolName:null===i||void 0===i?void 0:i.name,allowedSchools:A.allowedSchools,fetchDataForDashboard:h})}),(0,P.jsx)(x.ZP,{item:!0,children:(0,P.jsx)(ze,{icon:(0,P.jsx)(M.Z,{}),label:null===i||void 0===i?void 0:i.contactPerson,tooltipTitle:"Contact Person"})}),(0,P.jsx)(x.ZP,{item:!0,children:(0,P.jsx)(ze,{icon:(0,P.jsx)(_.Z,{}),label:null===i||void 0===i?void 0:i.contactEmail,tooltipTitle:"Contact Email",component:"a",href:"mailto:".concat(null===i||void 0===i?void 0:i.contactEmail),clickable:!0})}),(0,P.jsx)(x.ZP,{item:!0,children:(0,P.jsx)(ze,{icon:(0,P.jsx)(R.Z,{}),label:"".concat((null===u||void 0===u||null===(e=u.charts)||void 0===e?void 0:e.length)||"..."," Chart").concat(1!==(null===u||void 0===u||null===(t=u.charts)||void 0===t?void 0:t.length)?"s":""),tooltipTitle:"Number of Charts",onClick:()=>{var e;(0,xe.Qj)(E.O3.id),D.y(D.z.internalNavigation,{destination_id:E.O3.id,destination_label:null===(e=E.dashboardData)||void 0===e?void 0:e.toString(),origin_id:"chip"})}})}),T,!0===B&&null!==F&&(0,P.jsx)(x.ZP,{item:!0,children:(0,P.jsx)(ze,{icon:(0,P.jsx)(O.Z,{}),label:"".concat(F[d.Hf]," Comment").concat(F[d.Hf]>1?"s":""),tooltipTitle:"Number of Comments",onClick:()=>{(0,xe.Qj)(E.Sf.id),D.y(D.z.internalNavigation,{destination_id:E.Sf.id,destination_label:E.Sf.toString(),origin_id:"chip"})}})})]})};return(0,P.jsxs)(m.Z,{width:"100%",children:[(0,P.jsx)(z,{themePreference:o}),(0,P.jsx)(be.Z,{backgroundColor:"customAlternateBackground",children:(0,P.jsxs)(g.Z,{sx:{pt:5},children:[(0,P.jsx)(c.Z,{text:(()=>{if(null!==i&&void 0!==i&&i.school_id)return"Air Quality | ".concat(null===i||void 0===i?void 0:i.school_id)})()}),(0,P.jsx)(Y,{})]})}),!0===U&&(0,P.jsx)(Pe.Z,{initialNyuadCurrentData:r,isOnBannerPage:!1,themePreference:o,minMapHeight:"250px"}),(0,P.jsx)(be.Z,{backgroundColor:"customAlternateBackground",children:(0,P.jsxs)(g.Z,{sx:{pt:3,pb:3},children:[!1===U&&(0,P.jsx)(m.Z,{textAlign:"center",sx:{mb:2},children:(0,P.jsx)(ye.Z,{currentSensorsData:r,isScreen:!1,temperatureUnitPreference:S})}),(0,P.jsx)(v.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{textAlign:"justify",pb:2,mb:0,"& table *":{color:"".concat(G.palette.text.secondary)}},gutterBottom:!0,children:null!==u&&void 0!==u&&u.description?(0,l.ZP)((null===u||void 0===u?void 0:u.description)||"",{replace:W.T}):Array.from({length:3}).map(((e,t)=>(0,P.jsx)(p.Z,{variant:"text"},t)))}),(0,P.jsxs)(f.Z,{direction:"row",spacing:2,children:[(0,P.jsx)(fe,{schoolID:null===i||void 0===i?void 0:i.school_id,screens:null===i||void 0===i?void 0:i.screens}),(0,P.jsx)(ie,{schoolID:null===i||void 0===i?void 0:i.school_id,initialSensorList:q})]}),(0,P.jsx)(Te.Z,{title:Ae.title,content:(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(I.default,{themePreference:o}),(0,P.jsx)(v.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{mt:2},children:(0,l.ZP)(Ae.subtitle,{replace:W.T})}),(0,P.jsx)(Te.Z,{title:"Reference",content:(0,P.jsx)(v.Z,{variant:"caption",color:"text.secondary",children:(0,l.ZP)(Ae.reference,{replace:W.T})})})]})})]})}),(0,P.jsx)(m.Z,{id:E.O3.id,children:null!==u&&void 0!==u&&u.charts?null===u||void 0===u||null===(t=u.charts)||void 0===t?void 0:t.map(((e,t)=>(0,P.jsx)(be.Z,{backgroundColor:t%2!=0&&"customAlternateBackground",children:(0,P.jsxs)(g.Z,{sx:{pt:4,pb:4},height:"auto",className:o===j.Z.dark?"dark":"",id:"chart-".concat(t+1),children:[(0,P.jsxs)(v.Z,{variant:"h6",color:"text.primary",children:[t+1,". ",e.title]}),(0,P.jsx)(s.Z,{generalChartSubtitle:e.subtitle,generalChartReference:e.reference,chartData:{chartIndex:t,...e}})]})},t))):(0,P.jsx)(ne.Z,{optionalText:"Loading Dashboard"})}),(0,P.jsx)(b.Z,{}),!0===B&&(0,P.jsx)(be.Z,{id:E.Sf.id,sx:{pt:3,pb:4},children:(0,P.jsx)(d.ZP,{pageID:d.Hf})})]})},Me=e=>{let{themePreference:t,temperatureUnitPreference:o}=e;const{school_id_param:l}=(0,i.UO)(),s=(0,i.s0)();(0,n.useEffect)((()=>{l&&(document.title="CITIESair | ".concat(l.toUpperCase()))}),[l]);const[c,d,u,h]=(0,n.useContext)(a.F);(0,n.useEffect)((()=>{d(Ce.f.dashboard)}),[]);const{user:p}=(0,n.useContext)(De.S),x={},[m,g]=(0,n.useState)(x),[v,f]=(0,n.useState)(null),[b,y]=(0,n.useState)({});(0,n.useEffect)((()=>{if("nyuad"===l)return void j("nyuad");!0===p.checkedAuthentication&&!1===p.authenticated&&s("/login");const e=p.allowedSchools;if(Array.isArray(e)&&e.length>0){if(!l){let t;const o=localStorage.getItem(we.m.schoolID);e.map((e=>e.school_id)).includes(o)?t=o:(t=e[0].school_id,localStorage.setItem(we.m.schoolID,t)),0!==Object.keys(m).length&&v&&0!==Object.keys(b).length||j(t),s(t,{replace:!0})}if(e.map((e=>e.school_id)).includes(l))return j(l),void localStorage.setItem(we.m.schoolID,l)}}),[p,l]);const j=async e=>{try{const t=(0,oe.kG)({endpoint:oe.Cq.schoolmetadata,school_id:e});g(x),f(null),y({...b,charts:null});const o=(0,oe.kG)({endpoint:oe.Cq.current,school_id:e}),n=await Promise.all([(0,r.m)({url:t,extension:"json",needsAuthorization:!0}),(0,oe.mQ)(o)]),i=n[0],a=n[1];g(i),f(a)}catch(o){console.log(o)}const t=(0,oe.kG)({endpoint:oe.Cq.chartdata,school_id:e});(0,r.m)({url:t,extension:"json",needsAuthorization:!0}).then((e=>{y(e)})).catch((e=>{console.log(e)}))};return(0,P.jsx)(P.Fragment,{children:(0,P.jsx)(Ee,{themePreference:t,schoolMetadata:m,currentData:v,dashboardData:b,fetchDataForDashboard:j,temperatureUnitPreference:o})})}},2826:(e,t,o)=>{"use strict";o.d(t,{Z:()=>g});var n=o(2791),i=o(6934),r=o(911),a=o(5818),l=o(3721),s=o(697),c=o(68),d=o(890),u=o(6935),h=o(7438),p=o(184);const x=(0,i.ZP)(r.Z)((e=>{let{theme:t,expanded:o}=e;return{color:t.palette.text.secondary,backgroundImage:"none",backgroundColor:o?t.palette.background.default:"transparent",boxShadow:o?t.shadows:"none",transition:"none"}})),m=(0,i.ZP)(a.Z)((e=>{let{theme:t,expanded:o}=e;return{marginTop:o?t.spacing(3):0,flexDirection:"row-reverse",paddingLeft:o?t.spacing(1):0,"& .MuiTypography-root":{color:t.palette.text.primary,textDecoration:"underline",transition:"none","&:hover":{color:t.palette.primary.main}}}})),g=e=>{let{title:t,content:o}=e;const[i,r]=(0,n.useState)(void 0);return(0,p.jsx)(s.Z,{children:(0,p.jsxs)(x,{expanded:"panel1"===i,onChange:(a="panel1",(e,o)=>{r(o?a:void 0),h.y(o?h.z.expandSection:h.z.collapseSection,{section:t})}),transitionDuration:0,children:[(0,p.jsx)(m,{expanded:i,expandIcon:(0,p.jsx)(u.Z,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,p.jsx)(c.Z,{title:i?"Click to collapse":"Click to expand",enterDelay:0,leaveDelay:200,children:(0,p.jsx)(d.Z,{component:"a",variant:"body2",children:t})})}),(0,p.jsx)(l.Z,{children:o})]})});var a}},6598:(e,t,o)=>{var n={"./AirQualityIndexTable":8416,"./AirQualityIndexTable.jsx":8416,"./ChartSubstituteComponentLoader":5276,"./ChartSubstituteComponentLoader.jsx":5276};function i(e){return Promise.resolve().then((()=>{if(!o.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o(n[e])}))}i.keys=()=>Object.keys(n),i.id=6598,e.exports=i}}]);
//# sourceMappingURL=675.a674abf8.chunk.js.map