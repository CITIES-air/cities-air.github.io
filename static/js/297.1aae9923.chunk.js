"use strict";(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[297],{7009:(e,t,r)=>{r.d(t,{Z:()=>f});var n=r(72791),o=r(66934),a=r(40911),i=r(55818),s=r(3721),l=r(697),c=r(20068),d=r(20890),u=r(26759),h=r(25878),p=r(47438),m=r(80184);const x=(0,o.ZP)(a.Z)((e=>{let{theme:t,expanded:r}=e;return{color:t.palette.text.secondary,backgroundImage:"none",backgroundColor:r?t.palette.background.default:"transparent",boxShadow:r?t.shadows:"none",transition:"none"}})),g=(0,o.ZP)(i.Z)((e=>{let{theme:t,expanded:r}=e;return{marginTop:r?t.spacing(3):0,flexDirection:"row-reverse",paddingLeft:r?t.spacing(1):0,"& .MuiTypography-root":{color:t.palette.text.primary,textDecoration:"underline",transition:"none","&:hover":{color:t.palette.primary.main}}}})),v="Click to expand section",b="Click to collapse section",f=e=>{let{title:t,content:r}=e;const[o,a]=(0,n.useState)(void 0);return(0,m.jsx)(l.Z,{children:(0,m.jsxs)(x,{expanded:"panel1"===o,onChange:(i="panel1",(e,r)=>{a(r?i:void 0),p.y(r?p.z.expandSection:p.z.collapseSection,{section:t})}),transitionDuration:0,children:[(0,m.jsx)(g,{expanded:o,expandIcon:(0,m.jsx)(u.Z,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,m.jsx)(c.Z,{title:o?b:v,enterDelay:0,leaveDelay:200,children:(0,m.jsxs)(d.Z,{component:"a",variant:"body1",children:[t,(0,m.jsx)(h.Z,{sx:{fontSize:"1rem",marginLeft:"0.25rem"}})]})})}),(0,m.jsx)(s.Z,{children:r})]})});var i}},73194:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Wt});var n=r(72791),o=r(57689),a=r(78914),i=r(75973),s=r(53540),l=r(66934),c=r(697),d=r(25228),u=r(95193),h=r(43896),p=r(20890),m=r(26084),x=r(36314),g=r(61889),v=r(13967),b=r(68096),f=r(99321),y=r(5022),S=r(94454),j=r(19055),w=r(9955),D=r(81918),Z=r(3746),C=r(80184);const k="Display All Series",A=48,T=8;function I(e){const{items:t,selectorID:r,allowMultiple:o,onSeriesSelection:a,displayChip:i=!0}=e,s=(0,v.Z)(),l={PaperProps:{style:{maxHeight:5.55*A+T,overflow:"visible !important",background:s.palette.customAlternateBackground}},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},getContentAnchorEl:null},[c,d]=(0,n.useState)(t),[u,h]=(0,n.useState)(o);(0,n.useEffect)((()=>{d(t)}),[t]),(0,n.useEffect)((()=>{h(c.every((e=>e.selected)))}),[c]);const m=e=>{const{target:{value:t}}=e;if(t.includes(k)){const e=c.map(((e,t)=>({...e,selected:0==t||!u})));a(e),h(!u)}else{const e=c.filter((e=>t.includes(e.label))),r=c.map((t=>({...t,selected:e.some((e=>e.label===t.label))})));a(r),h(!1)}},I=e=>{const t=c.map((t=>t.label===e.label?{...t,selected:!t.selected}:t));a(t)};return(0,C.jsxs)(x.Z,{spacing:1,direction:"row",alignItems:"center",children:[(0,C.jsx)(b.Z,{sx:{[s.breakpoints.down("sm")]:{width:"100%"},minWidth:"200px","& .MuiInputBase-root":{borderRadius:"".concat(s.shape.borderRadius,"px")}},size:"small",children:(0,C.jsxs)(f.Z,{labelId:"".concat(r,"-label"),id:r,multiple:o,value:c.filter((e=>e.selected)).map((e=>e.label)),onChange:m,MenuProps:l,renderValue:e=>(e=>(0,C.jsxs)(x.Z,{direction:"row",alignItems:"center",spacing:.5,children:[(0,C.jsx)(Z.Z,{fontSize:"1.5rem",sx:{color:s.palette.text.secondary}}),(0,C.jsx)(p.Z,{variant:"caption",color:"text.secondary",children:o?"".concat(e.length,"/").concat(c.length," series displayed"):e})]}))(e),sx:{fontSize:"0.75em"},children:[c.map((e=>(0,C.jsxs)(y.Z,{disabled:!(1!==c.filter((e=>e.selected)).length||!e.selected),value:e.label,sx:{backgroundColor:"unset !important","&:hover":{backgroundColor:"inherit !important"}},children:[o?(0,C.jsx)(S.Z,{checked:e.selected,onClick:()=>I(e),sx:{p:.25,transform:"scale(0.8)"}}):(0,C.jsx)(j.Z,{checked:e.selected,onChange:()=>m(e),sx:{p:.25,transform:"scale(0.8)"}}),(0,C.jsx)(p.Z,{variant:"caption",children:e.label})]},e.label))),o&&(0,C.jsx)(y.Z,{value:k,sx:{borderTop:"solid 0.5px",borderColor:s.palette.text.secondary,position:"sticky",bottom:0,zIndex:99999,marginBottom:s.spacing(-1),background:s.palette.customAlternateBackground,"&:hover":{background:s.palette.customAlternateBackground}},children:(0,C.jsxs)(x.Z,{direction:"row",width:"100%",alignItems:"center",justifyContent:"space-between",children:[(0,C.jsx)(p.Z,{fontWeight:500,variant:"caption",sx:{pl:1},children:k}),(0,C.jsx)(w.Z,{checked:u,onClick:()=>I(k),sx:{transform:"scale(0.8)"}})]})},k)]})}),i&&o&&(0,C.jsx)(g.ZP,{container:!0,spacing:1,sx:{[s.breakpoints.down("sm")]:{display:"none"}},children:c.filter((e=>e.selected)).map((e=>(0,C.jsx)(g.ZP,{item:!0,children:(0,C.jsx)(D.Z,{label:(0,C.jsx)(p.Z,{variant:"caption",children:e.label}),size:"small",...1!==c.filter((e=>e.selected)).length&&{onDelete:()=>I(e)}})},e.label)))})]})}const P={CategoryFilter:{position:"top",stackDirection:"column"},DateRangeFilter:{position:"bottom",stackDirection:"column-reverse"},ChartRangeFilter:{position:"bottom",stackDirection:"column-reverse"},NumberRangeFilter:{position:"top",stackDirection:"column"}},z=e=>({min:e.reduce(((e,t)=>t<e?t:e)),max:e.reduce(((e,t)=>t>e?t:e))}),E=e=>({min:Math.min(...e),max:Math.max(...e)}),R=()=>Math.random().toString(36).substr(2,9),M={stem:{length:0},textStyle:{opacity:0},boxStyle:null},W=e=>{let{isPortrait:t,isSmaller:r}=e;return r?t?6:8:t?8:10},O=e=>{var t,r,n,o,a,i,s,l,c,d,u,h,p,m,x,g,v,b,f,y,S,j,w,D,Z,C,k,A,T,I,P,z,E,R,O,L,_,B,N,F,H,Q,U,q;const{chartData:Y,subchartIndex:V,isPortrait:G,isHomepage:$,theme:X}=e,J={italic:!1,bold:!0,color:X.palette.chart.axisTitle,fontSize:W({isPortrait:G})},K={color:X.palette.chart.axisText,fontSize:W({isPortrait:G})};let ee=null!==(t=Y.subcharts)&&void 0!==t&&t[V].options?{...Y.subcharts[V].options}:{};if(ee={...ee,...Y.options,theme:"material",curveType:ee.curveType||(null===(r=Y.options)||void 0===r?void 0:r.curveType)||"function",crosshair:{orientation:"both",trigger:"focus",opacity:.5},backgroundColor:{fill:"transparent"},chartArea:{...null===(n=Y.options)||void 0===n?void 0:n.chartArea,width:G?(null===(o=Y.options)||void 0===o||null===(a=o.chartArea)||void 0===a||null===(i=a.width)||void 0===i?void 0:i.portrait)||"80%":(null===(s=Y.options)||void 0===s||null===(l=s.chartArea)||void 0===l||null===(c=l.width)||void 0===c?void 0:c.landscape)||"75%",height:G?(null===(d=Y.options)||void 0===d||null===(u=d.chartArea)||void 0===u||null===(h=u.height)||void 0===h?void 0:h.portrait)||"60%":(null===(p=Y.options)||void 0===p||null===(m=p.chartArea)||void 0===m||null===(x=m.height)||void 0===x?void 0:x.landscape)||"70%"},width:G?(null===(g=Y.options)||void 0===g||null===(v=g.width)||void 0===v?void 0:v.portrait)||"100%":(null===(b=Y.options)||void 0===b||null===(f=b.width)||void 0===f?void 0:f.landscape)||"100%",height:Y.height||"100%",tooltip:{isHtml:!0,showColorCode:!1},legend:{alignment:G?"center":"start",position:null!==(y=null===(S=Y.options)||void 0===S||null===(j=S.legend)||void 0===j?void 0:j.position)&&void 0!==y?y:G?"top":"right",scrollArrows:{activeColor:X.palette.chart.axisTitle,inactiveColor:X.palette.text.secondary},pagingTextStyle:{fontSize:10,color:X.palette.chart.axisTitle,bold:!0}}},ee.vAxis={...ee.vAxis,format:null!==(w=null===(D=ee.vAxis)||void 0===D?void 0:D.format)&&void 0!==w?w:"decimal",title:null!==(Z=null===(C=ee.vAxis)||void 0===C?void 0:C.title)&&void 0!==Z?Z:"",viewWindow:{min:null!==(k=null===(A=ee.vAxis)||void 0===A||null===(T=A.viewWindow)||void 0===T?void 0:T.min)&&void 0!==k?k:0,max:null!==(I=null===(P=ee.vAxis)||void 0===P||null===(z=P.viewWindow)||void 0===z?void 0:z.max)&&void 0!==I?I:null}},ee.hAxis={...ee.hAxis,title:null!==(E=null===(R=ee.hAxis)||void 0===R?void 0:R.title)&&void 0!==E?E:""},G&&(ee.hAxis={...ee.hAxis,slantedText:!0,slantedTextAngle:30}),"string"!==typeof ee.colors&&ee.colors||(ee.colors=X.palette.chart.optionsColors[ee.colors||"multiColor"]),ee.series&&Object.values(ee.series).forEach((e=>{const t=e;"default"===t.color&&(t.color=X.palette.primary.main)})),ee.trendlines&&ee.trendlines.forEach((e=>{e.color=X.palette.primary.main})),ee.colorAxis)switch(ee.colorAxis.colors){case"matchingColor":ee.colorAxis.colors=[X.palette.chart.colorAxisFirstColor,X.palette.chart.optionsColors.multiColor[ee.colorAxis.colorIndex]];break;case"default":ee.colorAxis.colors=[X.palette.chart.colorAxisFirstColor,X.palette.NYUpurple];break;case"aqi":ee.colorAxis=X.palette.chart.aqiColorAxis}return ee.vAxis={...ee.vAxis,titleTextStyle:J,textStyle:K,gridlines:{...null===(O=ee.vAxis)||void 0===O?void 0:O.gridlines,color:(null===(L=ee.vAxis)||void 0===L||null===(_=L.gridlines)||void 0===_?void 0:_.color)||X.palette.chart.gridlines},minorGridlines:{count:0}},ee.hAxis={...ee.hAxis,titleTextStyle:J,textStyle:K,gridlines:{...null===(B=ee.hAxis)||void 0===B?void 0:B.gridlines,color:(null===(N=ee.hAxis)||void 0===N||null===(F=N.gridlines)||void 0===F?void 0:F.color)||X.palette.chart.gridlines},minorGridlines:{...null===(H=ee.hAxis)||void 0===H?void 0:H.minorGridlines,color:(null===(Q=ee.hAxis)||void 0===Q||null===(U=Q.gridlines)||void 0===U?void 0:U.color)||X.palette.chart.gridlines}},ee.legend={...ee.legend,textStyle:K},ee.annotations={...ee.annotations,highContrast:!0,textStyle:{color:X.palette.primary.contrastText,fontSize:W({isPortrait:G,isSmaller:!0}),opacity:.8},stem:{...null===(q=ee.annotations)||void 0===q?void 0:q.stem,color:X.palette.chart.axisTitle,thickness:2},boxStyle:{rx:X.shape.borderRadius,ry:X.shape.borderRadius,fill:X.palette.chart.annotationBoxFill,fillOpacity:.5}},$&&(ee={...ee,chartArea:{...ee.chartArea,width:"80%",height:"80%"},seriesSelector:!1,pointSize:0,enableInteractivity:!1,annotations:M,legend:"none",vAxis:{...ee.vAxis,textPosition:"none",titleTextStyle:{...ee.vAxis.titleTextStyle,bold:!1},gridlines:{color:"transparent",count:0},viewWindowMode:"maximized"},hAxis:{...ee.hAxis,textPosition:"none",gridlines:{color:"transparent",count:0},titleTextStyle:{...ee.hAxis.titleTextStyle,bold:!1}}}),ee},L=e=>{const t=B({cellSizeMin:14,cellSizeMax:18});return{...e,width:t.chartWidth,calendar:{cellSize:t.cellSize,yearLabel:{fontSize:t.yearLabelFontSize}},noDataPattern:{backgroundColor:"none",color:"none"}}},_=e=>{var t;const{chartControl:r,mainChartData:n,mainChartOptions:o,subchartIndex:a,theme:i,isPortrait:s}=e;let l={...null===(t=r.options)||void 0===t?void 0:t.ui,snapToData:!0};return"ChartRangeFilter"===r.controlType&&(l={...l,chartType:n.chartType,chartView:{columns:n.columns||n.subcharts&&n.subcharts[a].columns||null},chartOptions:{...o,hAxis:{...o.hAxis,textPosition:"out",textStyle:{color:i.palette.chart.axisText,fontSize:W({isPortrait:s,isSmaller:!0})},title:null},vAxis:{...o.vAxis,title:null},annotations:M,legend:null}}),l},B=e=>{let{cellSizeMin:t,cellSizeMax:r}=e;const n=Math.min(Math.max(.9*window.innerWidth/58,t),r);return{chartWidth:56*n,cellSize:n,yearLabelFontSize:2*n}},N=e=>{let{controlWrapper:t,chartID:r}=e;const n=e=>{var t=e.changedTouches[0],r="";switch(e.type){case"touchstart":r="mousedown";break;case"touchmove":r="mousemove";break;case"touchend":r="mouseup";break;default:return}var n=new MouseEvent(r,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,button:0,relatedTarget:null});t.target.dispatchEvent(n),e.preventDefault()};let o=!0;if(!t)return;const a=document.querySelector("#control-".concat(r));return a?(["touchstart","touchmove","touchend","touchcancel"].forEach((e=>{a.addEventListener(e,n,{capture:!0})})),()=>{o=!1,["touchstart","touchmove","touchend","touchcancel"].forEach((e=>{a.removeEventListener(e,n,{capture:!0})}))}):void 0},F=(0,l.ZP)(c.Z)((e=>{let{theme:t,isPortrait:r}=e;return{"& .google-visualization-tooltip, .nivo-tooltip":{width:"unset !important",maxWidth:"350px",height:"unset",padding:"1em",boxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",mozBoxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",webkitBoxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",border:"solid 1px",borderColor:t.palette.text.secondaryRGB,fontSize:"".concat(r?9:12,"px"),color:t.palette.chart.tooltip.text,background:t.palette.chart.tooltip.background,borderRadius:t.shape.borderRadius,"& ul":{margin:"0 !important","& li":{margin:"0 !important",padding:"0 !important","& span":{fontSize:"".concat(r?9:12,"px !important"),color:"".concat(t.palette.chart.tooltip.text," !important")}}}},"& .goog-menuitem-highlight, .goog-menuitem-hover":{backgroundColor:"".concat(t.palette.primary," !important")},"& .google-visualization-controls-categoryfilter":{fontSize:"0.85rem",marginTop:"0.75rem",marginBottom:"-0.75rem","& .goog-inline-block > .goog-menu-button":{marginTop:0},"& .goog-menu-button-hover .goog-menu-button-outer-box, .goog-menu-button-hover .goog-menu-button-inner-box":{borderColor:"inherit !important"},"& .google-visualization-controls-label":{color:t.palette.text.secondary,fontWeight:500,verticalAlign:"middle",marginBottom:"0.25rem"},"& .goog-menu-button-outer-box":{backgroundColor:t.palette.background.paper,border:"unset","& .goog-menu-button-inner-box":{paddingTop:t.spacing(.5),paddingBottom:t.spacing(.5),paddingLeft:t.spacing(2),paddingRight:t.spacing(2),border:"solid",borderWidth:"0.5px",borderRadius:t.shape.borderRadius,borderColor:t.palette.text.secondary,"& .goog-menu-button-caption":{color:t.palette.text.secondary}}}},"& .google-visualization-controls-rangefilter":{width:"100%",fontSize:"0.75rem","& .goog-inline-block":{width:"100%"},"& .google-visualization-controls-slider-horizontal":{width:"90%",margin:"0 5%"},"& .google-visualization-controls-rangefilter-thumblabel:nth-of-type(1)":{position:"absolute",top:"1.5em",left:"5%"},"& .google-visualization-controls-rangefilter-thumblabel:nth-of-type(2)":{position:"absolute",top:"1.5em",right:"5%"},"& .google-visualization-controls-slider-handle":{background:t.palette.primary.main},"& .google-visualization-controls-rangefilter-thumblabel":{color:t.palette.text.secondary,padding:0,fontWeight:500},"& .google-visualization-controls-slider-thumb":{background:t.palette.primary.main,border:"unset",borderRadius:t.shape.borderRadius}},'& path[stroke-opacity="0.3"], path[stroke-opacity="0.1"], path[stroke-opacity="0.05"], rect[stroke-opacity]':{stroke:t.palette.text.primary,strokeWidth:3},"& [column-id]:not(:empty)":{cursor:"pointer",":hover":{fontWeight:600}}}}));var H=r(6694),Q=r(18970),U=r(69755);const q=40,Y=e=>e?{top:20,right:0,bottom:0,left:20}:{top:30,right:40,bottom:0,left:40},V=e=>{var t,r,n,o,a,i,s;const{data:l,dateRange:c,valueRange:d,isPortrait:u,options:h}=e,p=Y(u),m=(0,v.Z)(),x=(e,t)=>{const r=new Date(e),n=r.getDay(),o=0===n||1===n,a=new Date(t.min).getFullYear(),i=r.getFullYear()===a;return o&&i},g=null!==h&&void 0!==h&&null!==(t=h.colorAxis)&&void 0!==t&&t.isGradient?X(null===h||void 0===h||null===(r=h.colorAxis)||void 0===r?void 0:r.colors[0],null===h||void 0===h||null===(n=h.colorAxis)||void 0===n?void 0:n.colors[1],100):null===h||void 0===h||null===(o=h.colorAxis)||void 0===o?void 0:o.colors;return(0,C.jsxs)(C.Fragment,{children:["none"!==(null===h||void 0===h||null===(a=h.legend)||void 0===a?void 0:a.position)&&(()=>{var e;return(0,C.jsx)($,{valueRange:d,colors:null===h||void 0===h||null===(e=h.colorAxis)||void 0===e?void 0:e.colors,isPortrait:u})})(),(0,C.jsx)(Q.DQ,{data:l,from:null===c||void 0===c?void 0:c.min,to:null===c||void 0===c?void 0:c.max,emptyColor:"transparent",theme:{text:{fill:m.palette.text.secondary},fontSize:"0.75rem",tooltip:{container:{background:"dark"===m.palette.mode?"#2b2b2b":"#fff",color:m.palette.text.primary}},axis:{ticks:{line:{stroke:"dark"===m.palette.mode?"#2b2b2b":"#fff"},text:{fill:m.palette.text.primary}}},grid:{line:{stroke:"dark"===m.palette.mode?"#2b2b2b":"#fff"}}},colors:g,minValue:null===h||void 0===h||null===(i=h.colorAxis)||void 0===i?void 0:i.minValue,maxValue:null===h||void 0===h||null===(s=h.colorAxis)||void 0===s?void 0:s.maxValue,margin:p,yearSpacing:q,monthBorderColor:m.palette.text.primary,monthBorderWidth:1,daySpacing:.25,dayBorderWidth:0,tooltip:e=>{let{day:t,value:r,color:n}=e;const o=l.find((e=>e.day===t)),a=o?(i=o.tooltip,(new DOMParser).parseFromString(i,"text/html").body.innerHTML):"";var i;return(0,C.jsx)(G,{day:t,color:n,tooltipText:a,dateRange:c,inFirstTwoRowsOfChart:x})}})]})},G=e=>{let{day:t,color:r,tooltipText:o,dateRange:a,inFirstTwoRowsOfChart:i}=e;const l=(0,n.useRef)(null);return(0,n.useEffect)((()=>{if(l.current&&i(t,a)){const e=l.current.parentElement;e&&(e.style.top="11vh")}}),[l,i]),(0,C.jsxs)(c.Z,{ref:l,className:"nivo-tooltip",children:[(0,C.jsx)(D.Z,{sx:{backgroundColor:r,mr:.5,height:"10px",width:"10px",borderRadius:"50%"}}),(0,s.ZP)(o,{replace:U.T})]})},$=e=>{let{valueRange:t,colors:r,isPortrait:n}=e;if(null===(null===t||void 0===t?void 0:t.min)||null===(null===t||void 0===t?void 0:t.max))return null;const o=(0,v.Z)(),a=r.map(((e,t,r)=>{const n=t/(r.length-1)*100;return"".concat(e," ").concat(n,"%")})).join(", "),i={position:"sticky",width:"fit-content",marginTop:"1rem",left:n?"calc(80dvw - 7rem)":"calc(80% + 1rem)"},s={background:"linear-gradient(to right, ".concat(a,")"),color:o.palette.text.primary,border:"1px solid ".concat(o.palette.text.primary),minWidth:"150px",height:"1.1rem",maxHeight:"1.25rem",display:"flex",justifyContent:"space-between"},l={position:"relative",top:"-1.15rem",fontSize:"0.8rem"};return(0,C.jsx)(c.Z,{style:i,children:(0,C.jsxs)(c.Z,{style:s,children:[(0,C.jsx)("span",{style:l,children:t.min}),(0,C.jsx)("span",{style:l,children:t.max})]})})},X=(e,t,r)=>{function n(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,r,n){return t+t+r+r+n+n}));const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[null,null,null]}function o(e,t,r){return"#"+[e,t,r].map((e=>{const t=e.toString(16);return 1===t.length?"0"+t:t})).join("")}function a(e,t,r){let n=e.slice();for(let o=0;o<3;o++)n[o]=Math.round(n[o]+r*(t[o]-e[o]));return n}let i=n(e),s=n(t),l=[];for(let c=0;c<r;c++){let e=a(i,s,c/(r-1));l.push(o(...e))}return l};var J=r(7161),K=(r(42978),r(666),r(13239)),ee=r(94294),te=r(19658),re=r(35527),ne=r(42755),oe=r(3874),ae=r(4531);const ie={hourly:"hourly",daily:"daily"},se=e=>{let{today:t,minDateOfDataset:r,aggregationType:n}=e;const o=[{label:"Last 14d",range:()=>({startDate:(0,ne.b)((0,oe.E)(t,-14)),endDate:(0,ae.i)(t)})},{label:"Last 30d",range:()=>({startDate:(0,ne.b)((0,oe.E)(t,-30)),endDate:(0,ae.i)(t)})}],a=[{label:"Last 90d",range:()=>({startDate:(0,ne.b)((0,oe.E)(t,-90)),endDate:(0,ae.i)(t)})},{label:"Last 365d",range:()=>({startDate:(0,ne.b)((0,oe.E)(t,-365)),endDate:(0,ae.i)(t)})},{label:"All Time",range:()=>({startDate:r,endDate:(0,ae.i)(t)})}];return n===ie.hourly?o:[...o,...a]},le=(0,l.ZP)(re.Z)((e=>{let{theme:t,showPickerPanel:r,smallScreen:n}=e;return{zIndex:!0===r&&1e3,position:"relative",padding:r?t.spacing(1):0,margin:r&&!n?t.spacing(-1):0,maxWidth:"100%",background:r?t.palette.customAlternateBackground:"transparent",boxShadow:!1===r&&"none","& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary},"& .rdrDateDisplayWrapper, .rdrCalendarWrapper, .rdrDefinedRangesWrapper, .rdrStaticRange, .rdrDateDisplayItem":{background:"transparent"},"& .rdrDateInput":{borderRadius:t.shape.borderRadius,boxShadow:"none"},"& .rdrDateDisplayItemActive":{border:!1===r&&"none"},"& .rdrDateDisplay":{margin:0,minWidth:"20rem"},"& .rdrDateDisplayItem":{margin:0,borderRadius:r?t.shape.borderRadius:0,"&:hover:not(.rdrDateDisplayItemActive)":{border:r?"1px solid ".concat(t.palette.action.disabled):"none"}},"& .rdrDateDisplayItem:hover:not(.rdrDateDisplayItemActive)":{border:!1===r&&"1px solid transparent"},"& .rdrDateDisplayItem + .rdrDateDisplayItem":{margin:0},"& .rdrDateDisplayItem:first-of-type":{borderRight:!1===r&&"1px solid ".concat(t.palette.action.disabled," !important")},"& .rdrMonthAndYearWrapper, .rdrInputRanges":{display:!1===r&&"none !important",padding:0},"& .rdrMonthName":{display:"none"},"& .rdrDefinedRangesWrapper, .rdrMonths":{display:!1===r&&"none"},"&  .rdrInfiniteMonths":{visibility:!1===r&&"hidden",width:"100% !important",maxWidth:"675px",margin:"auto"},"& .rdrDateDisplayWrapper":{minWidth:"18rem",borderRadius:t.shape.borderRadius,border:r?"none":"1px solid ".concat(t.palette.action.disabled),"&:hover":{border:r?"none":"1px solid ".concat(t.palette.text.primary)}},"& .rdrDateRangePickerWrapper":{width:"100%",flexDirection:"column-reverse"},"& .rdrStaticRanges":{flexDirection:"row",minWidth:"21rem"},"& .rdrStaticRangeLabel":{color:t.palette.text.secondary,borderRadius:t.shape.borderRadius,padding:"".concat(t.spacing(.5)," ").concat(t.spacing(1))},"& .rdrDefinedRangesWrapper":{border:"none",width:"100%"},"& .rdrNextPrevButton":{background:t.palette.primary.main,borderRadius:t.shape.borderRadius,opacity:1,"&:hover":{opacity:.5,background:t.palette.primary.main}},"& .rdrNextPrevButton > i":{color:"white"},"& .rdrNextButton > i":{borderColor:"transparent transparent transparent white"},"& .rdrPprevButton > i":{borderColor:"transparent white transparent transparent"},"& .rdrStaticRange":{border:"none"},"& .rdrStaticRangeSelected > .rdrStaticRangeLabel, .rdrMonthAndYearPickers":{color:t.palette.primary.main},"& .rdrMonthAndYearPickers":{fontSize:"1rem"},"& .rdrStaticRange:hover .rdrStaticRangeLabel, .rdrStaticRange:focus .rdrStaticRangeLabel":{background:t.palette.customBackground.toString()},"& .rdrDayNumber span":{color:t.palette.text.primary.toString()},"& .rdrDayPassive .rdrDayNumber span":{opacity:.5},"& .rdrMonthAndYearWrapper select":{color:t.palette.text.secondary.toString(),background:"none",padding:"".concat(t.spacing(1)," ").concat(t.spacing(2)),"&:hover":{border:"1px solid ".concat(t.palette.text.secondary)}},"& .rdrDateDisplayItem input":{color:t.palette.text.secondary},"& .rdrDayDisabled":{backgroundColor:t.palette.customBackground},"& .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfMonth .rdrStartEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge, .rdrEndEdge, .rdrDayEndOfMonth .rdrDayInPreview, .rdrDayEndOfMonth .rdrDayStartPreview, .rdrDayEndOfWeek .rdrDayInPreview, .rdrDayEndOfWeek .rdrDayStartPreview, .rdrDayEndPreview":{borderTopRightRadius:"2rem",borderBottomRightRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfWeek .rdrEndEdge, .rdrDayStartOfMonth .rdrDayInPreview, .rdrDayStartOfMonth .rdrDayEndPreview, .rdrDayStartOfWeek .rdrDayInPreview, .rdrDayStartOfWeek .rdrDayEndPreview, .rdrDayStartPreview":{borderTopLeftRadius:"2rem",borderBottomLeftRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrEndEdge":{left:0},"& .rdrEndEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge":{right:0},"& .rdrSelected, .rdrInRange, .rdrStartEdge, .rdrEndEdge":{top:"0px",bottom:"0px"},"& .rdrMonths":{justifyContent:"center",alignItems:"center"},"& .rdrDay":{marginBottom:"1px","& span":{top:"0px",bottom:"0px"}},"& .rdrMonthsHorizontal":{overflowY:"hidden"},"& .rdrDateInput:first-of-type:before":{content:'""',backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' class='MuiSvgIcon-root' focusable='false' aria-hidden='true' viewBox='0 0 24 24' data-testid='DateRangeIcon'%3E%3Cpath d='M9 11H7v2h2zm4 0h-2v2h2zm4 0h-2v2h2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V9h14z' fill='".concat(t.palette.text.secondary,"'/%3E%3C/svg%3E\")"),width:"0.75rem",height:"0.75rem",display:"block",position:"absolute",top:"50%",transform:"translateY(-50%)",left:"0.75rem"},"& .rdrStaticRangeSelected span":{color:t.palette.primary.main},"& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary.main,width:"0.25rem",height:"0.25rem",borderRadius:"50%"}}}));var ce=r(48206),de=r(77997),ue=r(40630);function he(e){let{aggregationType:t,setAggregationType:r,smallScreen:n}=e;return(0,C.jsxs)(x.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,C.jsx)(p.Z,{variant:"caption",display:"block",color:"text.secondary",children:"DATA AVERAGE"}),(0,C.jsxs)(de.Z,{color:"primary",value:t,exclusive:!0,onChange:(e,t)=>{null!==t&&r(t)},"aria-label":"aggregation type toggle for graph average",size:"small",children:[(0,C.jsx)(ue.Z,{size:"small",sx:{textTransform:"capitalize !important",px:1.25,py:.5},value:ie.hourly,"aria-label":ie.hourly,children:ie.hourly}),(0,C.jsx)(ue.Z,{size:"small",sx:{textTransform:"capitalize !important",px:1.25,py:.5},value:ie.daily,"aria-label":ie.daily,children:ie.daily})]})]})}var pe=r(83165),me=r(2165),xe=r(33026),ge=r(87210);const ve="HOURLY data is limited to max 30d",be="Start and end dates must be different",fe=e=>(0,C.jsx)(te.Z,{severity:"error",sx:{py:.5,px:1,display:"flex",alignItems:"center","& div":{fontSize:"0.75rem",p:0},"& .MuiAlert-icon":{fontSize:"1rem",mr:.5}},children:e}),ye=e=>{const{minDateOfDataset:t}=e,{currentSchoolID:r,chartData:o,setChartData:i}=(0,n.useContext)(pe.G),[s,l]=(0,n.useState)(ie.hourly),c=new Date,[d,h]=(0,n.useState)(),p=(0,v.Z)(),m=(0,u.Z)(p.breakpoints.down("sm")),[g,b]=(0,n.useState)([{...se({today:c,minDateOfDataset:t})[0].range(),key:"selection"}]),[f,y]=(0,n.useState)(),[S,j]=(0,n.useState)(!1),w=(0,n.useRef)(null),[D,Z]=(0,n.useState)(!1);(0,n.useEffect)((()=>{const e=e=>{w.current&&!w.current.contains(e.target)&&j(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[w]);const k=e=>{const{startDate:t,endDate:r}=e;if((0,me.K)(t,r))h(be);else if(h(null),s===ie.hourly){const e=(0,xe.j)(r,t);h(e>30?ve:null)}else null!==d&&h(null)};(0,n.useEffect)((()=>{k(g[0])}),[s]);return(0,C.jsx)(le,{showPickerPanel:S,smallScreen:m,ref:w,elevation:8,onClick:()=>j(!0),children:(0,C.jsxs)(x.Z,{direction:"column",spacing:1,children:[(0,C.jsx)(J.Dw,{ranges:g,onChange:e=>{e&&(k(e.selection),b([e.selection]))},staticRanges:(0,J.$z)(se({today:c,minDateOfDataset:t,aggregationType:s})),inputRanges:[],rangeColors:[p.palette.primary.main,p.palette.secondary.main,p.palette.text.secondary],minDate:t,maxDate:c,months:1,showMonthAndYearPickers:!1,direction:"horizontal",fixedHeight:!0,preventSnapRefocus:!0,calendarFocus:"backwards",startDatePlaceholder:"Start Date",endDatePlaceholder:"End Date",editableDateInputs:!0,showMonthArrow:!0}),S&&(0,C.jsxs)(x.Z,{direction:"column",alignItems:"end",width:"100%",spacing:1,children:[(0,C.jsx)(he,{aggregationType:s,setAggregationType:l,smallScreen:m}),(0,C.jsxs)(x.Z,{direction:"row",spacing:1,children:[d&&fe(d),(0,C.jsx)(ee.Z,{variant:"contained",size:"small",disabled:null!==d,onClick:e=>{if(null!==d)return;e.stopPropagation();const t=(0,ce.kG)({endpoint:ce.Cq.historicalAQI,school_id:r,aggregationType:s,startDate:(0,ge.WU)(g[0].startDate,"yyyy-MM-dd"),endDate:(0,ge.WU)(g[0].endDate,"yyyy-MM-dd")});t!==f&&(Z(!0),(0,a.m)({url:t,extension:"json",needsAuthorization:!0}).then((e=>{const r=[...o.charts];r[0]=e,i({...o,charts:r}),y(t),Z(!1),j(!1)})).catch((e=>{console.log(e)})))},sx:{zIndex:1005,transform:"translateY(-1px)"},children:D?(0,C.jsx)(K.Z,{disableShrink:!0,size:"1.4375rem",color:"inherit"}):"APPLY"})]})]})]})})};function Se(e){var t;const{chartData:r,subchartIndex:o,windowSize:a,isPortrait:i,isHomepage:s,height:l,maxHeight:d}=e,u=r.customClassName?"".concat(r.chartType," ").concat(r.customClassName):r.chartType,h=(0,n.useContext)(m.R),[p,b]=(0,n.useState)(),[f,y]=(0,n.useState)(),[S,j]=(0,n.useState)(),[w,D]=(0,n.useState)(),[Z,k]=(0,n.useState)(),A=(0,v.Z)(),[T,M]=(0,n.useState)(!0),[W,B]=(0,n.useState)(),[Q,U]=(0,n.useState)(),[G,$]=(0,n.useState)(),[X,J]=(0,n.useState)(R()),[K,ee]=(0,n.useState)(200);let te=(0,n.useMemo)((()=>{let t=O({...e,theme:A});return"Calendar"===r.chartType&&(t=L(t)),t}),[e,A,r.chartType]);const[re,ne]=(0,n.useState)(null),[oe,ae]=(0,n.useState)(200),[ie,se]=(0,n.useState)(1200);if("Calendar"===r.chartType)return(0,n.useEffect)((()=>{const e=r.dataArray||r.subcharts&&r.subcharts[o].dataArray||null;if(!e)return;const t=e.map((e=>e.day)),n=e.map((e=>e.value)),a=z(t);ne({data:e,dateRange:a,valueRange:E(n)});const s=new Date(a.min).getFullYear(),l=new Date(a.max).getFullYear()-s+1,c=7*Math.min(ie/60,20),d=Y(i);let u;u=1==l?c+q+d.top+d.bottom:l*(c+q)+d.top+d.bottom,ae(u)}),[r]),(0,C.jsx)(F,{isPortrait:i,className:u,position:"relative",minWidth:"700px",minHeight:i?"200px":oe+"px",height:oe+"px",maxHeight:i&&"550px",children:re?(0,C.jsx)(V,{data:re.data,dateRange:re.dateRange,valueRange:re.valueRange,isPortrait:i,options:te}):(0,C.jsx)(c.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,C.jsx)(H.Z,{})})});let le,ce=!1,de=r.control||(null===(t=r.subcharts)||void 0===t?void 0:t[o].control);de&&!0!==s&&(ce=!0,le={...de.options,ui:_({chartControl:de,mainChartData:r,mainChartOptions:te,subchartIndex:o,theme:A,isPortrait:i})},"ChartRangeFilter"===de.controlType&&(0,n.useEffect)((()=>N({controlWrapper:w,chartID:X})),[w]));const ue=te.seriesSelector||!1,he=te.dateRangePicker||null;(0,n.useEffect)((()=>{ue?xe(Q):(null===f||void 0===f||f.setOptions({...te,..."Calendar"===r.chartType&&{height:K}}),null===f||void 0===f||f.draw(),ce&&(null===w||void 0===w||w.setOptions(le),null===w||void 0===w||w.draw()))}),[A,i,a,K]),(0,n.useEffect)((()=>{Q&&ue&&"setViewColumn"==ue.method&&(pe({dataColumns:Q}),xe(Q))}),[A]);const pe=e=>{let{dataColumns:t}=e;t.forEach((e=>{var t;e.color=te.colors[e.seriesIndex%te.colors.length],e.serieAttribute=null===(t=te.series)||void 0===t?void 0:t[e.seriesIndex]}))},me=e=>{let t,r,{dataTable:n,allInitialColumns:o}=e;return o.forEach(((e,o)=>{if(0===o)return;const a=n.getColumnRange(e.sourceColumn);!isNaN(a.min)&&a.min&&(t=t?Math.min(t,a.min):a.min),!isNaN(a.max)&&a.max&&(r=r?Math.max(r,a.max):a.max)})),{min:t,max:r}},xe=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f;if(W){if(U(e),"toggleVisibility"===ue.method||null===ue.method){const r={};e.forEach((e=>{e.selected||(r[e.seriesIndex]={color:"transparent",enableInteractivity:!1,visibleInLegend:!1})})),null===t||void 0===t||t.setOptions({...te,series:{...te.series,...r}})}else if("setViewColumn"===ue.method){let r=[];r.push(0),e.forEach((e=>{if(e.selected){r.push(e);for(let t=e.indexInAllInitialColumns+1;t<W.length&&"data"!==W[t].role;t++)r.push(W[t])}})),null===t||void 0===t||t.setView({columns:r});const n={...te};n.colors=e.filter((e=>e.selected)).map((e=>e.color));const o={};let a=0;e.forEach((e=>{e.selected&&(null!=e.serieAttribute&&(o[a]=e.serieAttribute),a++)})),n.series=o,null===t||void 0===t||t.setOptions(n)}null===t||void 0===t||t.draw(),ce&&(null===w||void 0===w||w.draw())}};(0,n.useEffect)((()=>{if(h&&r){if(JSON.stringify(r)===JSON.stringify(Z))return;k(r);const e=r.dataArray||r.subcharts&&r.subcharts[o].dataArray||null;if(!e)return;const t=h.visualization.arrayToDataTable(e);b(t);const n=(e=>{if(!e)return;const t=[];for(const r of e)if("number"===typeof r)t.push(r);else if("object"===typeof r)if(r.calc&&"stringify"!==r.calc){const e=new Function("dataTable","rowNum",r.calc);t.push({...r,calc:e})}else t.push(r);return t})(r.columns||r.subcharts&&r.subcharts[o].columns||null),a=new h.visualization.ChartWrapper({chartType:r.chartType,dataTable:ce?void 0:t,options:te,view:{columns:n},containerId:X});if(y(a),ce){const e=new h.visualization.Dashboard(document.getElementById("dashboard-".concat(X)));j(e),h.visualization.events.addListener(e,"ready",ge);const r=new h.visualization.ControlWrapper({controlType:de.controlType,options:le,containerId:"control-".concat(X)});D(r),e.bind(r,a),e.draw(t)}else h.visualization.events.addListener(a,"ready",ge),a.draw();if(ue){const e=(e=>{let{chartWrapper:t,dataTable:r,seriesSelector:n}=e;var o=t.getView();if(null==o.columns){const e=new h.visualization.DataView(r);t.setView({columns:e.columns}),o=t.getView()}let a=!0,i=0;const s=o.columns.map(((e,t)=>("number"===typeof e&&(e={role:a?"domain":"data",sourceColumn:e}),e.label=r.getColumnLabel(e.sourceColumn),e.indexInAllInitialColumns=t,a=a&&!1,"data"===e.role&&(n.defaultSeriesToDisplayInitially?n.defaultSeriesToDisplayInitially.includes(t)?e.selected=!0:e.selected=!1:n.allowMultiple?e.selected=!0:e.selected=0===i,e.seriesIndex=i,i++),e)));B(s);const l=me({dataTable:r,allInitialColumns:s});$(l);const c=s.filter((e=>{var t,r;return"data"===e.role&&!1!==(null===(t=te.series)||void 0===t||null===(r=t[e.seriesIndex])||void 0===r?void 0:r.visibleInLegend)}));return"setViewColumn"===n.method&&pe({dataColumns:c}),U(c),c})({chartWrapper:a,dataTable:t,seriesSelector:ue});xe(e,a)}}}),[h,r]);const ge=()=>{T&&M(!1)};return(0,C.jsxs)(F,{isPortrait:i,className:u,position:"relative",height:"100%",minHeight:"Calendar"===r.chartType&&"200px",children:[T&&(0,C.jsx)(c.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,C.jsx)(H.Z,{})}),T?null:(0,C.jsxs)(g.ZP,{container:!0,mt:1,sx:{gap:2,[A.breakpoints.down("sm")]:{gap:1}},children:[ue&&(0,C.jsx)(g.ZP,{item:!0,sx:{[A.breakpoints.down("sm")]:{width:"100%"}},children:(0,C.jsx)(I,{items:Q,allowMultiple:ue.allowMultiple,selectorID:"".concat(r.title,"-selector"),onSeriesSelection:xe,displayChip:!1})}),he&&(0,C.jsx)(g.ZP,{item:!0,sx:{height:"2rem",width:{[A.breakpoints.down("sm")]:{width:"100%"}}},children:(0,C.jsx)(ye,{minDateOfDataset:new Date(he.minDate)})})]}),(()=>{var e;return ce?(0,C.jsxs)(x.Z,{id:"dashboard-".concat(X),direction:(null===(e=P[de.controlType])||void 0===e?void 0:e.stackDirection)||"column-reverse",sx:{height:"100%"},children:[(0,C.jsx)(c.Z,{id:"control-".concat(X),sx:{height:"calc(".concat(l," / 8)"),opacity:.8,filter:"saturate(0.3)"}}),(0,C.jsx)(c.Z,{id:X,sx:{height:l,maxHeight:d}})]}):(0,C.jsx)(c.Z,{id:X,sx:{height:l,maxHeight:d}})})()]})}var je=r(53767);const we=function(e){let{text:t,wordLimit:r=40,reference:o}=e;const[a,i]=(0,n.useState)(!1),l=(0,v.Z)(),d=(0,u.Z)(l.breakpoints.down("sm")),h=(0,n.useRef)(null),m=t.split(" ");if(!d||m.length/r<=1.4)return(0,C.jsxs)(c.Z,{children:[(0,C.jsx)(p.Z,{children:(0,s.ZP)(t,{replace:U.T})}),o&&(0,C.jsx)(p.Z,{variant:"caption",color:"text.secondary",children:(0,s.ZP)(o,{replace:U.T})})]});let x=m.slice(0,r).join(" ");const g=x.lastIndexOf(".");return-1!==g&&(x=x.slice(0,g+1)),(0,C.jsx)(je.d,{onClickAway:e=>{(e=>{let{target:t}=e;const r=h.current.closest(".MuiContainer-root"),n=new Set(["rect","path","svg","circle"]);for(;null!=t;){if(n.has(t.tagName))return t.closest(".MuiContainer-root")===r;t=t.parentNode}return!1})(e)||i(!1)},children:(0,C.jsx)(c.Z,{ref:h,onClick:()=>i(!a),style:{cursor:"pointer"},children:a?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(p.Z,{children:(0,s.ZP)(t,{replace:U.T})}),o&&(0,C.jsx)(p.Z,{variant:"caption",color:"text.secondary",children:(0,s.ZP)(o,{replace:U.T})})]}):(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(p.Z,{display:"inline",children:[(0,s.ZP)(x,{replace:U.T}),"..."]}),(0,C.jsx)(p.Z,{display:"inline",color:"text.primary",fontWeight:"500",sx:{ml:.5,"& :hover":{textDecoration:"underline"}},children:"See more"})]})})})},De=(0,l.ZP)(c.Z)((e=>{let{theme:t}=e;return{..."dark"===t.palette.mode&&{filter:"saturate(0.85)","& .heat-map-iframe":{filter:"invert(0.848) hue-rotate(180deg)"}},'& .historical-snapshot-aqi svg [clip-path*="ABSTRACT_RENDERER"] > g:nth-of-type(1), .historical-snapshot-aqi [id*="googlechart-control"] svg [clip-path*="ABSTRACT_RENDERER"] > g:nth-of-type(2)':{opacity:.6},"& .Calendar [dir]:not(:empty)":{margin:"auto"},"& .Calendar > div > div:last-of-type > div":{overflowX:"auto",overflowY:"hidden",scrollbarGutter:"stable"}}})),Ze=(0,l.ZP)(d.Z)((e=>{let{theme:t}=e;return{"& .MuiTabScrollButton-root":{color:t.palette.text.primary},"& .MuiTab-root":{[t.breakpoints.down("sm")]:{fontSize:"0.75rem",paddingLeft:t.spacing(1),paddingRight:t.spacing(1)}}}}));const Ce=function(e){const{generalChartSubtitle:t,generalChartReference:r,chartData:o,chartHeight:a,isHomepage:i}=e,s=(0,u.Z)((e=>e.breakpoints.down("sm"))),[l,d]=(0,n.useState)(window.matchMedia("(orientation: portrait)").matches),[m,x]=(0,n.useState)([window.innerWidth,window.innerHeight]);let g,v=a;const b=o,[f,y]=(0,n.useState)(0);(0,n.useEffect)((()=>{y(0);let e=null;const t=()=>{clearTimeout(e),e=setTimeout((()=>{d(window.matchMedia("(orientation: portrait)").matches),x([window.innerWidth,window.innerHeight])}),100)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}}),[b]),"Calendar"===b.chartType||v||(v=l?"80vw":"35vw",g=l?"800px":"500px");const S=(e,t)=>{y(t)};return(0,C.jsxs)(De,{height:"100%",children:[b.subcharts?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(Ze,{value:f,onChange:S,variant:s?"fullWidth":"standard",children:b.subcharts.map(((e,t)=>(0,C.jsx)(h.Z,{value:t,label:b.subcharts[t].subchartTitle},t)))}),(0,C.jsx)(c.Z,{position:"relative",sx:{overflowX:l&&"auto",WebkitOverflowScrolling:l&&"touch",overflowY:"hidden"},children:b.subcharts.map(((e,t)=>(0,C.jsx)(c.Z,{width:"100%",height:"100%",role:"tabpanel",sx:{transition:"0.35s",position:0===t?"":"absolute",opacity:f===t?"1":"0",pointerEvents:f===t?"auto":"none",top:0===t?"":0},children:(0,C.jsx)(Se,{chartData:b,subchartIndex:t,isPortrait:l,isHomepage:i,windowSize:m,height:b.height?b.height:v,maxHeight:["Calendar"].includes(b.chartType)?"":g})},t)))})]}):(0,C.jsx)(Se,{chartData:b,isPortrait:l,isHomepage:i,windowSize:m,height:b.height?b.height:v}),(0,C.jsx)(c.Z,{sx:{my:3},children:(0,C.jsx)(p.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{mb:1},children:(0,C.jsx)(we,{text:(()=>{var e;let r=t||"";return b.subcharts&&null!==(e=b.subcharts[f])&&void 0!==e&&e.subchartSubtitle&&(r+="<br/>",r+=b.subcharts[f].subchartSubtitle),r})(),reference:(()=>{var e;let t=r||"";return b.subcharts&&null!==(e=b.subcharts[f])&&void 0!==e&&e.reference&&(t+="<br/>",t+=b.subcharts[f].reference),t})()})})})]})};var ke=r(61745),Ae=r(40472),Te=r(20068),Ie=r(47047),Pe=r(89164),ze=r(94721),Ee=r(30604),Re=r(60173),Me=r(49877),We=r(55396),Oe=r(60627),Le=r(61162),_e=r(53524),Be=r(47438),Ne=r(79836),Fe=r(56890),He=r(35855),Qe=r(53994),Ue=r(53382),qe=r(44709),Ye=r(19132);const Ve=(0,l.ZP)(Ne.Z)((e=>{let{theme:t,isTiny:r}=e;return{minWidth:r||700,"& th, td":{fontSize:r?"0.625rem":"0.6875rem",color:t.palette.text.secondary,[t.breakpoints.down("sm")]:{fontSize:r?"0.5rem":"0.6875rem"}},"& th":{fontWeight:500,color:t.palette.text.primary,lineHeight:"1rem"}}}));const Ge=function(e){const{themePreference:t}=(0,n.useContext)(Ye.p),{isTiny:r,hideAQIDescription:o}=e;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(c.Z,{overflow:"auto",children:(0,C.jsxs)(Ve,{size:"small",isTiny:r,children:[(0,C.jsx)(Fe.Z,{children:(0,C.jsxs)(He.Z,{children:[(0,C.jsx)(Qe.Z,{sx:{pr:0},children:(0,C.jsx)(c.Z,{sx:{width:"1em",height:"1em"}})}),(0,C.jsx)(Qe.Z,{sx:{pl:1},children:"Category"}),(0,C.jsx)(Qe.Z,{align:"right",children:"US AQI"}),(0,C.jsxs)(Qe.Z,{align:"right",children:["PM2.5 Concentration (\xb5g/m",(0,C.jsx)("sup",{children:"3"}),")"]}),!o&&(0,C.jsx)(Qe.Z,{align:"left",children:"Description"}),!o&&(0,C.jsx)(Qe.Z,{align:"left",children:"CITIESair' Suggested Actions"})]})}),(0,C.jsx)(Ue.Z,{children:qe.Z.map(((e,r)=>(0,C.jsxs)(He.Z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[(0,C.jsx)(Qe.Z,{sx:{pr:0},children:(0,C.jsx)(c.Z,{sx:{width:"1em",height:"1em",backgroundColor:t===Ee.Z.light?e.lightThemeColor:e.darkThemeColor}})}),(0,C.jsx)(Qe.Z,{sx:{pl:1},children:e.category}),(0,C.jsxs)(Qe.Z,{align:"right",children:[e.aqiUS.low,"\xa0 - \xa0",e.aqiUS.high]}),(0,C.jsxs)(Qe.Z,{align:"right",children:[e.rawPM2_5.low,"\xa0 - \xa0",e.rawPM2_5.high]}),!o&&(0,C.jsx)(Qe.Z,{align:"left",children:e.description}),!o&&(0,C.jsx)(Qe.Z,{align:"left",children:(0,s.ZP)(e.healthSuggestions.outdoors,{replace:U.T})})]},r)))})]})}),(e=>{let{shouldRender:t}=e,r=null;if(t){const e=[["category"],["US AQI"]];for(let t=0;t<qe.Z.length;t+=1)e[0].push(qe.Z[t].category),e[1].push(50*Math.ceil((qe.Z[t].aqiUS.high-qe.Z[t].aqiUS.low)/50));r=(0,C.jsx)(Ce,{chartHeight:"4rem",chartData:{dataArray:e,chartType:"BarChart",options:{enableInteractivity:!1,legend:{position:"none"},hAxis:{ticks:[0,50,100,150,200,300,500]},chartArea:{width:{portrait:"98%",landscape:"50%"},height:{portrait:"20%",landscape:"30%"}},isStacked:!0,colors:"aqi",bar:{groupWidth:"100%"}}}})}return r})({shouldRender:!o})]})};function $e(e){const[t,r]=(0,n.useState)(null),o=e=>{r(e.currentTarget),Be.y(Be.z.airQualityIndexLegendQuickGlance)},a=()=>{r(null)},i=Boolean(t);return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(_e.TF,{...e,distanceFromBottomOfWindow:"5.5rem",children:(0,C.jsx)(Me.Z,{sx:{mt:1},"aria-owns":i?Be.z.airQualityIndexLegendQuickGlance:void 0,"aria-haspopup":"true",onMouseEnter:o,onMouseLeave:a,onClick:e=>Re.tq&&(i?a():o(e)),"aria-label":Be.z.airQualityIndexLegendQuickGlance,color:"primary",children:(0,C.jsxs)(x.Z,{direction:"column",alignItems:"center",children:[(0,C.jsx)(Le.Z,{fontSize:"1rem"}),(0,C.jsx)(p.Z,{variant:"body2",fontWeight:"500",children:"AQI"})]})})}),(0,C.jsx)(We.Z,{id:Be.z.airQualityIndexLegendQuickGlance,sx:{pointerEvents:"none",mt:-1},open:i,anchorEl:t,placement:"top-end",onClose:a,keepMounted:!0,disableRestoreFocus:!0,transition:!0,children:e=>{let{TransitionProps:t}=e;return(0,C.jsx)(Oe.Z,{...t,timeout:350,children:(0,C.jsxs)(re.Z,{elevation:8,sx:{py:.5,mb:1},children:[(0,C.jsx)(p.Z,{sx:{mx:2,mt:1},color:"text.disabled",variant:"body1",fontWeight:500,children:"AQI at quick glance"}),(0,C.jsx)(Ge,{isTiny:!0,hideAQIDescription:!0})]})})}})]})}var Xe=r(71478),Je=r(40501),Ke=r(44281),et=(r(14058),r(4853)),tt=r(69161),rt=r(29818),nt=r(97123),ot=r(30195),at=r(80043),it=r(73518),st=r(71566),lt=r(31009);function ct(e){const{currentSchoolID:t,current:r}=(0,n.useContext)(pe.G),[o,a]=(0,n.useState)({}),[i,s]=(0,n.useState)("placeholder");(0,n.useEffect)((()=>{if(!r)return;const e=r.filter((e=>e&&e.sensor)).reduce(((e,t)=>(e[t.sensor.location_short]={location_type:t.sensor.location_type,location_short:t.sensor.location_short,location_long:t.sensor.location_long,last_seen:t.sensor.last_seen.split("T")[0],rawDatasets:Object.keys(ce.M$).reduce(((e,t)=>(e[ce.M$[t]]={sample:null,full:null},e)),{})},e)),{});a(e)}),[r]);const l=(0,v.Z)(),c=(0,u.Z)(l.breakpoints.down("sm")),[d,h]=(0,n.useState)(!1),m=()=>{h(!1)};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(ee.Z,{onClick:()=>{s(null),h(!0),Be.y(Be.z.rawDatasetButtonClicked)},variant:"contained",children:[(0,C.jsx)(st.Z,{sx:{fontSize:"1rem"}}),"\xa0Raw Dataset"]}),(0,C.jsxs)(rt.Z,{open:d,onClose:m,maxWidth:"lg",fullWidth:!0,fullScreen:c,keepMounted:!0,zIndex:1e4,children:[c&&(0,C.jsx)(nt.Z,{sx:{justifyContent:"start"},children:(0,C.jsxs)(ee.Z,{autoFocus:!0,onClick:m,children:[(0,C.jsx)(lt.Z,{sx:{fontSize:"1rem"}}),"Back"]})}),(0,C.jsxs)(ot.Z,{sx:{px:c?2:3,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"start"},children:[(0,C.jsx)(D.Z,{label:t?"School: ".concat(t.toUpperCase()):"No School",size:"small",sx:{mb:1}}),(0,C.jsx)(p.Z,{variant:"h6",zIndex:"10000",sx:{mb:1},children:"Preview and download raw dataset(s)"}),(0,C.jsx)(dt,{sensorsDatasets:o,updateSensorsDatasets:a,previewingDataset:i,setPreviewingDataset:s,smallScreen:c,schoolID:t}),o&&(0,C.jsxs)(p.Z,{variant:"caption",sx:{my:3,fontStyle:"italic"},children:["These datasets are provided by CITIESair from sensors operated by CITIESair. Should you intend to utilize them for your project, research, or publication, we kindly request that you notify us at ",(0,C.jsx)(at.Z,{href:"mailto:nyuad.cities@nyu.edu",children:"nyuad.cities@nyu.edu"})," to discuss citation requirements."]})]})]})]})}const dt=e=>{const{sensorsDatasets:t,updateSensorsDatasets:r,previewingDataset:o,setPreviewingDataset:i,smallScreen:s,schoolID:l}=e;return(0,n.useEffect)((()=>{if(Object.keys(t).length>0&&!o){const e=Object.keys(t)[0],n=ce.M$.hourly;if(i({sensor:e,datasetType:n}),t[e].rawDatasets[n].sample)return;const o=(0,ce.OM)({school_id:l,sensor_location_short:e,datasetType:n,isSample:!0});(0,a.m)({url:o,extension:"csv",needsAuthorization:!0}).then((o=>{const a={...t};a[e].rawDatasets[n].sample=o,r(a)})).catch((e=>console.log(e)))}}),[t,o]),(0,C.jsxs)(g.ZP,{container:!0,justifyContent:"center",alignItems:"start",spacing:s?1:2,sx:{mt:0},overflow:"scroll",children:[(0,C.jsx)(g.ZP,{item:!0,sm:12,md:6,children:(0,C.jsx)(ut,{schoolID:l,sensorsDatasets:t,updateSensorsDatasets:r,smallScreen:s,previewingDataset:o,setPreviewingDataset:i})}),(0,C.jsx)(g.ZP,{item:!0,sm:12,md:6,maxWidth:s?"100%":"unset",sx:{mt:1},children:(0,C.jsx)(pt,{sensorsDatasets:t,updateSensorsDatasets:r,previewingDataset:o,schoolID:l,smallScreen:s})})]})},ut=e=>{const{schoolID:t,sensorsDatasets:r,smallScreen:n,previewingDataset:o,setPreviewingDataset:a,updateSensorsDatasets:i}=e;return(0,C.jsxs)(Ne.Z,{size:"small",sx:{tableLayout:"fixed","& td, div, .MuiMenuItem-root":{fontSize:n?"0.625rem":"0.8rem"}},children:[(0,C.jsx)(Fe.Z,{children:(0,C.jsxs)(He.Z,{children:[(0,C.jsx)(Qe.Z,{sx:{pl:1},children:"Sensor Location"}),(0,C.jsx)(Qe.Z,{sx:{width:n?"9.5rem":"11rem"},children:"Dataset Type"})]})}),(0,C.jsx)(Ue.Z,{children:r&&Object.keys(r).map((e=>(0,C.jsx)(ht,{schoolID:t,smallScreen:n,sensor:e,sensorsDatasets:r,previewingDataset:o,setPreviewingDataset:a,isPreviewing:e===(null===o||void 0===o?void 0:o.sensor),updateSensorsDatasets:i})))})]})},ht=e=>{const{schoolID:t,sensorsDatasets:r,sensor:o,previewingDataset:i,setPreviewingDataset:s,isPreviewing:l,updateSensorsDatasets:c}=e,[d,u]=(0,n.useState)(ce.M$.hourly);(0,n.useEffect)((()=>{d!==ce.M$.hourly&&u(ce.M$.hourly)}),[t]);const h=e=>{if(!r[o].rawDatasets[e].sample){const n=(0,ce.OM)({school_id:t,sensor_location_short:r[o].location_short,datasetType:e,isSample:!0});(0,a.m)({url:n,extension:"csv",needsAuthorization:!0}).then((t=>{const n={...r};n[o].rawDatasets[e].sample=t,c(n)}))}},p=(0,v.Z)();return(0,C.jsx)(C.Fragment,{children:(0,C.jsxs)(He.Z,{children:[(0,C.jsx)(Qe.Z,{sx:{pl:1,cursor:"pointer",background:l&&p.palette.background.NYUpurpleLight},onClick:()=>{(null===i||void 0===i?void 0:i.sensor)!==o&&(s({datasetType:d,sensor:o}),h(d))},children:r[o].location_long}),(0,C.jsx)(Qe.Z,{sx:{position:"relative",background:l&&p.palette.background.NYUpurpleLight},children:(0,C.jsx)(b.Z,{size:"small",children:(0,C.jsx)(f.Z,{value:d,onChange:e=>{const t=e.target.value;u(t),s({datasetType:t,sensor:o}),h(t)},variant:"standard",MenuProps:{disablePortal:!0},children:Object.keys(r[o].rawDatasets).reverse().map(((e,t)=>(0,C.jsx)(y.Z,{value:e,children:(0,C.jsx)(x.Z,{direction:"row",alignItems:"center",children:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()})},t)))})})})]},o)})},pt=e=>{const{sensorsDatasets:t,updateSensorsDatasets:r,previewingDataset:o,schoolID:i,smallScreen:s}=e,l=(0,v.Z)(),[d,u]=(0,n.useState)("Not previewing any dataset"),[h,m]=(0,n.useState)("No dataset"),[g,b]=(0,n.useState)(!1),f=e=>{const t=new Blob([e],{type:"application/octet-stream"}),r=URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download=h,document.body.appendChild(n),n.click(),URL.revokeObjectURL(r),document.body.removeChild(n)},[y,S]=(0,n.useState)(""),[j,w]=(0,n.useState)("");return(0,n.useEffect)((()=>{var e,r;if(!o)return;u("Previewing: ".concat(o.sensor," (").concat(o.datasetType,")"));const n=null===(e=t[o.sensor])||void 0===e||null===(r=e.rawDatasets[o.datasetType])||void 0===r?void 0:r.sample;if(!n)return w(null),S(null),m("Loading..."),void b(!0);g&&b(!1);const a=n.split("\n"),s=a[0].split(","),l=a.slice(1);let c;if(w(["",...l.map((e=>e.split(",")[0]))].join("\n")),S([s.slice(1).join(","),...l.map((e=>e.split(",").slice(1).join(",")))].join("\n")),l.length>0){const e=l[l.length-1].split(",");if(e.length>=2){c=e[1].split("T")[0]}}const d="".concat(i,"-").concat(o.sensor,"-").concat(o.datasetType,"-").concat(c,".csv");m(d)}),[o,t]),(0,C.jsxs)(x.Z,{spacing:1,children:[(0,C.jsxs)(c.Z,{sx:{"& *":{fontFamily:"monospace !important"}},children:[(0,C.jsx)(x.Z,{direction:"row",children:(0,C.jsx)(p.Z,{variant:"body2",gutterBottom:!0,fontWeight:500,children:d})}),(0,C.jsx)(c.Z,{component:"pre",sx:{overflowX:"auto",color:l.palette.text.secondary,backgroundColor:l.palette.customBackground,p:2,pt:1.5,borderRadius:l.shape.borderRadius,borderTopLeftRadius:0,height:s?"11.8rem":"14rem",width:s?"100%":"unset",marginTop:0},children:(0,C.jsx)(x.Z,{direction:"row",sx:{fontSize:s?"0.625rem !important":"0.8rem !important"},children:y?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(c.Z,{sx:{mr:2,userSelect:"none"},children:j}),(0,C.jsx)(c.Z,{children:y})]}):(0,C.jsx)(H.Z,{optionalText:"Loading"})})})]}),(0,C.jsx)(c.Z,{textAlign:"center",children:(0,C.jsxs)(ee.Z,{variant:"contained",sx:{textTransform:"none",textAlign:"left",lineHeight:1.1,px:1.5,py:1},onClick:()=>{(()=>{if(!o)return;const e=t[o.sensor].rawDatasets[o.datasetType].full;if(e)f(e);else{const e=(0,ce.OM)({school_id:i,sensor_location_short:o.sensor,datasetType:o.datasetType,isSample:!1});(0,a.m)({url:e,extension:"csv",needsAuthorization:!0}).then((e=>{const n={...t};n[o.sensor].rawDatasets[o.datasetType].full=e,r(n),f(e)}))}})(),Be.y(Be.z.rawDatasetDownloaded,{dataset_type:null===o||void 0===o?void 0:o.datasetType,sensor:null===o||void 0===o?void 0:o.sensor})},disabled:g,children:[(0,C.jsx)(it.Z,{sx:{fontSize:"1.25rem",mr:.5}}),h]})})]})};var mt=r(65117),xt=r(11087),gt=r(22981),vt=r(81131),bt=r(51440);const ft=()=>{const{currentSchoolID:e,schoolMetadata:t}=(0,n.useContext)(pe.G);if(!t)return;const r=t.screens;if(!Array.isArray(r))return null;if(r.length<=1)return(0,C.jsxs)(ee.Z,{variant:"contained",component:xt.rU,to:"/screen/".concat(e),children:[(0,C.jsx)(gt.Z,{sx:{fontSize:"1rem"}}),"\xa0TV Screen"]});const[o,a]=(0,n.useState)(null),i=Boolean(o);return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(ee.Z,{id:"basic-button","aria-controls":i?"tv-screen-list-menu":void 0,"aria-haspopup":"true","aria-expanded":i?"true":void 0,onClick:e=>{a(e.currentTarget)},variant:"contained",children:[(0,C.jsx)(gt.Z,{sx:{fontSize:"1rem"}}),"\xa0 TV Screens List"]}),(0,C.jsx)(mt.Z,{id:"tv-screen-list-menu",anchorEl:o,open:i,onClose:()=>{a(null)},MenuListProps:{"aria-labelledby":"basic-button"},children:r.map(((t,r)=>(0,C.jsx)(vt.ZP,{behavior:bt.Z.toNewPage,to:"/screen/".concat(e,"/").concat(t.screen_name),label:t.location_long,sx:{fontSize:"0.8rem"}},r)))})]})};var yt=r(16344),St=r(1414),jt=r(25028),wt=r(58562),Dt=r(16071),Zt=r(18610),Ct=r(31781),kt=r(26759),At=r(70366);const Tt=()=>{const{currentSchoolID:e,schoolMetadata:t}=(0,n.useContext)(pe.G),{user:r}=(0,n.useContext)(Ct.S);if(!Array.isArray(r.allowedSchools)||r.allowedSchools.length<=1)return(0,C.jsx)(Rt,{icon:(0,C.jsx)(wt.Z,{}),label:(null===t||void 0===t?void 0:t.name)||"N/A",tooltipTitle:"School"});const[a,i]=(0,n.useState)(""),[s,l]=(0,n.useState)(null),d=()=>{l(null)},u=(0,o.s0)(),h=t=>()=>{e!==t&&(localStorage.setItem(Dt.m.schoolID,t),i(t),Be.y(Be.z.internalNavigation,{origin_school:e,destination_school_id:t,origin_id:"school_selector"}),u("".concat(Zt.f.dashboard,"/").concat(t))),d()};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(Rt,{icon:(0,C.jsx)(wt.Z,{}),label:(0,C.jsxs)(c.Z,{sx:{"& svg":{fontSize:"1rem",verticalAlign:"sub",marginLeft:"0.25rem"}},children:[(null===t||void 0===t?void 0:t.name)||"N/A",Boolean(s)?(0,C.jsx)(At.Z,{}):(0,C.jsx)(kt.Z,{})]}),tooltipTitle:"Click to Select School",clickable:!0,onClick:e=>{l(e.currentTarget)},"aria-controls":open?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":open?"true":void 0}),(0,C.jsx)(mt.Z,{anchorEl:s,open:Boolean(s),onClose:d,MenuListProps:{"aria-labelledby":"basic-button"},children:(0,C.jsx)(jt.Z,{dense:!0,children:r.allowedSchools.map(((e,t)=>(0,C.jsx)(y.Z,{onClick:h(e.school_id),children:e.name},t)))})})]})};var It=r(7009);const Pt={title:"Explanation of the US Air Quality Index (AQI)",subtitle:"CITIESair uses the <a href='https://www.airnow.gov/aqi/aqi-basics/'>Air Quality Index (AQI)</a> developed by the United States Environmental Protection Agency (EPA) to effectively communicate different levels of PM2.5 air pollution. To calculate the AQI from the raw measurement of PM2.5 concentration (\xb5g/m\xb3), different breakpoints and piecewise linear function are utilized (read more <a href='https://en.wikipedia.org/wiki/Air_quality_index#United_States'>here</a>). Higher AQI values correspond to poorer air quality and greater heath risks to humans.<br><br>The US EPA sets thresholds for PM2.5 concentration: <sup>[1]</sup><ul><li><b>Annual average</b>: 12.0 \xb5g/m\xb3, corresponding to US AQI <b>50</b></li><li><b>24-hour average</b>: 35.0 \xb5g/m\xb3, corresponding to US AQI <b>100</b></li></ul>In 2021, the World's Heath Organization (WHO) proposed a new guideline for PM2.5<sup>[2]</sup> with stricter thresholds than those of the US EPA:<ul><li><b>Annual average</b>: 5.0 \xb5g/m\xb3, corresponding to US AQI <b>21</b></li><li><b>24-hour average</b>: 15.0 \xb5g/m\xb3, corresponding to US AQI <b>56</b></li></ul>",reference:'[1] "National Ambient Air Quality Standards (NAAQS) for PM." EPA, Environmental Protection Agency, https://www.epa.gov/pm-pollution/national-ambient-air-quality-standards-naaqs-pm.<br>[2] World Health Organization. "WHO global air quality guidelines: particulate matter (PM2. 5 and PM10), ozone, nitrogen dioxide, sulfur dioxide and carbon monoxide: executive summary." (2021).'};var zt=r(70445),Et=r(26459);const Rt=e=>{const{tooltipTitle:t,label:r,...n}=e;return(0,C.jsx)(Te.Z,{title:t,enterDelay:0,leaveDelay:200,children:(0,C.jsx)(D.Z,{size:"small",label:r||(0,C.jsx)(Ie.Z,{variant:"text",sx:{minWidth:"5rem"}}),...n})})},Mt=()=>{let e;const{setChartsTitlesList:t}=(0,n.useContext)(i.F),{commentCounts:r,fetchCommentCounts:o,setCommentCounts:a}=(0,n.useContext)(zt.c),{schoolMetadata:l,current:d,chartData:u}=(0,n.useContext)(pe.G),{themePreference:h,temperatureUnitPreference:m}=(0,n.useContext)(Ye.p),[b,f]=(0,n.useState)(!1),[y,S]=(0,n.useState)(!1);(0,n.useEffect)((()=>{if(!l)return;const e="nyuad"===l.school_id;f(e),S(e),e&&!r&&o().then((e=>{a(e)}))}),[l]),(0,n.useEffect)((()=>{if(null===u||void 0===u||!u.charts)return;const e=null===u||void 0===u?void 0:u.charts.map(((e,t)=>({chartTitle:e.title,chartID:"chart-".concat(t+1)})));t(e)}),[u]);const j=(0,v.Z)(),w=()=>{var t,n;return(0,C.jsxs)(g.ZP,{container:!0,spacing:1,sx:{mt:-3,pb:3},children:[(0,C.jsx)(g.ZP,{item:!0,children:(0,C.jsx)(Tt,{})}),(0,C.jsx)(g.ZP,{item:!0,children:(0,C.jsx)(Rt,{icon:(0,C.jsx)(Je.Z,{}),label:null===l||void 0===l?void 0:l.contactPerson,tooltipTitle:"Contact Person"})}),(0,C.jsx)(g.ZP,{item:!0,children:(0,C.jsx)(Rt,{icon:(0,C.jsx)(Ke.Z,{}),label:null===l||void 0===l?void 0:l.contactEmail,tooltipTitle:"Contact Email",component:"a",href:"mailto:".concat(null===l||void 0===l?void 0:l.contactEmail),clickable:!0})}),(0,C.jsx)(g.ZP,{item:!0,children:(0,C.jsx)(Rt,{icon:(0,C.jsx)(et.Z,{}),label:"".concat((null===u||void 0===u||null===(t=u.charts)||void 0===t?void 0:t.length)||"..."," Chart").concat(1!==(null===u||void 0===u||null===(n=u.charts)||void 0===n?void 0:n.length)?"s":""),tooltipTitle:"Number of Charts",onClick:()=>{var e;(0,vt.Qj)(Xe.O3.id),Be.y(Be.z.internalNavigation,{destination_id:Xe.O3.id,destination_label:null===(e=Xe.chartData)||void 0===e?void 0:e.toString(),origin_id:"chip"})}})}),e,!0===b&&null!==r&&(0,C.jsx)(g.ZP,{item:!0,children:(0,C.jsx)(Rt,{icon:(0,C.jsx)(tt.Z,{}),label:"".concat(r[Ae.Hf]," Comment").concat(r[Ae.Hf]>1?"s":""),tooltipTitle:"Number of Comments",onClick:()=>{(0,vt.Qj)(Xe.Sf.id),Be.y(Be.z.internalNavigation,{destination_id:Xe.Sf.id,destination_label:Xe.Sf.toString(),origin_id:"chip"})}})})]})};return(0,C.jsxs)(c.Z,{width:"100%",children:[(0,C.jsx)($e,{}),(0,C.jsx)(yt.Z,{backgroundColor:"customAlternateBackground",children:(0,C.jsxs)(Pe.Z,{sx:{pt:5},children:[(0,C.jsx)(ke.Z,{text:(()=>{if(null!==l&&void 0!==l&&l.school_id)return"Air Quality | ".concat(null===l||void 0===l?void 0:l.school_id)})()}),(0,C.jsx)(w,{})]})}),!0===y&&(0,C.jsx)(Et.Z,{initialNyuadCurrentData:d,isOnBannerPage:!1,themePreference:h,minMapHeight:"250px"}),(0,C.jsx)(yt.Z,{backgroundColor:"customAlternateBackground",children:(0,C.jsxs)(Pe.Z,{sx:{pt:3,pb:3},children:[!1===y&&(0,C.jsx)(c.Z,{textAlign:"center",sx:{mb:2},children:(0,C.jsx)(St.Z,{currentSensorsData:d,isScreen:!1,temperatureUnitPreference:m})}),u&&(()=>{const e=u.description;return e?(0,C.jsx)(p.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{textAlign:"justify",pb:2,mb:0,"& table *":{color:"".concat(j.palette.text.secondary)}},gutterBottom:!0,children:(0,s.ZP)(e||"",{replace:U.T})}):Array.from({length:3}).map(((e,t)=>(0,C.jsx)(Ie.Z,{variant:"text"},t)))})(),(0,C.jsxs)(x.Z,{direction:"row",spacing:2,children:[(0,C.jsx)(ft,{}),(0,C.jsx)(ct,{})]}),(0,C.jsx)(It.Z,{title:Pt.title,content:(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(Ge,{themePreference:h}),(0,C.jsx)(p.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{mt:2},children:(0,s.ZP)(Pt.subtitle,{replace:U.T})}),(0,C.jsx)(It.Z,{title:"Reference",content:(0,C.jsx)(p.Z,{variant:"caption",color:"text.secondary",children:(0,s.ZP)(Pt.reference,{replace:U.T})})})]})})]})}),(0,C.jsx)(c.Z,{id:Xe.O3.id,children:(()=>{var e;return u?null===u||void 0===u||null===(e=u.charts)||void 0===e?void 0:e.map(((e,t)=>(0,C.jsx)(yt.Z,{backgroundColor:t%2!=0&&"customAlternateBackground",children:(0,C.jsxs)(Pe.Z,{sx:{pt:4,pb:4},height:"auto",className:h===Ee.Z.dark?"dark":"",id:"chart-".concat(t+1),children:[(0,C.jsxs)(p.Z,{variant:"h6",color:"text.primary",children:[t+1,". ",e.title]}),(0,C.jsx)(Ce,{generalChartSubtitle:e.subtitle,generalChartReference:e.reference,chartData:{chartIndex:t,...e}})]})},t))):(0,C.jsx)(H.Z,{optionalText:"Loading Dashboard"})})()}),(0,C.jsx)(ze.Z,{}),!0===b&&(0,C.jsx)(yt.Z,{id:Xe.Sf.id,sx:{pt:3,pb:4},children:(0,C.jsx)(Ae.ZP,{pageID:Ae.Hf})})]})},Wt=()=>{const{school_id_param:e}=(0,o.UO)(),t=(0,o.s0)();(0,n.useEffect)((()=>{e&&(document.title="CITIESair | ".concat(e.toUpperCase()))}),[e]);const{setCurrentPage:r}=(0,n.useContext)(i.F);(0,n.useEffect)((()=>{r(Zt.f.dashboard)}),[]);const{currentSchoolID:s,setCurrentSchoolID:l,schoolMetadata:c,setSchoolMetadata:d,current:u,setCurrent:h,chartData:p,setChartData:m}=(0,n.useContext)(pe.G),{user:x}=(0,n.useContext)(Ct.S);(0,n.useEffect)((()=>{if("nyuad"===e)return g("nyuad"),void l("nyuad");!0===x.checkedAuthentication&&!1===x.authenticated&&t("/login");const r=x.allowedSchools;if(Array.isArray(r)&&r.length>0){if(!e){let e;const n=localStorage.getItem(Dt.m.schoolID);r.map((e=>e.school_id)).includes(n)?e=n:(e=r[0].school_id,l(e),localStorage.setItem(Dt.m.schoolID,e)),t(e,{replace:!0}),(c||u||p)&&g(e)}if(r.map((e=>e.school_id)).includes(e))return l(e),g(e),void localStorage.setItem(Dt.m.schoolID,e)}}),[x,e]);const g=async e=>{try{d(),h(),m({...p,charts:null});const t=await Promise.all([(0,a.m)({url:(0,ce.kG)({endpoint:ce.Cq.schoolmetadata,school_id:e}),extension:"json",needsAuthorization:!0}),(0,ce.mQ)((0,ce.kG)({endpoint:ce.Cq.current,school_id:e}))]);d(t[0]),h(t[1])}catch(t){console.log(t)}(0,a.m)({url:(0,ce.kG)({endpoint:ce.Cq.chartdata,school_id:e}),extension:"json",needsAuthorization:!0}).then((e=>{m(e)})).catch((e=>{console.log(e)}))};return(0,C.jsx)(C.Fragment,{children:(0,C.jsx)(Mt,{})})}}}]);
//# sourceMappingURL=297.1aae9923.chunk.js.map