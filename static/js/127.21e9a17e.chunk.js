"use strict";(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[127],{35429:(e,t,o)=>{o.d(t,{Z:()=>m});var r=o(72791),n=o(20890),a=o(53540),i=o(69755),s=o(80223),l=o(7009),c=o(19132),d=o(80184);const u="Explanation of the US Air Quality Index (AQI) for PM2.5",h="CITIESair uses the <a href='https://www.airnow.gov/aqi/aqi-basics/'>Air Quality Index (AQI)</a> developed by the United States Environmental Protection Agency (EPA) to effectively communicate different levels of PM2.5 air pollution. To calculate the AQI from the raw measurement of PM2.5 concentration (\xb5g/m\xb3), different breakpoints and piecewise linear function are utilized (read more <a href='https://en.wikipedia.org/wiki/Air_quality_index#United_States'>here</a>). Higher AQI values correspond to poorer air quality and greater heath risks to humans.<br><br>The US EPA sets thresholds for PM2.5 concentration, recently updated in February 2024: <sup>[1]</sup><ul><li><b>Annual average</b>: 9.0 \xb5g/m\xb3, corresponding to US AQI <b>50</b></li><li><b>24-hour average</b>: 35.0 \xb5g/m\xb3, corresponding to US AQI <b>100</b></li></ul>In 2021, the World's Heath Organization (WHO) proposed a new guideline for PM2.5<sup>[2]</sup> with stricter thresholds than those of the US EPA:<ul><li><b>Annual average</b>: 5.0 \xb5g/m\xb3, corresponding to US AQI <b>21</b></li><li><b>24-hour average</b>: 15.0 \xb5g/m\xb3, corresponding to US AQI <b>56</b></li></ul>",p='[1] "National Ambient Air Quality Standards (NAAQS) for PM." EPA, Environmental Protection Agency, https://www.epa.gov/pm-pollution/national-ambient-air-quality-standards-naaqs-pm.<br>[2] World Health Organization. "WHO global air quality guidelines: particulate matter (PM2. 5 and PM10), ozone, nitrogen dioxide, sulfur dioxide and carbon monoxide: executive summary." (2021).',m=()=>{const{themePreference:e}=(0,r.useContext)(c.p);return(0,d.jsx)(l.Z,{title:u,content:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.Z,{themePreference:e}),(0,d.jsx)(n.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{mt:2},children:(0,a.ZP)(h,{replace:i.T1})}),(0,d.jsx)(l.Z,{title:"Reference",content:(0,d.jsx)(n.Z,{variant:"caption",color:"text.secondary",children:(0,a.ZP)(p,{replace:i.T1})})})]})})}},80223:(e,t,o)=>{o.d(t,{Z:()=>f});var r=o(66934),n=o(79836),a=o(697),i=o(56890),s=o(35855),l=o(53994),c=o(53382),d=o(53540),u=o(69755),h=o(44709),p=o(72791),m=o(19132),x=o(80184);const g=(0,r.ZP)(n.Z)((e=>{let{theme:t,isTiny:o}=e;return{minWidth:o||700,"& th, td":{fontSize:o?"0.625rem":"0.6875rem",color:t.palette.text.secondary,[t.breakpoints.down("sm")]:{fontSize:o?"0.5rem":"0.6875rem"}},"& th":{fontWeight:500,color:t.palette.text.primary,lineHeight:"1rem"}}}));const f=function(e){const{themePreference:t}=(0,p.useContext)(m.p),{isTiny:o,hideAQIDescription:r}=e,n=(e,t)=>t===1/0?"".concat(e,"+"):"".concat(e," - ").concat(t);return(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(a.Z,{overflow:"auto",children:(0,x.jsxs)(g,{size:"small",isTiny:o,children:[(0,x.jsx)(i.Z,{children:(0,x.jsxs)(s.Z,{children:[(0,x.jsx)(l.Z,{sx:{pr:0},children:(0,x.jsx)(a.Z,{sx:{width:"1em",height:"1em"}})}),(0,x.jsx)(l.Z,{sx:{pl:1},children:"Category"}),(0,x.jsx)(l.Z,{align:"right",children:"US AQI"}),(0,x.jsxs)(l.Z,{align:"right",children:["PM2.5 Concentration (\xb5g/m",(0,x.jsx)("sup",{children:"3"}),")"]}),!r&&(0,x.jsx)(l.Z,{align:"left",children:"Description"}),!r&&(0,x.jsx)(l.Z,{align:"left",children:"CITIESair' Suggested Actions"})]})}),(0,x.jsx)(c.Z,{children:h.Z.map(((e,o)=>(0,x.jsxs)(s.Z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[(0,x.jsx)(l.Z,{sx:{pr:0},children:(0,x.jsx)(a.Z,{sx:{width:"1em",height:"1em",backgroundColor:e.color[t]}})}),(0,x.jsx)(l.Z,{sx:{pl:1},children:e.category}),(0,x.jsx)(l.Z,{align:"right",children:n(e.aqiUS.low,e.aqiUS.high)}),(0,x.jsx)(l.Z,{align:"right",children:n(e.rawPM2_5.low,e.rawPM2_5.high)}),!r&&(0,x.jsx)(l.Z,{align:"left",children:e.description}),!r&&(0,x.jsx)(l.Z,{align:"left",children:(0,d.ZP)(e.healthSuggestions.outdoors,{replace:u.T1})})]},o)))})]})})})}},7009:(e,t,o)=>{o.d(t,{Z:()=>y});var r=o(72791),n=o(66934),a=o(40911),i=o(55818),s=o(3721),l=o(697),c=o(20068),d=o(20890),u=o(26759),h=o(25878),p=o(47438),m=o(80184);const x=(0,n.ZP)(a.Z)((e=>{let{theme:t,expanded:o}=e;return{color:t.palette.text.secondary,backgroundImage:"none",backgroundColor:o?t.palette.background.default:"transparent",boxShadow:o?t.shadows:"none",transition:"none"}})),g=(0,n.ZP)(i.Z)((e=>{let{theme:t,expanded:o}=e;return{marginTop:o?t.spacing(2):0,flexDirection:"row-reverse",paddingLeft:o?t.spacing(1):0,"& .MuiTypography-root":{color:t.palette.text.primary,textDecoration:"underline",transition:"none","&:hover":{color:t.palette.primary.main}},"& .MuiAccordionSummary-content.Mui-expanded":{marginTop:t.spacing(2),marginBottom:t.spacing(2)}}})),f="Click to expand section",v="Click to collapse section",y=e=>{let{title:t,content:o}=e;const[n,a]=(0,r.useState)(void 0);return(0,m.jsx)(l.Z,{children:(0,m.jsxs)(x,{expanded:"panel1"===n,onChange:(i="panel1",(e,o)=>{a(o?i:void 0),p.y(o?p.z.expandSection:p.z.collapseSection,{section:t})}),transitionDuration:0,children:[(0,m.jsx)(g,{expanded:n,expandIcon:(0,m.jsx)(u.Z,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,m.jsx)(c.Z,{title:n?v:f,enterDelay:0,leaveDelay:200,children:(0,m.jsxs)(d.Z,{component:"a",variant:"body1",children:[t,(0,m.jsx)(h.Z,{sx:{fontSize:"1rem",marginLeft:"0.25rem"}})]})})}),(0,m.jsx)(s.Z,{children:o})]})});var i}},28670:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Ht});var r=o(72791),n=o(57689),a=o(78914),i=o(75973),s=o(53540),l=o(66934),c=o(697),d=o(25228),u=o(5022),h=o(95193),p=o(36314),m=o(43896),x=o(65117),g=o(20890),f=o(47047),v=o(26935),y=o(48206),b=o(83165),j=o(26084),S=o(19658),w=o(61889),D=o(13967),Z=o(68096),C=o(99321),k=o(94454),T=o(19055),A=o(9955),I=o(81918),P=o(3746),z=o(80184);const E="Display All Series",M=48,R=8;function O(e){const{items:t,selectorID:o,allowMultiple:n,seriesLabel:a,onSeriesSelection:i,displayChip:s=!0}=e,l=(0,D.Z)(),c={PaperProps:{style:{maxHeight:5.55*M+R,overflow:"visible !important",background:l.palette.customAlternateBackground}},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},getContentAnchorEl:null},[d,h]=(0,r.useState)(t),[m,x]=(0,r.useState)(n);(0,r.useEffect)((()=>{h(t)}),[t]),(0,r.useEffect)((()=>{x(d.every((e=>e.selected)))}),[d]);const f=e=>{const{target:{value:t}}=e;if(t.includes(E)){const e=d.map(((e,t)=>({...e,selected:0==t||!m})));i({newDataColumns:e}),x(!m)}else{const e=d.filter((e=>t.includes(e.label))),o=d.map((t=>({...t,selected:e.some((e=>e.label===t.label))})));i({newDataColumns:o}),x(!1)}},v=e=>{const t=d.map((t=>t.label===e.label?{...t,selected:!t.selected}:t));i({newDataColumns:t})};return(0,z.jsxs)(p.Z,{spacing:1,direction:"row",alignItems:"center",children:[(0,z.jsx)(Z.Z,{sx:{[l.breakpoints.down("sm")]:{width:"100%"},minWidth:"200px","& .MuiInputBase-root":{borderRadius:"".concat(l.shape.borderRadius,"px")}},size:"small",children:(0,z.jsxs)(C.Z,{labelId:"".concat(o,"-label"),id:o,multiple:n,value:d.filter((e=>e.selected)).map((e=>e.label)),onChange:f,MenuProps:c,renderValue:e=>(e=>(0,z.jsxs)(p.Z,{direction:"row",alignItems:"center",spacing:.5,children:[(0,z.jsx)(P.Z,{fontSize:"1.5rem",sx:{color:l.palette.text.secondary}}),(0,z.jsx)(g.Z,{variant:"caption",color:"text.secondary",children:n?"".concat(e.length,"/").concat(d.length," ").concat(a||""," displayed"):e})]}))(e),sx:{fontSize:"0.75em"},children:[d.map((e=>(0,z.jsxs)(u.Z,{disabled:!(1!==d.filter((e=>e.selected)).length||!e.selected),value:e.label,sx:{backgroundColor:"unset !important","&:hover":{backgroundColor:"inherit !important"}},children:[n?(0,z.jsx)(k.Z,{checked:e.selected,onClick:()=>v(e),sx:{p:.25,transform:"scale(0.8)"}}):(0,z.jsx)(T.Z,{checked:e.selected,onChange:()=>f(e),sx:{p:.25,transform:"scale(0.8)"}}),(0,z.jsx)(g.Z,{variant:"caption",children:e.label})]},e.label))),n&&(0,z.jsx)(u.Z,{value:E,sx:{borderTop:"solid 0.5px",borderColor:l.palette.text.secondary,position:"sticky",bottom:0,zIndex:99999,marginBottom:l.spacing(-1),background:l.palette.customAlternateBackground,"&:hover":{background:l.palette.customAlternateBackground}},children:(0,z.jsxs)(p.Z,{direction:"row",width:"100%",alignItems:"center",justifyContent:"space-between",children:[(0,z.jsx)(g.Z,{fontWeight:500,variant:"caption",sx:{pl:1},children:E}),(0,z.jsx)(A.Z,{checked:m,onClick:()=>v(E),sx:{transform:"scale(0.8)"}})]})},E)]})}),s&&n&&(0,z.jsx)(w.ZP,{container:!0,spacing:1,sx:{[l.breakpoints.down("sm")]:{display:"none"}},children:d.filter((e=>e.selected)).map((e=>(0,z.jsx)(w.ZP,{item:!0,children:(0,z.jsx)(I.Z,{label:(0,z.jsx)(g.Z,{variant:"caption",children:e.label}),size:"small",...1!==d.filter((e=>e.selected)).length&&{onDelete:()=>v(e)}})},e.label)))})]})}const W={CategoryFilter:{position:"top",stackDirection:"column"},DateRangeFilter:{position:"bottom",stackDirection:"column-reverse"},ChartRangeFilter:{position:"bottom",stackDirection:"column-reverse"},NumberRangeFilter:{position:"top",stackDirection:"column"}},_=e=>({min:e.reduce(((e,t)=>t<e?t:e)),max:e.reduce(((e,t)=>t>e?t:e))}),L=e=>({min:Math.min(...e),max:Math.max(...e)}),B=()=>Math.random().toString(36).substr(2,9),F={stem:{length:0},textStyle:{opacity:0},boxStyle:null},N=e=>{let{isPortrait:t,isSmaller:o}=e;return o?t?6:8:t?8:10},H=e=>{var t,o,r,n,a,i,s,l,c,d,u,h,p,m,x,g,f,v,y,b,j,S,w,D,Z,C,k,T,A,I,P,z,E,M,R,O,W,_,L,B,H,U,V,Q,q,Y,G,X,$;const{chartData:J,subchartIndex:K,isPortrait:ee,isHomepage:te,theme:oe}=e,re={italic:!1,bold:!0,color:oe.palette.chart.axisTitle,fontSize:N({isPortrait:ee})},ne={color:oe.palette.chart.axisText,fontSize:N({isPortrait:ee})};let ae=null!==(t=J.subcharts)&&void 0!==t&&t[K].options?{...J.subcharts[K].options}:{};if(ae={...ae,...J.options,theme:"material",curveType:ae.curveType||(null===(o=J.options)||void 0===o?void 0:o.curveType)||"function",crosshair:{orientation:"both",trigger:"focus",opacity:.5},backgroundColor:{fill:(null===(r=J.options)||void 0===r||null===(n=r.backgroundColor)||void 0===n?void 0:n.fill)||"transparent"},chartArea:{...null===(a=J.options)||void 0===a?void 0:a.chartArea,width:ee?(null===(i=J.options)||void 0===i||null===(s=i.chartArea)||void 0===s||null===(l=s.width)||void 0===l?void 0:l.portrait)||"80%":(null===(c=J.options)||void 0===c||null===(d=c.chartArea)||void 0===d||null===(u=d.width)||void 0===u?void 0:u.landscape)||"75%",height:ee?(null===(h=J.options)||void 0===h||null===(p=h.chartArea)||void 0===p||null===(m=p.height)||void 0===m?void 0:m.portrait)||"60%":(null===(x=J.options)||void 0===x||null===(g=x.chartArea)||void 0===g||null===(f=g.height)||void 0===f?void 0:f.landscape)||"70%"},width:ee?(null===(v=J.options)||void 0===v||null===(y=v.width)||void 0===y?void 0:y.portrait)||"100%":(null===(b=J.options)||void 0===b||null===(j=b.width)||void 0===j?void 0:j.landscape)||"100%",height:J.height||"100%",tooltip:{isHtml:!0,showColorCode:!1},legend:{alignment:ee?"center":"start",position:null!==(S=null===(w=J.options)||void 0===w||null===(D=w.legend)||void 0===D?void 0:D.position)&&void 0!==S?S:ee?"top":"right",scrollArrows:{activeColor:oe.palette.chart.axisTitle,inactiveColor:oe.palette.text.secondary},pagingTextStyle:{fontSize:10,color:oe.palette.chart.axisTitle,bold:!0}}},ae.vAxis={...ae.vAxis,format:null!==(Z=null===(C=ae.vAxis)||void 0===C?void 0:C.format)&&void 0!==Z?Z:"decimal",title:null!==(k=null===(T=ae.vAxis)||void 0===T?void 0:T.title)&&void 0!==k?k:"",viewWindow:{min:null!==(A=null===(I=ae.vAxis)||void 0===I||null===(P=I.viewWindow)||void 0===P?void 0:P.min)&&void 0!==A?A:0,max:null!==(z=null===(E=ae.vAxis)||void 0===E||null===(M=E.viewWindow)||void 0===M?void 0:M.max)&&void 0!==z?z:null,max:null!==(R=null===(O=ae.vAxis)||void 0===O||null===(W=O.viewWindow)||void 0===W?void 0:W.max)&&void 0!==R?R:null}},ae.hAxis={...ae.hAxis,title:null!==(_=null===(L=ae.hAxis)||void 0===L?void 0:L.title)&&void 0!==_?_:""},ee&&(ae.hAxis={...ae.hAxis,slantedText:!0,slantedTextAngle:30}),"string"!==typeof ae.colors&&ae.colors||(ae.colors=oe.palette.chart.optionsColors[ae.colors||"multiColor"]),ae.series&&Object.values(ae.series).forEach((e=>{const t=e;"default"===t.color&&(t.color=oe.palette.primary.main)})),ae.trendlines&&ae.trendlines.forEach((e=>{e.color=oe.palette.primary.main})),ae.colorAxis)switch(ae.colorAxis.colors){case"matchingColor":ae.colorAxis.colors=[oe.palette.chart.colorAxisFirstColor,oe.palette.chart.optionsColors.multiColor[ae.colorAxis.colorIndex]];break;case"default":ae.colorAxis.colors=[oe.palette.chart.colorAxisFirstColor,oe.palette.NYUpurple];break;default:try{ae.colorAxis=oe.palette.chart.colorAxes[ae.colorAxis.colors]}catch{ae.colorAxis=[]}}return ae.vAxis={...ae.vAxis,titleTextStyle:re,textStyle:ne,gridlines:{...null===(B=ae.vAxis)||void 0===B?void 0:B.gridlines,color:(null===(H=ae.vAxis)||void 0===H||null===(U=H.gridlines)||void 0===U?void 0:U.color)||oe.palette.chart.gridlines},minorGridlines:{count:0}},ae.hAxis={...ae.hAxis,titleTextStyle:re,textStyle:ne,gridlines:{...null===(V=ae.hAxis)||void 0===V?void 0:V.gridlines,color:(null===(Q=ae.hAxis)||void 0===Q||null===(q=Q.gridlines)||void 0===q?void 0:q.color)||oe.palette.chart.gridlines},minorGridlines:{...null===(Y=ae.hAxis)||void 0===Y?void 0:Y.minorGridlines,color:(null===(G=ae.hAxis)||void 0===G||null===(X=G.gridlines)||void 0===X?void 0:X.color)||oe.palette.chart.gridlines}},ae.legend={...ae.legend,textStyle:ne},ae.annotations={...ae.annotations,highContrast:!0,textStyle:{color:oe.palette.primary.contrastText,fontSize:N({isPortrait:ee,isSmaller:!0}),opacity:.8},stem:{...null===($=ae.annotations)||void 0===$?void 0:$.stem,color:oe.palette.chart.axisTitle,thickness:2},boxStyle:{rx:oe.shape.borderRadius,ry:oe.shape.borderRadius,fill:oe.palette.chart.annotationBoxFill,fillOpacity:.5}},te&&(ae={...ae,chartArea:{...ae.chartArea,width:"80%",height:"80%"},seriesSelector:!1,pointSize:0,enableInteractivity:!1,annotations:F,legend:"none",vAxis:{...ae.vAxis,textPosition:"none",titleTextStyle:{...ae.vAxis.titleTextStyle,bold:!1},gridlines:{color:"transparent",count:0},viewWindowMode:"maximized"},hAxis:{...ae.hAxis,textPosition:"none",gridlines:{color:"transparent",count:0},titleTextStyle:{...ae.hAxis.titleTextStyle,bold:!1}}}),ae},U=e=>{const t=Q({cellSizeMin:14,cellSizeMax:18});return{...e,width:t.chartWidth,calendar:{cellSize:t.cellSize,yearLabel:{fontSize:t.yearLabelFontSize}},noDataPattern:{backgroundColor:"none",color:"none"}}},V=e=>{var t;const{chartControl:o,mainChartData:r,mainChartOptions:n,subchartIndex:a,theme:i,isPortrait:s}=e;let l={...null===(t=o.options)||void 0===t?void 0:t.ui,snapToData:!0};return"ChartRangeFilter"===o.controlType&&(l={...l,chartType:r.chartType,chartView:{columns:r.columns||r.subcharts&&r.subcharts[a].columns||null},chartOptions:{...n,hAxis:{...n.hAxis,textPosition:"out",textStyle:{color:i.palette.chart.axisText,fontSize:N({isPortrait:s,isSmaller:!0})},title:null},vAxis:{...n.vAxis,title:null},annotations:F,legend:null}}),l},Q=e=>{let{cellSizeMin:t,cellSizeMax:o}=e;const r=Math.min(Math.max(.9*window.innerWidth/58,t),o);return{chartWidth:56*r,cellSize:r,yearLabelFontSize:2*r}},q=e=>{let{controlWrapper:t,chartID:o}=e;const r=e=>{var t=e.changedTouches[0],o="";switch(e.type){case"touchstart":o="mousedown";break;case"touchmove":o="mousemove";break;case"touchend":o="mouseup";break;default:return}var r=new MouseEvent(o,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,button:0,relatedTarget:null});t.target.dispatchEvent(r),e.preventDefault()};let n=!0;if(!t)return;const a=document.querySelector("#control-".concat(o));return a?(["touchstart","touchmove","touchend","touchcancel"].forEach((e=>{a.addEventListener(e,r,{capture:!0})})),()=>{n=!1,["touchstart","touchmove","touchend","touchcancel"].forEach((e=>{a.removeEventListener(e,r,{capture:!0})}))}):void 0},Y=(0,l.ZP)(c.Z,{shouldForwardProp:e=>"gradientBackgroundId"!==e&&"isPortrait"!==e})((e=>{let{theme:t,isPortrait:o,gradientBackgroundId:r}=e;return{"& svg>g:nth-of-type(2)>rect:first-of-type":{fill:"url(#".concat(r,")"),fillOpacity:1,filter:"contrast(0.4) brightness(1.4)"},"& .google-visualization-tooltip, .nivo-tooltip":{width:"unset !important",maxWidth:"350px",height:"unset",padding:"1em",boxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",mozBoxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",webkitBoxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",border:"solid 1px",borderColor:t.palette.text.secondaryRGB,fontSize:"".concat(o?9:12,"px"),color:t.palette.chart.tooltip.text,background:t.palette.chart.tooltip.background,borderRadius:t.shape.borderRadius,"& ul":{margin:"0 !important","& li":{margin:"0 !important",padding:"0 !important","& span":{fontSize:"".concat(o?9:12,"px !important"),color:"".concat(t.palette.chart.tooltip.text," !important")}}}},"& .goog-menuitem-highlight, .goog-menuitem-hover":{backgroundColor:"".concat(t.palette.primary," !important")},"& .google-visualization-controls-categoryfilter":{fontSize:"0.85rem",marginTop:"0.75rem",marginBottom:"-0.75rem","& .goog-inline-block > .goog-menu-button":{marginTop:0},"& .goog-menu-button-hover .goog-menu-button-outer-box, .goog-menu-button-hover .goog-menu-button-inner-box":{borderColor:"inherit !important"},"& .google-visualization-controls-label":{color:t.palette.text.secondary,fontWeight:500,verticalAlign:"middle",marginBottom:"0.25rem"},"& .goog-menu-button-outer-box":{backgroundColor:t.palette.background.paper,border:"unset","& .goog-menu-button-inner-box":{paddingTop:t.spacing(.5),paddingBottom:t.spacing(.5),paddingLeft:t.spacing(2),paddingRight:t.spacing(2),border:"solid",borderWidth:"0.5px",borderRadius:t.shape.borderRadius,borderColor:t.palette.text.secondary,"& .goog-menu-button-caption":{color:t.palette.text.secondary}}}},"& .google-visualization-controls-rangefilter":{width:"100%",fontSize:"0.75rem","& .goog-inline-block":{width:"100%"},"& .google-visualization-controls-slider-horizontal":{width:"90%",margin:"0 5%"},"& .google-visualization-controls-rangefilter-thumblabel:nth-of-type(1)":{position:"absolute",top:"1.5em",left:"5%"},"& .google-visualization-controls-rangefilter-thumblabel:nth-of-type(2)":{position:"absolute",top:"1.5em",right:"5%"},"& .google-visualization-controls-slider-handle":{background:t.palette.primary.main},"& .google-visualization-controls-rangefilter-thumblabel":{color:t.palette.text.secondary,padding:0,fontWeight:500},"& .google-visualization-controls-slider-thumb":{background:t.palette.primary.main,border:"unset",borderRadius:t.shape.borderRadius}},'& path[stroke-opacity="0.3"], path[stroke-opacity="0.1"], path[stroke-opacity="0.05"], rect[stroke-opacity]':{stroke:t.palette.text.primary,strokeWidth:3},"& [column-id]:not(:empty)":{cursor:"pointer",":hover":{fontWeight:600}}}}));var G=o(6694),X=o(18970),$=o(69755);const J=e=>{let{colors:t,optionalMinValue:o,optionalMaxValue:r}=e;if(!(0,$.qt)(t))return[{color:"#fff",offset:0},{color:"#fff",offset:1}];if("string"===typeof t[0]){const e=t.length;return t.map(((t,o)=>({color:t,offset:o/(e-1)})))}{let e;o&&(e=t.filter((e=>e.offset>=o))),e=r?t.filter((e=>e.offset<=r)):t;const n=e.map((e=>e.offset)),a=(e=>{let{offsets:t,minOffset:o,maxOffset:r}=e;return t.map((e=>(e-o)/(r-o)))})({offsets:n,minOffset:o||Math.min(...n),maxOffset:r||Math.max(...n)});return e.map(((e,t)=>({color:e.color,offset:a[t]})))}},K=e=>{let{colors:t,numSteps:o}=e;function r(e,t,o){return"#"+[e,t,o].map((e=>{const t=e.toString(16);return 1===t.length?"0"+t:t})).join("")}function n(e,t,o){let r=e.slice();for(let n=0;n<3;n++)r[n]=Math.round(r[n]+o*(t[n]-e[n]));return r}const a=J({colors:t});a.forEach((e=>{e.color=function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,o,r){return t+t+o+o+r+r}));const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[null,null,null]}(e.color)}));let i=[];const s=Array.from({length:o},((e,t)=>t/(o-1)));for(let l=0;l<s.length;l++){const e=s[l];let t,o,c,d;for(let r=0;r<a.length-1;r++)if(e>=a[r].offset&&e<=a[r+1].offset){t=a[r].color,o=a[r+1].color,c=a[r].offset,d=a[r+1].offset;break}const u=n(t,o,(e-c)/(d-c));i.push(r(...u))}return i},ee=e=>{let{gradientDirection:t,colors:o}=e;const r=J({colors:o});return"linear-gradient(".concat(t,", ").concat(r.map((e=>"".concat(e.color," ").concat(100*e.offset,"%"))).join(", "),")")},te=e=>{let{colors:t,optionalMinValue:o,optionalMaxValue:r}=e;return J({colors:t,optionalMinValue:o,optionalMaxValue:r}).map((e=>({color:e.color,offset:100*e.offset+"%"})))},oe=e=>{let{id:t,colors:o}=e;return(0,z.jsx)("svg",{width:0,height:0,visibility:"hidden",children:(0,z.jsx)("defs",{children:(0,z.jsx)("linearGradient",{id:t,x1:"0",y1:"1",x2:"0",y2:"0",children:o.map(((e,t)=>(0,z.jsx)("stop",{offset:e.offset,stopColor:e.color},t)))})})})},re=40,ne=e=>e?{top:20,right:0,bottom:0,left:20}:{top:30,right:40,bottom:0,left:40},ae=e=>{var t,o,r,n;const{data:a,dateRange:i,valueRange:s,isPortrait:l,options:c}=e,d=ne(l),u=(0,D.Z)(),h=(e,t)=>{const o=new Date(e),r=o.getDay(),n=0===r||1===r,a=new Date(t.min).getFullYear(),i=o.getFullYear()===a;return n&&i},p=K({colors:null===c||void 0===c||null===(t=c.colorAxis)||void 0===t?void 0:t.colors,numSteps:20}),m=()=>(0,z.jsx)(se,{valueRange:s,colorAxis:null===c||void 0===c?void 0:c.colorAxis,isPortrait:l});return(0,z.jsxs)(z.Fragment,{children:["none"!==(null===c||void 0===c||null===(o=c.legend)||void 0===o?void 0:o.position)&&m(),m(),(0,z.jsx)(X.DQ,{data:a,from:null===i||void 0===i?void 0:i.min,to:null===i||void 0===i?void 0:i.max,emptyColor:"transparent",theme:{text:{fill:u.palette.text.secondary},fontSize:"0.75rem",tooltip:{container:{background:"dark"===u.palette.mode?"#2b2b2b":"#fff",color:u.palette.text.primary}},axis:{ticks:{line:{stroke:"dark"===u.palette.mode?"#2b2b2b":"#fff"},text:{fill:u.palette.text.primary}}},grid:{line:{stroke:"dark"===u.palette.mode?"#2b2b2b":"#fff"}}},colors:p,minValue:null===c||void 0===c||null===(r=c.colorAxis)||void 0===r?void 0:r.minValue,maxValue:null===c||void 0===c||null===(n=c.colorAxis)||void 0===n?void 0:n.maxValue,margin:d,yearSpacing:re,monthBorderColor:u.palette.text.primary,monthBorderWidth:1,daySpacing:.25,dayBorderWidth:0,tooltip:e=>{let{day:t,value:o,color:r}=e;const n=a.find((e=>e.day===t)),s=n?(l=n.tooltip,(new DOMParser).parseFromString(l,"text/html").body.innerHTML):"";var l;return(0,z.jsx)(ie,{day:t,color:r,tooltipText:s,dateRange:i,inFirstTwoRowsOfChart:h})}})]})},ie=e=>{let{day:t,color:o,tooltipText:n,dateRange:a,inFirstTwoRowsOfChart:i}=e;const l=(0,r.useRef)(null);return(0,r.useEffect)((()=>{if(l.current&&i(t,a)){const e=l.current.parentElement;e&&(e.style.top="11vh")}}),[l,i]),(0,z.jsxs)(c.Z,{ref:l,className:"nivo-tooltip",children:[(0,z.jsx)(I.Z,{sx:{backgroundColor:o,mr:.5,height:"10px",width:"10px",borderRadius:"50%"}}),(0,s.ZP)(n,{replace:$.T1})]})},se=e=>{let{valueRange:t,colorAxis:o,isPortrait:r}=e;if(null===(null===t||void 0===t?void 0:t.min)||null===(null===t||void 0===t?void 0:t.max))return null;const{colors:n,minValue:a,maxValue:i}=o,s=(0,D.Z)(),l=e=>"".concat((e-a)/(i-a)*100,"%"),d={position:"absolute",fontSize:"0.75rem",color:s.palette.text.secondary},u={position:"absolute",width:0,height:0,borderLeft:"0.25rem solid transparent",borderRight:"0.25rem solid transparent",transform:"translateX(-50%)"},h={top:"-0.5rem",borderTop:"0.25rem solid ".concat(s.palette.text.secondary)},p={bottom:"-0.5rem",borderBottom:"0.25rem solid ".concat(s.palette.text.secondary)};return(0,z.jsx)(c.Z,{sx:{position:"sticky",width:"fit-content",marginTop:"1.5rem",float:"right",right:r?"0":"5%"},children:(0,z.jsxs)(c.Z,{sx:{background:ee({gradientDirection:"to right",colors:n}),color:s.palette.text.secondary,border:"1px solid ".concat(s.palette.text.secondary),width:"300px",height:"1rem",position:"relative",justifyContent:"space-between"},children:[(0,z.jsxs)("span",{style:{...d,top:"-1.5rem",transform:"translateX(-100%)",left:l(t.min)},children:["min: ",t.min]}),(0,z.jsxs)("span",{style:{...d,bottom:"-1.5rem",left:l(t.max)},children:["max: ",t.max]}),(0,z.jsx)("div",{style:{...u,...h,left:l(t.min)}}),(0,z.jsx)("div",{style:{...u,...p,left:l(t.max)}})]})})};var le=o(7161),ce=(o(42978),o(666),o(13239)),de=o(94294),ue=o(35527),he=o(42755),pe=o(3874),me=o(4531),xe=o(62573);const ge=e=>{let{today:t,minDateOfDataset:o,aggregationType:r}=e;const n=[{label:"Last 14d",range:()=>({startDate:(0,he.b)((0,pe.E)(t,-14)),endDate:(0,me.i)(t)})},{label:"Last 30d",range:()=>({startDate:(0,he.b)((0,pe.E)(t,-30)),endDate:(0,me.i)(t)})}],a=[{label:"Last 90d",range:()=>({startDate:(0,he.b)((0,pe.E)(t,-90)),endDate:(0,me.i)(t)})},{label:"Last 365d",range:()=>({startDate:(0,he.b)((0,pe.E)(t,-365)),endDate:(0,me.i)(t)})},{label:"All Time",range:()=>({startDate:o,endDate:(0,me.i)(t)})}];return r===xe.Z.hourly?n:[...n,...a]},fe=(0,l.ZP)(ue.Z)((e=>{let{theme:t,showPickerPanel:o,smallScreen:r}=e;return{zIndex:!0===o&&1e3,position:"relative",padding:o?t.spacing(1):0,margin:o&&!r?t.spacing(-1):0,maxWidth:"100%",background:o?t.palette.customAlternateBackground:"transparent",boxShadow:!1===o&&"none","& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary},"& .rdrDateDisplayWrapper, .rdrCalendarWrapper, .rdrDefinedRangesWrapper, .rdrStaticRange, .rdrDateDisplayItem":{background:"transparent"},"& .rdrDateInput":{borderRadius:t.shape.borderRadius,boxShadow:"none"},"& .rdrDateDisplayItemActive":{border:!1===o&&"none"},"& .rdrDateDisplay":{margin:0,minWidth:"20rem"},"& .rdrDateDisplayItem":{margin:0,borderRadius:o?t.shape.borderRadius:0,"&:hover:not(.rdrDateDisplayItemActive)":{border:o?"1px solid ".concat(t.palette.action.disabled):"none"}},"& .rdrDateDisplayItem:hover:not(.rdrDateDisplayItemActive)":{border:!1===o&&"1px solid transparent"},"& .rdrDateDisplayItem + .rdrDateDisplayItem":{margin:0},"& .rdrDateDisplayItem:first-of-type":{borderRight:!1===o&&"1px solid ".concat(t.palette.action.disabled," !important")},"& .rdrMonthAndYearWrapper, .rdrInputRanges":{display:!1===o&&"none !important",padding:0},"& .rdrMonthName":{display:"none"},"& .rdrDefinedRangesWrapper, .rdrMonths":{display:!1===o&&"none"},"&  .rdrInfiniteMonths":{visibility:!1===o&&"hidden",width:"100% !important",maxWidth:"675px",margin:"auto"},"& .rdrDateDisplayWrapper":{minWidth:"18rem",borderRadius:t.shape.borderRadius,border:o?"none":"1px solid ".concat(t.palette.action.disabled),"&:hover":{border:o?"none":"1px solid ".concat(t.palette.text.primary)}},"& .rdrDateRangePickerWrapper":{width:"100%",flexDirection:"column-reverse"},"& .rdrStaticRanges":{flexDirection:"row",minWidth:"21rem"},"& .rdrStaticRangeLabel":{color:t.palette.text.secondary,borderRadius:t.shape.borderRadius,padding:"".concat(t.spacing(.5)," ").concat(t.spacing(1))},"& .rdrDefinedRangesWrapper":{border:"none",width:"100%"},"& .rdrNextPrevButton":{background:t.palette.primary.main,borderRadius:t.shape.borderRadius,opacity:1,"&:hover":{opacity:.5,background:t.palette.primary.main}},"& .rdrNextPrevButton > i":{color:"white"},"& .rdrNextButton > i":{borderColor:"transparent transparent transparent white"},"& .rdrPprevButton > i":{borderColor:"transparent white transparent transparent"},"& .rdrStaticRange":{border:"none"},"& .rdrStaticRangeSelected > .rdrStaticRangeLabel, .rdrMonthAndYearPickers":{color:t.palette.primary.main},"& .rdrMonthAndYearPickers":{fontSize:"1rem"},"& .rdrStaticRange:hover .rdrStaticRangeLabel, .rdrStaticRange:focus .rdrStaticRangeLabel":{background:t.palette.customBackground.toString()},"& .rdrDayNumber span":{color:t.palette.text.primary.toString()},"& .rdrDayPassive .rdrDayNumber span":{opacity:.5},"& .rdrMonthAndYearWrapper select":{color:t.palette.text.secondary.toString(),background:"none",padding:"".concat(t.spacing(1)," ").concat(t.spacing(2)),"&:hover":{border:"1px solid ".concat(t.palette.text.secondary)}},"& .rdrDateDisplayItem input":{color:t.palette.text.secondary},"& .rdrDayDisabled":{backgroundColor:t.palette.customBackground},"& .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfMonth .rdrStartEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge, .rdrEndEdge, .rdrDayEndOfMonth .rdrDayInPreview, .rdrDayEndOfMonth .rdrDayStartPreview, .rdrDayEndOfWeek .rdrDayInPreview, .rdrDayEndOfWeek .rdrDayStartPreview, .rdrDayEndPreview":{borderTopRightRadius:"2rem",borderBottomRightRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfWeek .rdrEndEdge, .rdrDayStartOfMonth .rdrDayInPreview, .rdrDayStartOfMonth .rdrDayEndPreview, .rdrDayStartOfWeek .rdrDayInPreview, .rdrDayStartOfWeek .rdrDayEndPreview, .rdrDayStartPreview":{borderTopLeftRadius:"2rem",borderBottomLeftRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrEndEdge":{left:0},"& .rdrEndEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge":{right:0},"& .rdrSelected, .rdrInRange, .rdrStartEdge, .rdrEndEdge":{top:"0px",bottom:"0px"},"& .rdrMonths":{justifyContent:"center",alignItems:"center"},"& .rdrDay":{marginBottom:"1px","& span":{top:"0px",bottom:"0px"}},"& .rdrMonthsHorizontal":{overflowY:"hidden"},"& .rdrDateInput:first-of-type:before":{content:'""',backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' class='MuiSvgIcon-root' focusable='false' aria-hidden='true' viewBox='0 0 24 24' data-testid='DateRangeIcon'%3E%3Cpath d='M9 11H7v2h2zm4 0h-2v2h2zm4 0h-2v2h2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V9h14z' fill='".concat(t.palette.text.secondary,"'/%3E%3C/svg%3E\")"),width:"0.75rem",height:"0.75rem",display:"block",position:"absolute",top:"50%",transform:"translateY(-50%)",left:"0.75rem"},"& .rdrStaticRangeSelected span":{color:t.palette.primary.main},"& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary.main,width:"0.25rem",height:"0.25rem",borderRadius:"50%"}}}));var ve=o(77997),ye=o(40630);function be(e){let{aggregationType:t,setAggregationType:o,smallScreen:r}=e;return(0,z.jsxs)(p.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,z.jsx)(g.Z,{variant:"caption",display:"block",color:"text.secondary",children:"DATA AVERAGE"}),(0,z.jsxs)(ve.Z,{color:"primary",value:t,exclusive:!0,onChange:(e,t)=>{null!==t&&o(t)},"aria-label":"aggregation type toggle for graph average",size:"small",children:[(0,z.jsx)(ye.Z,{size:"small",sx:{textTransform:"capitalize !important",px:1.25,py:.5},value:xe.Z.hourly,"aria-label":xe.Z.hourly,children:xe.Z.hourly}),(0,z.jsx)(ye.Z,{size:"small",sx:{textTransform:"capitalize !important",px:1.25,py:.5},value:xe.Z.daily,"aria-label":xe.Z.daily,children:xe.Z.daily})]})]})}var je=o(2165),Se=o(33026),we=o(87210);const De="HOURLY data is limited to max 30d",Ze="Start and end dates must be different",Ce=e=>(0,z.jsx)(S.Z,{severity:"error",sx:{py:.5,px:1,display:"flex",alignItems:"center","& div":{fontSize:"0.75rem",p:0},"& .MuiAlert-icon":{fontSize:"1rem",mr:.5}},children:e}),ke=e=>{const{minDateOfDataset:t}=e,{currentSchoolID:o,setIndividualChartData:n}=(0,r.useContext)(b.G),[i,s]=(0,r.useState)(xe.Z.hourly),l=new Date,[c,d]=(0,r.useState)(),u=(0,D.Z)(),m=(0,h.Z)(u.breakpoints.down("sm")),[x,g]=(0,r.useState)([{...ge({today:l,minDateOfDataset:t})[0].range(),key:"selection"}]),[f,v]=(0,r.useState)(),[j,S]=(0,r.useState)(!1),w=(0,r.useRef)(null),[Z,C]=(0,r.useState)(!1);(0,r.useEffect)((()=>{const e=e=>{w.current&&!w.current.contains(e.target)&&S(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[w]);const k=e=>{const{startDate:t,endDate:o}=e;if((0,je.K)(t,o))d(Ze);else if(d(null),i===xe.Z.hourly){const e=(0,Se.j)(o,t);d(e>30?De:null)}else null!==c&&d(null)};(0,r.useEffect)((()=>{k(x[0])}),[i]);return(0,z.jsx)(fe,{showPickerPanel:j,smallScreen:m,ref:w,elevation:8,onClick:()=>S(!0),children:(0,z.jsxs)(p.Z,{direction:"column",spacing:1,children:[(0,z.jsx)(le.Dw,{ranges:x,onChange:e=>{e&&(k(e.selection),g([e.selection]))},staticRanges:(0,le.$z)(ge({today:l,minDateOfDataset:t,aggregationType:i})),inputRanges:[],rangeColors:[u.palette.primary.main,u.palette.secondary.main,u.palette.text.secondary],minDate:t,maxDate:l,months:1,showMonthAndYearPickers:!1,direction:"horizontal",fixedHeight:!0,preventSnapRefocus:!0,calendarFocus:"backwards",startDatePlaceholder:"Start Date",endDatePlaceholder:"End Date",editableDateInputs:!0,showMonthArrow:!0}),j&&(0,z.jsxs)(p.Z,{direction:"column",alignItems:"end",width:"100%",spacing:1,children:[(0,z.jsx)(be,{aggregationType:i,setAggregationType:s,smallScreen:m}),(0,z.jsxs)(p.Z,{direction:"row",spacing:1,children:[c&&Ce(c),(0,z.jsx)(de.Z,{variant:"contained",size:"small",disabled:null!==c,onClick:e=>{if(null!==c)return;e.stopPropagation();const t=(0,y.kq)({endpoint:y.ZU.historical,school_id:o,aggregationType:i,startDate:(0,we.WU)(x[0].startDate,"yyyy-MM-dd"),endDate:(0,we.WU)(x[0].endDate,"yyyy-MM-dd")});t!==f&&(C(!0),(0,a.m)({url:t,extension:"json",needsAuthorization:!0}).then((e=>{n(0,e),v(t),C(!1),S(!1)})).catch((e=>{console.log(e)})))},sx:{zIndex:1005,transform:"translateY(-1px)"},children:Z?(0,z.jsx)(ce.Z,{disableShrink:!0,size:"1.4375rem",color:"inherit"}):"APPLY"})]})]})]})})},Te=e=>{let{dataType:t}=e;return(0,z.jsxs)(S.Z,{severity:"error",sx:{my:2},children:["This sensor does not have\xa0",(0,z.jsx)(c.Z,{component:"span",textTransform:"capitalize",children:t}),"\xa0data"]})};function Ae(e){var t,o;const{chartData:n,subchartIndex:a,windowSize:i,isPortrait:s,isHomepage:l,height:d,maxHeight:u,selectedDataType:h}=e,m=n.customClassName?"".concat(n.chartType," ").concat(n.customClassName):n.chartType,x=(0,r.useContext)(j.R),[g,f]=(0,r.useState)(),[v,y]=(0,r.useState)(),[b,S]=(0,r.useState)(),[Z,C]=(0,r.useState)(),[k,T]=(0,r.useState)(),A=(0,D.Z)(),[I,P]=(0,r.useState)(!0),[E,M]=(0,r.useState)(!0),[R,F]=(0,r.useState)(),[N,Q]=(0,r.useState)(),[X,J]=(0,r.useState)(),[K,ee]=(0,r.useState)(B()),[ie,se]=(0,r.useState)(200);let le=(0,r.useMemo)((()=>{let t=H({...e,theme:A});return"Calendar"===n.chartType&&(t=U(t)),t}),[e,A,n.chartType]);const[ce,de]=(0,r.useState)(null),[ue,he]=(0,r.useState)(200),[pe,me]=(0,r.useState)(1200);if("Calendar"===n.chartType)return(0,r.useEffect)((()=>{const e=n.dataArray||n.subcharts&&n.subcharts[a].dataArray||null;if(!(0,$.qt)(e))return void M(!1);const t=e.map((e=>e.day)),o=e.map((e=>e.value)),r=_(t);de({data:e,dateRange:r,valueRange:L(o)});const i=new Date(r.min).getFullYear(),l=new Date(r.max).getFullYear()-i+1,c=7*Math.min(pe/60,20),d=ne(s);let u;u=1==l?c+re+d.top+d.bottom:l*(c+re)+d.top+d.bottom,he(u),M(!0)}),[n]),E?(0,z.jsx)(Y,{isPortrait:s,className:m,style:{position:"relative",minWidth:"700px",minHeight:s?"200px":"".concat(ue,"px"),height:"".concat(ue,"px"),maxHeight:s?"550px":"none"},children:ce?(0,z.jsx)(ae,{data:ce.data,dateRange:ce.dateRange,valueRange:ce.valueRange,isPortrait:s,options:le}):(0,z.jsx)(c.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,z.jsx)(G.Z,{})})}):(0,z.jsx)(Te,{dataType:h});let xe,ge=!1,fe=n.control||(null===(t=n.subcharts)||void 0===t?void 0:t[a].control);fe&&!0!==l&&(ge=!0,xe={...fe.options,ui:V({chartControl:fe,mainChartData:n,mainChartOptions:le,subchartIndex:a,theme:A,isPortrait:s})},"ChartRangeFilter"===fe.controlType&&(0,r.useEffect)((()=>q({controlWrapper:Z,chartID:K})),[Z]));const ve=le.seriesSelector||!1,ye=le.dateRangePicker||null;(0,r.useEffect)((()=>{ve?Se({newDataColumns:N}):(null===v||void 0===v||v.setOptions({...le,..."Calendar"===n.chartType&&{height:ie}}),null===v||void 0===v||v.draw(),ge&&(null===Z||void 0===Z||Z.setOptions(xe),null===Z||void 0===Z||Z.draw()))}),[A,s,i,ie]),(0,r.useEffect)((()=>{N&&ve&&"setViewColumn"==ve.method&&(be({dataColumns:N}),Se({newDataColumns:N}))}),[A]);const be=e=>{let{dataColumns:t}=e;t.forEach((e=>{var t;e.color=le.colors[e.seriesIndex%le.colors.length],e.serieAttribute=null===(t=le.series)||void 0===t?void 0:t[e.seriesIndex]}))},je=e=>{let t,o,{dataTable:r,allInitialColumns:n}=e;return n.forEach(((e,n)=>{if(0===n)return;const a=r.getColumnRange(e.sourceColumn);!isNaN(a.min)&&a.min&&(t=t?Math.min(t,a.min):a.min),!isNaN(a.max)&&a.max&&(o=o?Math.max(o,a.max):a.max)})),{min:t,max:o}},Se=e=>{let{newDataColumns:t,_allInitialColumns:o=R,_chartWrapper:r=v,_controlWrapper:n=Z}=e;if(o){if(Q(t),"toggleVisibility"===ve.method||null===ve.method){const e={};if(t.forEach((t=>{t.selected||(e[t.seriesIndex]={color:"transparent",enableInteractivity:!1,visibleInLegend:!1})})),null===r||void 0===r||r.setOptions({...le,series:{...le.series,...e}}),ge){const t=null===n||void 0===n?void 0:n.getOptions();null===n||void 0===n||n.setOptions({...t,ui:{...t.ui,chartOptions:{...t.ui.chartOptions,series:{...le.series,...e}}}})}}else if("setViewColumn"===ve.method){let e=[];e.push(0),t.forEach((t=>{if(t.selected){e.push(t);for(let r=t.indexIn_+1;r<o.length&&"data"!==o[r].role;r++)e.push(o[r])}})),null===r||void 0===r||r.setView({columns:e});const a={...le};a.colors=t.filter((e=>e.selected)).map((e=>e.color));const i={};let s=0;if(t.forEach((e=>{e.selected&&(null!=e.serieAttribute&&(i[s]=e.serieAttribute),s++)})),a.series=i,null===r||void 0===r||r.setOptions(a),ge){const t=null===n||void 0===n?void 0:n.getOptions();null===n||void 0===n||n.setOptions({...t,ui:{...t.ui,chartOptions:{...t.ui.chartOptions,colors:a.colors,series:a.series},chartView:{columns:e}}})}}null===r||void 0===r||r.draw(),ge&&(null===n||void 0===n||n.draw())}};(0,r.useEffect)((()=>{if(x&&n){if(JSON.stringify(n)===JSON.stringify(k))return;T(n);const e=n.dataArray||n.subcharts&&n.subcharts[a].dataArray||null;if(!(0,$.qt)(e))return void M(!1);const t=x.visualization.arrayToDataTable(e);f(t);const o=(e=>{if(!e)return;const t=[];for(const o of e)if("number"===typeof o)t.push(o);else if("object"===typeof o)if(o.calc&&"stringify"!==o.calc){const e=new Function("dataTable","rowNum",o.calc);t.push({...o,calc:e})}else t.push(o);return t})(n.columns||n.subcharts&&n.subcharts[a].columns||null),r=new x.visualization.ChartWrapper({chartType:n.chartType,dataTable:ge?void 0:t,options:le,view:{columns:o},containerId:K});let i;if(y(r),ge){const e=new x.visualization.Dashboard(document.getElementById("dashboard-".concat(K)));S(e),x.visualization.events.addListener(e,"ready",ze),i=new x.visualization.ControlWrapper({controlType:fe.controlType,options:xe,containerId:"control-".concat(K)}),C(i),e.bind(i,r),e.draw(t)}else x.visualization.events.addListener(r,"ready",ze),r.draw();if(ve){const{initAllInitialColumns:e,initDataColumns:o}=(e=>{let{chartWrapper:t,dataTable:o,seriesSelector:r}=e;var n=t.getView();if(null==n.columns){const e=new x.visualization.DataView(o);t.setView({columns:e.columns}),n=t.getView()}let a=!0,i=0;const s=n.columns.map(((e,t)=>("number"===typeof e&&(e={role:a?"domain":"data",sourceColumn:e}),e.label=o.getColumnLabel(e.sourceColumn),e.indexInAllInitialColumns=t,a=a&&!1,"data"===e.role&&(r.defaultSeriesToDisplayInitially?r.defaultSeriesToDisplayInitially.includes(t)?e.selected=!0:e.selected=!1:r.allowMultiple?e.selected=!0:e.selected=0===i,e.seriesIndex=i,i++),e)));F(s);const l=je({dataTable:o,allInitialColumns:s});J(l);const c=s.filter((e=>{var t,o;return"data"===e.role&&!1!==(null===(t=le.series)||void 0===t||null===(o=t[e.seriesIndex])||void 0===o?void 0:o.visibleInLegend)}));return"setViewColumn"===r.method&&be({dataColumns:c}),Q(c),{initAllInitialColumns:s,initDataColumns:c}})({chartWrapper:r,dataTable:t,seriesSelector:ve});Se({_allInitialColumns:e,newDataColumns:o,_chartWrapper:r,_controlWrapper:i})}M(!0)}}),[x,n]);let we,De,Ze=null===(o=le.backgroundColor)||void 0===o?void 0:o.fill;var Ce,Ae,Ie,Pe;("transparent"===Ze&&(Ze=null),Ze)&&(we="".concat(K,"-backgroundGradient"),De=te({colors:A.palette.chart.colorAxes[Ze].colors,optionalMinValue:null===(Ce=le.vAxis)||void 0===Ce||null===(Ae=Ce.viewWindow)||void 0===Ae?void 0:Ae.min,optionalMaxValue:null===(Ie=le.vAxis)||void 0===Ie||null===(Pe=Ie.viewWindow)||void 0===Pe?void 0:Pe.max}));const ze=()=>{I&&P(!1)};return E?(0,z.jsxs)(Y,{isPortrait:s,gradientBackgroundId:we,className:m,position:"relative",height:"100%",minHeight:"Calendar"===n.chartType&&"200px",children:[I&&(0,z.jsx)(c.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,z.jsx)(G.Z,{})}),I?null:(0,z.jsxs)(w.ZP,{container:!0,mt:1,sx:{gap:2,[A.breakpoints.down("sm")]:{gap:1}},children:[ve&&(0,z.jsx)(w.ZP,{item:!0,sx:{[A.breakpoints.down("sm")]:{width:"100%"}},children:(0,z.jsx)(O,{items:N,allowMultiple:ve.allowMultiple,seriesLabel:ve.seriesLabel,selectorID:"".concat(n.title,"-selector"),onSeriesSelection:Se,displayChip:!1})}),ye&&(0,z.jsx)(w.ZP,{item:!0,sx:{height:"2rem",width:{[A.breakpoints.down("sm")]:{width:"100%"}}},children:(0,z.jsx)(ke,{minDateOfDataset:new Date(ye.minDate)})})]}),(()=>{var e;return ge?(0,z.jsxs)(p.Z,{id:"dashboard-".concat(K),direction:(null===(e=W[fe.controlType])||void 0===e?void 0:e.stackDirection)||"column-reverse",sx:{height:"100%"},children:[(0,z.jsx)(c.Z,{id:"control-".concat(K),sx:{height:"calc(".concat(d," / 8)"),opacity:.8,filter:"saturate(0.3)"}}),(0,z.jsx)(c.Z,{id:K,sx:{height:d,maxHeight:u}})]}):(0,z.jsx)(c.Z,{id:K,sx:{height:d,maxHeight:u}})})(),Ze?(0,z.jsx)(oe,{id:we,colors:De}):null]}):(0,z.jsx)(Te,{dataType:h})}var Ie=o(53767);const Pe=function(e){let{text:t,wordLimit:o=40,reference:n}=e;const[a,i]=(0,r.useState)(!1),l=(0,D.Z)(),d=(0,h.Z)(l.breakpoints.down("sm")),u=(0,r.useRef)(null),p=t.split(" ");if(!d||p.length/o<=1.4)return(0,z.jsxs)(c.Z,{children:[(0,z.jsx)(g.Z,{children:(0,s.ZP)(t,{replace:$.T1})}),n&&(0,z.jsx)(g.Z,{variant:"caption",color:"text.secondary",children:(0,s.ZP)(n,{replace:$.T1})})]});let m=p.slice(0,o).join(" ");const x=m.lastIndexOf(".");return-1!==x&&(m=m.slice(0,x+1)),(0,z.jsx)(Ie.d,{onClickAway:e=>{(e=>{let{target:t}=e;const o=u.current.closest(".MuiContainer-root"),r=new Set(["rect","path","svg","circle"]);for(;null!=t;){if(r.has(t.tagName))return t.closest(".MuiContainer-root")===o;t=t.parentNode}return!1})(e)||i(!1)},children:(0,z.jsx)(c.Z,{ref:u,onClick:()=>i(!a),style:{cursor:"pointer"},children:a?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(g.Z,{children:(0,s.ZP)(t,{replace:$.T1})}),n&&(0,z.jsx)(g.Z,{variant:"caption",color:"text.secondary",children:(0,s.ZP)(n,{replace:$.T1})})]}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(g.Z,{display:"inline",children:[(0,s.ZP)(m,{replace:$.T1}),"..."]}),(0,z.jsx)(g.Z,{display:"inline",color:"text.primary",fontWeight:"500",sx:{ml:.5,"& :hover":{textDecoration:"underline"}},children:"See more"})]})})})};var ze=o(26759);const Ee=e=>{let{selectedDataType:t,dataTypes:o,fetchChartDataType:n}=e;const[a,i]=(0,r.useState)(null);if(!(0,$.qt)(o))return null;if(o.length<=1)return(0,z.jsx)(g.Z,{display:"inline",variant:"h6",color:"text.primary",children:o[0].name_title});const s=Boolean(a),l=()=>{i(null)};return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(de.Z,{id:"data-type-drop-down-menu-button","aria-controls":s?"data-type-drop-down-menu":void 0,"aria-haspopup":"true","aria-expanded":s?"true":void 0,onClick:e=>{i(e.currentTarget)},variant:"text",size:"small",sx:{p:0,minWidth:"unset",borderRadius:0,verticalAlign:"top",textTransform:"capitalize"},children:[(0,z.jsx)(g.Z,{display:"inline",variant:"h6",borderBottom:"dotted",children:o.filter((e=>e.key===t)).map((e=>e.name_title))}),(0,z.jsx)(ze.Z,{})]}),(0,z.jsx)(x.Z,{id:"data-type-drop-down-menu",anchorEl:a,open:s,onClose:l,MenuListProps:{"aria-labelledby":"data-type-drop-down-menu-button"},children:o.map(((e,t)=>(0,z.jsx)(u.Z,{sx:{fontSize:"0.8rem"},onClick:()=>(e=>{n(e),l()})(e.key),children:e.name_title},t)))})]})},Me=(0,l.ZP)(c.Z)((e=>{let{theme:t}=e;return{..."dark"===t.palette.mode&&{filter:"saturate(0.85)","& .heat-map-iframe":{filter:"invert(0.848) hue-rotate(180deg)"}},'& .historical-snapshot-aqi svg [clip-path*="ABSTRACT_RENDERER"] > g:nth-of-type(1), .historical-snapshot-aqi [id*="googlechart-control"] svg [clip-path*="ABSTRACT_RENDERER"] > g:nth-of-type(2)':{opacity:.6},"& .Calendar [dir]:not(:empty)":{margin:"auto"},"& .Calendar > div > div:last-of-type > div":{overflowX:"auto",overflowY:"hidden",scrollbarGutter:"stable"}}})),Re=(0,l.ZP)(d.Z)((e=>{let{theme:t}=e;return{"& .MuiTabScrollButton-root":{color:t.palette.text.primary},"& .MuiTab-root":{[t.breakpoints.down("sm")]:{fontSize:"0.625rem",padding:t.spacing(.5)}},"& .MuiSvgIcon-root ":{[t.breakpoints.down("sm")]:{fontSize:"0.75rem"}}}})),Oe=(0,l.ZP)(u.Z)((e=>{let{theme:t}=e;return{"& .MuiBox-root ":{[t.breakpoints.down("sm")]:{fontSize:"0.75rem"}}}}));const We=function(e){const{chartTitle:t,generalChartSubtitle:o,generalChartReference:n,chartData:i,chartHeight:s,chartID:l,chartIndex:d,isHomepage:u}=e,{currentSchoolID:j,setIndividualChartData:S}=(0,r.useContext)(b.G),w=(0,h.Z)((e=>e.breakpoints.down("sm"))),[D,Z]=(0,r.useState)(window.matchMedia("(orientation: portrait)").matches),[C,k]=(0,r.useState)([window.innerWidth,window.innerHeight]);let T,A=s;const I=i,[E,M]=(0,r.useState)(0),[R,O]=(0,r.useState)(0),[W,_]=(0,r.useState)(-1),[L,B]=(0,r.useState)(),[F,N]=(0,r.useState)(null),{allowedDataTypes:H}=I,[U,V]=(0,r.useState)(null);return(0,r.useEffect)((()=>{V(I.selectedDataType)}),[I]),(0,r.useEffect)((()=>{let e=null;const t=()=>{clearTimeout(e),e=setTimeout((()=>{Z(window.matchMedia("(orientation: portrait)").matches),k([window.innerWidth,window.innerHeight])}),100)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}}),[I]),(0,r.useEffect)((()=>{O(E),M(0)}),[j]),"Calendar"===I.chartType||A||(A=D?"80vw":"35vw",T=D?"800px":"500px"),t?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(c.Z,{children:[(0,z.jsxs)(g.Z,{display:"inline",variant:"h6",color:"text.primary",children:[d+1,". ",t,"\xa0"]}),(0,z.jsx)(c.Z,{display:"inline",children:(0,z.jsx)(Ee,{selectedDataType:U,dataTypes:H,fetchChartDataType:async e=>{const t=y.UA[l];(0,a.m)({url:(0,y.Eh)({endpoint:t,school_id:j,dataType:e}),extension:"json",needsAuthorization:!0}).then((e=>{S(l,e),V(e.selectedDataType)})).catch((e=>{console.log(e)}))}})})]}),(0,z.jsxs)(Me,{height:"100%",children:[I.subcharts?(()=>{const e=I.subcharts.length>4,t=e?I.subcharts.slice(0,3):I.subcharts,o=e?I.subcharts.slice(3):null,r=e=>-1===E?R===e:E===e;return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(Re,{value:E,onChange:(t,o)=>{O(E),M(o),e&&o<3&&o!==W&&(B(),_(-1))},variant:w?"fullWidth":"standard",children:[t.map(((e,t)=>(0,z.jsx)(m.Z,{value:t,label:I.subcharts[t].subchartTitle,sx:{textDecoration:!(0,$.qt)(I.subcharts[t].dataArray)&&"line-through"}},t))),e&&(0,z.jsx)(m.Z,{value:W,label:(0,z.jsxs)(p.Z,{direction:"row",justifyContent:"center",alignItems:"center",children:[(0,z.jsxs)(c.Z,{flex:1,children:["Other sensors",L&&" (".concat(L,")"),"\xa0"]}),(0,z.jsx)(v.Z,{})]}),"aria-controls":"submenu","aria-haspopup":"true",onClick:e=>N(e.currentTarget)})]}),e&&(0,z.jsx)(x.Z,{id:"submenu",anchorEl:F,open:Boolean(F),onClose:()=>{-1===E&&(O(E),M(R)),N(null)},children:o.map(((e,t)=>(0,z.jsx)(Oe,{selected:t===E-3,onClick:()=>(e=>{O(E),M(3+e),_(3+e),B(o[e].subchartTitleShort),N(null)})(t),sx:{textDecoration:!(0,$.qt)(I.subcharts[t+3].dataArray)&&"line-through"},children:(0,z.jsxs)(p.Z,{direction:"row",alignItems:"center",gap:1,children:[(0,z.jsx)(c.Z,{children:o[t].subchartTitle}),t===E-3&&(0,z.jsx)(P.Z,{fontSize:"1rem",sx:{color:"text.secondary"}})]})},t)))}),(0,z.jsx)(c.Z,{position:"relative",sx:{overflowX:D&&"auto",WebkitOverflowScrolling:D&&"touch",overflowY:"hidden"},children:I.subcharts.map(((e,t)=>(0,z.jsx)(c.Z,{width:"100%",height:"100%",role:"tabpanel",sx:{transition:"0.35s",position:0===t?"":"absolute",opacity:r(t)?"1":"0",pointerEvents:r(t)?"auto":"none",top:0===t?"":0},children:(0,z.jsx)(Ae,{selectedDataType:U,chartData:I,subchartIndex:t,isPortrait:D,isHomepage:u,windowSize:C,height:I.height?I.height:A,maxHeight:["Calendar"].includes(I.chartType)?"":T})},t)))})]})})():(0,z.jsx)(Ae,{selectedDataType:U,chartData:I,isPortrait:D,isHomepage:u,windowSize:C,height:I.height?I.height:A}),(0,z.jsx)(c.Z,{sx:{my:3},children:(0,z.jsx)(g.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{mb:1},children:(0,z.jsx)(Pe,{text:(()=>{var e;let t=o||"";return I.subcharts&&null!==(e=I.subcharts[E])&&void 0!==e&&e.subchartSubtitle&&(t+="<br/>",t+=I.subcharts[E].subchartSubtitle),t})(),reference:(()=>{var e;let t=n||"";return I.subcharts&&null!==(e=I.subcharts[E])&&void 0!==e&&e.reference&&(t+="<br/>",t+=I.subcharts[E].reference),t})()})})})]})]}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(f.Z,{variant:"text",sx:{width:"100%",fontSize:"2rem"}}),(0,z.jsx)(f.Z,{variant:"rounded",width:"100%",height:300})]})};var _e=o(61745),Le=o(40472),Be=o(20068),Fe=o(89164),Ne=o(94721),He=o(30604),Ue=o(60173),Ve=o(49877),Qe=o(55396),qe=o(60627),Ye=o(61162),Ge=o(53524),Xe=o(47438),$e=o(80223);function Je(e){const[t,o]=(0,r.useState)(null),n=e=>{o(e.currentTarget),Xe.y(Xe.z.airQualityIndexLegendQuickGlance)},a=()=>{o(null)},i=Boolean(t);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Ge.TF,{...e,distanceFromBottomOfWindow:"5.5rem",children:(0,z.jsx)(Ve.Z,{sx:{mt:1},"aria-owns":i?Xe.z.airQualityIndexLegendQuickGlance:void 0,"aria-haspopup":"true",onMouseEnter:n,onMouseLeave:a,onClick:e=>Ue.tq&&(i?a():n(e)),"aria-label":Xe.z.airQualityIndexLegendQuickGlance,color:"primary",children:(0,z.jsxs)(p.Z,{direction:"column",alignItems:"center",children:[(0,z.jsx)(Ye.Z,{fontSize:"1rem"}),(0,z.jsx)(g.Z,{variant:"body2",fontWeight:"500",children:"AQI"})]})})}),(0,z.jsx)(Qe.Z,{id:Xe.z.airQualityIndexLegendQuickGlance,sx:{pointerEvents:"none",mt:-1},open:i,anchorEl:t,placement:"top-end",onClose:a,keepMounted:!0,disableRestoreFocus:!0,transition:!0,children:e=>{let{TransitionProps:t}=e;return(0,z.jsx)(qe.Z,{...t,timeout:350,children:(0,z.jsxs)(ue.Z,{elevation:8,sx:{py:.5,mb:1},children:[(0,z.jsx)(g.Z,{sx:{mx:2,mt:1},color:"text.disabled",variant:"body1",fontWeight:500,children:"AQI at quick glance"}),(0,z.jsx)($e.Z,{isTiny:!0,hideAQIDescription:!0})]})})}})]})}var Ke=o(71478),et=o(40501),tt=o(44281),ot=(o(14058),o(4853)),rt=o(69161),nt=o(29818),at=o(97123),it=o(30195),st=o(80043),lt=o(79836),ct=o(56890),dt=o(35855),ut=o(53994),ht=o(53382),pt=o(73518),mt=o(71566),xt=o(31009);function gt(e){const{currentSchoolID:t,current:o}=(0,r.useContext)(b.G),[n,a]=(0,r.useState)({}),[i,s]=(0,r.useState)("placeholder");(0,r.useEffect)((()=>{if(!o)return;const e=o.filter((e=>e&&e.sensor)).reduce(((e,t)=>(e[t.sensor.location_short]={location_type:t.sensor.location_type,location_short:t.sensor.location_short,location_long:t.sensor.location_long,last_seen:t.sensor.last_seen.split("T")[0],rawDatasets:Object.keys(y.M$).reduce(((e,t)=>(e[y.M$[t]]={sample:null,full:null},e)),{})},e)),{});a(e)}),[o]);const l=(0,D.Z)(),c=(0,h.Z)(l.breakpoints.down("sm")),[d,u]=(0,r.useState)(!1),p=()=>{u(!1)};return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(de.Z,{onClick:()=>{s(null),u(!0),Xe.y(Xe.z.rawDatasetButtonClicked)},variant:"contained",children:[(0,z.jsx)(mt.Z,{sx:{fontSize:"1rem"}}),"\xa0Raw Dataset"]}),(0,z.jsxs)(nt.Z,{open:d,onClose:p,maxWidth:"lg",fullWidth:!0,fullScreen:c,keepMounted:!0,zIndex:1e4,children:[c&&(0,z.jsx)(at.Z,{sx:{justifyContent:"start"},children:(0,z.jsxs)(de.Z,{autoFocus:!0,onClick:p,children:[(0,z.jsx)(xt.Z,{sx:{fontSize:"1rem"}}),"Back"]})}),(0,z.jsxs)(it.Z,{sx:{px:c?2:3,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"start"},children:[(0,z.jsx)(I.Z,{label:t?"School: ".concat(t.toUpperCase()):"No School",size:"small",sx:{mb:1}}),(0,z.jsx)(g.Z,{variant:"h6",zIndex:"10000",sx:{mb:1},children:"Preview and download raw dataset(s)"}),(0,z.jsx)(ft,{sensorsDatasets:n,updateSensorsDatasets:a,previewingDataset:i,setPreviewingDataset:s,smallScreen:c,schoolID:t}),n&&(0,z.jsxs)(g.Z,{variant:"caption",sx:{my:3,fontStyle:"italic"},children:["These datasets are provided by CITIESair from sensors operated by CITIESair. Should you intend to utilize them for your project, research, or publication, we kindly request that you notify us at ",(0,z.jsx)(st.Z,{href:"mailto:nyuad.cities@nyu.edu",children:"nyuad.cities@nyu.edu"})," to discuss citation requirements."]})]})]})]})}const ft=e=>{const{sensorsDatasets:t,updateSensorsDatasets:o,previewingDataset:n,setPreviewingDataset:i,smallScreen:s,schoolID:l}=e;return(0,r.useEffect)((()=>{if(Object.keys(t).length>0&&!n){const e=Object.keys(t)[0],r=y.M$.hourly;if(i({sensor:e,datasetType:r}),t[e].rawDatasets[r].sample)return;const n=(0,y.OM)({school_id:l,sensor_location_short:e,datasetType:r,isSample:!0});(0,a.m)({url:n,extension:"csv",needsAuthorization:!0}).then((n=>{const a={...t};a[e].rawDatasets[r].sample=n,o(a)})).catch((e=>console.log(e)))}}),[t,n]),(0,z.jsxs)(w.ZP,{container:!0,justifyContent:"center",alignItems:"start",spacing:s?1:2,sx:{mt:0},overflow:"scroll",children:[(0,z.jsx)(w.ZP,{item:!0,sm:12,md:6,children:(0,z.jsx)(vt,{schoolID:l,sensorsDatasets:t,updateSensorsDatasets:o,smallScreen:s,previewingDataset:n,setPreviewingDataset:i})}),(0,z.jsx)(w.ZP,{item:!0,sm:12,md:6,maxWidth:s?"100%":"unset",sx:{mt:1},children:(0,z.jsx)(bt,{sensorsDatasets:t,updateSensorsDatasets:o,previewingDataset:n,schoolID:l,smallScreen:s})})]})},vt=e=>{const{schoolID:t,sensorsDatasets:o,smallScreen:r,previewingDataset:n,setPreviewingDataset:a,updateSensorsDatasets:i}=e;return(0,z.jsxs)(lt.Z,{size:"small",sx:{tableLayout:"fixed","& td, div, .MuiMenuItem-root":{fontSize:r?"0.625rem":"0.8rem"}},children:[(0,z.jsx)(ct.Z,{children:(0,z.jsxs)(dt.Z,{children:[(0,z.jsx)(ut.Z,{sx:{pl:1},children:"Sensor Location"}),(0,z.jsx)(ut.Z,{sx:{width:r?"9.5rem":"11rem"},children:"Dataset Type"})]})}),(0,z.jsx)(ht.Z,{children:o&&Object.keys(o).map((e=>(0,z.jsx)(yt,{schoolID:t,smallScreen:r,sensor:e,sensorsDatasets:o,previewingDataset:n,setPreviewingDataset:a,isPreviewing:e===(null===n||void 0===n?void 0:n.sensor),updateSensorsDatasets:i})))})]})},yt=e=>{const{schoolID:t,sensorsDatasets:o,sensor:n,previewingDataset:i,setPreviewingDataset:s,isPreviewing:l,updateSensorsDatasets:c}=e,[d,h]=(0,r.useState)(y.M$.hourly);(0,r.useEffect)((()=>{d!==y.M$.hourly&&h(y.M$.hourly)}),[t]);const m=e=>{if(!o[n].rawDatasets[e].sample){const r=(0,y.OM)({school_id:t,sensor_location_short:o[n].location_short,datasetType:e,isSample:!0});(0,a.m)({url:r,extension:"csv",needsAuthorization:!0}).then((t=>{const r={...o};r[n].rawDatasets[e].sample=t,c(r)}))}},x=(0,D.Z)();return(0,z.jsx)(z.Fragment,{children:(0,z.jsxs)(dt.Z,{children:[(0,z.jsx)(ut.Z,{sx:{pl:1,cursor:"pointer",background:l&&x.palette.background.NYUpurpleLight},onClick:()=>{(null===i||void 0===i?void 0:i.sensor)!==n&&(s({datasetType:d,sensor:n}),m(d))},children:o[n].location_long}),(0,z.jsx)(ut.Z,{sx:{position:"relative",background:l&&x.palette.background.NYUpurpleLight},children:(0,z.jsx)(Z.Z,{size:"small",children:(0,z.jsx)(C.Z,{value:d,onChange:e=>{const t=e.target.value;h(t),s({datasetType:t,sensor:n}),m(t)},variant:"standard",MenuProps:{disablePortal:!0},children:Object.keys(o[n].rawDatasets).reverse().map(((e,t)=>(0,z.jsx)(u.Z,{value:e,children:(0,z.jsx)(p.Z,{direction:"row",alignItems:"center",children:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()})},t)))})})})]},n)})},bt=e=>{const{sensorsDatasets:t,updateSensorsDatasets:o,previewingDataset:n,schoolID:i,smallScreen:s}=e,l=(0,D.Z)(),[d,u]=(0,r.useState)("Not previewing any dataset"),[h,m]=(0,r.useState)("No dataset"),[x,f]=(0,r.useState)(!1),v=e=>{const t=new Blob([e],{type:"application/octet-stream"}),o=URL.createObjectURL(t),r=document.createElement("a");r.href=o,r.download=h,document.body.appendChild(r),r.click(),URL.revokeObjectURL(o),document.body.removeChild(r)},[b,j]=(0,r.useState)(""),[S,w]=(0,r.useState)("");return(0,r.useEffect)((()=>{var e,o;if(!n)return;u("Previewing: ".concat(n.sensor," (").concat(n.datasetType,")"));const r=null===(e=t[n.sensor])||void 0===e||null===(o=e.rawDatasets[n.datasetType])||void 0===o?void 0:o.sample;if(!r)return w(null),j(null),m("Loading..."),void f(!0);x&&f(!1);const a=r.split("\n"),s=a[0].split(","),l=a.slice(1);let c;if(w(["",...l.map((e=>e.split(",")[0]))].join("\n")),j([s.slice(1).join(","),...l.map((e=>e.split(",").slice(1).join(",")))].join("\n")),l.length>0){const e=l[l.length-1].split(",");if(e.length>=2){c=e[1].split("T")[0]}}const d="".concat(i,"-").concat(n.sensor,"-").concat(n.datasetType,"-").concat(c,".csv");m(d)}),[n,t]),(0,z.jsxs)(p.Z,{spacing:1,children:[(0,z.jsxs)(c.Z,{sx:{"& *":{fontFamily:"monospace !important"}},children:[(0,z.jsx)(p.Z,{direction:"row",children:(0,z.jsx)(g.Z,{variant:"body2",gutterBottom:!0,fontWeight:500,children:d})}),(0,z.jsx)(c.Z,{component:"pre",sx:{overflowX:"auto",color:l.palette.text.secondary,backgroundColor:l.palette.customBackground,p:2,pt:1.5,borderRadius:l.shape.borderRadius,borderTopLeftRadius:0,height:s?"11.8rem":"14rem",width:s?"100%":"unset",marginTop:0},children:(0,z.jsx)(p.Z,{direction:"row",sx:{fontSize:s?"0.625rem !important":"0.8rem !important"},children:b?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(c.Z,{sx:{mr:2,userSelect:"none"},children:S}),(0,z.jsx)(c.Z,{children:b})]}):(0,z.jsx)(G.Z,{optionalText:"Loading"})})})]}),(0,z.jsx)(c.Z,{textAlign:"center",children:(0,z.jsxs)(de.Z,{variant:"contained",sx:{textTransform:"none",textAlign:"left",lineHeight:1.1,px:1.5,py:1},onClick:()=>{(()=>{if(!n)return;const e=t[n.sensor].rawDatasets[n.datasetType].full;if(e)v(e);else{const e=(0,y.OM)({school_id:i,sensor_location_short:n.sensor,datasetType:n.datasetType,isSample:!1});(0,a.m)({url:e,extension:"csv",needsAuthorization:!0}).then((e=>{const r={...t};r[n.sensor].rawDatasets[n.datasetType].full=e,o(r),v(e)}))}})(),Xe.y(Xe.z.rawDatasetDownloaded,{dataset_type:null===n||void 0===n?void 0:n.datasetType,sensor:null===n||void 0===n?void 0:n.sensor})},disabled:x,children:[(0,z.jsx)(pt.Z,{sx:{fontSize:"1.25rem",mr:.5}}),h]})})]})};var jt=o(11087),St=o(22981),wt=o(81131),Dt=o(51440);const Zt=()=>{const[e,t]=(0,r.useState)(null),{currentSchoolID:o,schoolMetadata:n}=(0,r.useContext)(b.G);if(!n)return;const a=n.screens;if(!(0,$.qt)(a))return null;if(a.length<=1)return(0,z.jsxs)(de.Z,{variant:"contained",component:jt.rU,to:"/screen/".concat(o),children:[(0,z.jsx)(St.Z,{sx:{fontSize:"1rem"}}),"\xa0TV Screen"]});const i=Boolean(e);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(de.Z,{id:"basic-button","aria-controls":i?"tv-screen-list-menu":void 0,"aria-haspopup":"true","aria-expanded":i?"true":void 0,onClick:e=>{t(e.currentTarget)},variant:"contained",children:[(0,z.jsx)(St.Z,{sx:{fontSize:"1rem"}}),"\xa0 TV Screens List"]}),(0,z.jsx)(x.Z,{id:"tv-screen-list-menu",anchorEl:e,open:i,onClose:()=>{t(null)},MenuListProps:{"aria-labelledby":"basic-button"},children:a.map(((e,t)=>(0,z.jsx)(wt.ZP,{behavior:Dt.Z.toNewPage,to:"/screen/".concat(o,"/").concat(e.screen_name),label:e.location_long,sx:{fontSize:"0.8rem"}},t)))})]})};var Ct=o(16344),kt=o(1414),Tt=o(25028),At=o(58562),It=o(16071),Pt=o(18610),zt=o(31781),Et=o(70366);const Mt=()=>{const{currentSchoolID:e,schoolMetadata:t}=(0,r.useContext)(b.G),{user:o}=(0,r.useContext)(zt.S);if(!Array.isArray(o.allowedSchools)||o.allowedSchools.length<=1)return(0,z.jsx)(Ft,{icon:(0,z.jsx)(At.Z,{}),label:(null===t||void 0===t?void 0:t.name)||"N/A",tooltipTitle:"School"});const[a,i]=(0,r.useState)(""),[s,l]=(0,r.useState)(null),d=()=>{l(null)},h=(0,n.s0)(),p=t=>()=>{e!==t&&(localStorage.setItem(It.m.schoolID,t),i(t),Xe.y(Xe.z.internalNavigation,{origin_school:e,destination_school_id:t,origin_id:"school_selector"}),h("".concat(Pt.f.dashboard,"/").concat(t))),d()};return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Ft,{icon:(0,z.jsx)(At.Z,{}),label:(0,z.jsxs)(c.Z,{sx:{"& svg":{fontSize:"1rem",verticalAlign:"sub",marginLeft:"0.25rem"}},children:[(null===t||void 0===t?void 0:t.name)||"N/A",Boolean(s)?(0,z.jsx)(Et.Z,{}):(0,z.jsx)(ze.Z,{})]}),tooltipTitle:"Click to Select School",clickable:!0,onClick:e=>{l(e.currentTarget)},"aria-controls":open?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":open?"true":void 0}),(0,z.jsx)(x.Z,{anchorEl:s,open:Boolean(s),onClose:d,MenuListProps:{"aria-labelledby":"basic-button"},children:(0,z.jsx)(Tt.Z,{dense:!0,children:o.allowedSchools.map(((e,t)=>(0,z.jsx)(u.Z,{onClick:p(e.school_id),children:e.name},t)))})})]})};var Rt=o(70445),Ot=o(26459),Wt=o(19132),_t=o(85172);const Lt=()=>{const{setLoadMoreCharts:e}=(0,r.useContext)(b.G);return(0,z.jsx)(p.Z,{sx:{mt:6,mx:"auto",maxWidth:"sm"},children:(0,z.jsxs)(de.Z,{variant:"contained",onClick:()=>{e(!0)},children:[(0,z.jsx)(_t.Z,{sx:{fontSize:"1rem"}}),"\xa0Load More Charts"]})})};var Bt=o(35429);const Ft=e=>{const{tooltipTitle:t,label:o,...r}=e;return(0,z.jsx)(Be.Z,{title:t,enterDelay:0,leaveDelay:200,children:(0,z.jsx)(I.Z,{size:"small",label:o||(0,z.jsx)(f.Z,{variant:"text",sx:{minWidth:"5rem"}}),...r})})},Nt=()=>{let e;const{setChartsTitlesList:t}=(0,r.useContext)(i.F),{commentCounts:o,fetchCommentCounts:n,setCommentCounts:a}=(0,r.useContext)(Rt.c),{schoolMetadata:l,current:d,allChartsData:u,loadMoreCharts:h}=(0,r.useContext)(b.G),{themePreference:m,temperatureUnitPreference:x}=(0,r.useContext)(Wt.p),[v,y]=(0,r.useState)(!1),[j,S]=(0,r.useState)(!1);(0,r.useEffect)((()=>{if(!l)return;const e="nyuad"===l.school_id;y(e),S(e),e&&!o&&n().then((e=>{a(e)}))}),[l]),(0,r.useEffect)((()=>{if(null===u||void 0===u||!u.charts)return;const e=null===u||void 0===u?void 0:u.charts.map(((e,t)=>({chartTitle:e.title,chartID:"chart-".concat(t+1)})));t(e)}),[u]);const Z=(0,D.Z)(),C=e=>!0===e&&!1===h?(0,z.jsx)(Lt,{}):null,k=()=>(0,z.jsxs)(w.ZP,{container:!0,spacing:1,sx:{mt:-3,pb:3},children:[(0,z.jsx)(w.ZP,{item:!0,children:(0,z.jsx)(Mt,{})}),(0,z.jsx)(w.ZP,{item:!0,children:(0,z.jsx)(Ft,{icon:(0,z.jsx)(et.Z,{}),label:null===l||void 0===l?void 0:l.contactPerson,tooltipTitle:"Contact Person"})}),(0,z.jsx)(w.ZP,{item:!0,children:(0,z.jsx)(Ft,{icon:(0,z.jsx)(tt.Z,{}),label:null===l||void 0===l?void 0:l.contactEmail,tooltipTitle:"Contact Email",component:"a",href:"mailto:".concat(null===l||void 0===l?void 0:l.contactEmail),clickable:!0})}),(0,z.jsx)(w.ZP,{item:!0,children:(0,z.jsx)(Ft,{icon:(0,z.jsx)(ot.Z,{}),label:"".concat(Object.keys(u).length||"..."," Chart").concat(1!==Object.keys(u).length?"s":""),tooltipTitle:"Number of Charts",onClick:()=>{var e;(0,wt.Qj)(Ke.O3.id),Xe.y(Xe.z.internalNavigation,{destination_id:Ke.O3.id,destination_label:null===(e=Ke.chartData)||void 0===e?void 0:e.toString(),origin_id:"chip"})}})}),e,!0===v&&null!==o&&(0,z.jsx)(w.ZP,{item:!0,children:(0,z.jsx)(Ft,{icon:(0,z.jsx)(rt.Z,{}),label:"".concat(o[Le.Hf]," Comment").concat(o[Le.Hf]>1?"s":""),tooltipTitle:"Number of Comments",onClick:()=>{(0,wt.Qj)(Ke.Sf.id),Xe.y(Xe.z.internalNavigation,{destination_id:Ke.Sf.id,destination_label:Ke.Sf.toString(),origin_id:"chip"})}})})]});return(0,z.jsxs)(c.Z,{width:"100%",children:[(0,z.jsx)(Je,{}),(0,z.jsx)(Ct.Z,{backgroundColor:"customAlternateBackground",children:(0,z.jsxs)(Fe.Z,{sx:{pt:5,pb:2},children:[(0,z.jsx)(_e.Z,{text:(()=>{if(null!==l&&void 0!==l&&l.school_id)return"Air Quality | ".concat(null===l||void 0===l?void 0:l.school_id)})()}),(0,z.jsx)(k,{}),!0===j&&(0,z.jsx)(Ot.Z,{initialNyuadCurrentData:d,isOnBannerPage:!1,themePreference:m,minMapHeight:"250px"}),!1===j&&(0,z.jsx)(c.Z,{textAlign:"center",sx:{mb:2},children:(0,z.jsx)(kt.ZP,{currentSensorsData:d,isScreen:!1,temperatureUnitPreference:x})}),l?(0,z.jsx)(g.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{textAlign:"justify",pb:2,mb:0,"& table *":{color:"".concat(Z.palette.text.secondary)}},gutterBottom:!0,children:(0,s.ZP)(l.description||"",{replace:$.T1})}):Array.from({length:3}).map(((e,t)=>(0,z.jsx)(f.Z,{variant:"text"},t))),(0,z.jsxs)(p.Z,{direction:"row",spacing:2,children:[(0,z.jsx)(Zt,{}),(0,z.jsx)(gt,{})]}),(0,z.jsx)(Bt.Z,{})]})}),(0,z.jsx)(c.Z,{id:Ke.O3.id,children:Object.keys(u).length>0?(0,z.jsx)(z.Fragment,{children:Object.keys(u).map(((e,t)=>(0,z.jsx)(Ct.Z,{backgroundColor:t%2!==0?"customAlternateBackground":"",children:(0,z.jsxs)(Fe.Z,{sx:{pt:4,pb:4},height:"auto",className:m===He.Z.dark?"dark":"",id:"chart-".concat(t+1),children:[(0,z.jsx)(We,{chartTitle:u[e].title,generalChartSubtitle:u[e].subtitle,generalChartReference:u[e].reference,chartData:{chartIndex:t,...u[e]},chartID:e,chartIndex:t}),C(t===Object.keys(u).length-1)]})},e)))}):(0,z.jsx)(G.Z,{optionalText:"Loading Visualizations"})}),(0,z.jsx)(Ne.Z,{}),!0===v&&(0,z.jsx)(Ct.Z,{id:Ke.Sf.id,sx:{pt:3,pb:4},children:(0,z.jsx)(Le.ZP,{pageID:Le.Hf})})]})},Ht=()=>{const{school_id_param:e}=(0,n.UO)(),t=(0,n.s0)(),o=(0,n.TH)().pathname;(0,r.useEffect)((()=>{e&&(document.title="CITIESair | ".concat(e.toUpperCase()))}),[e]);const{setCurrentPage:s}=(0,r.useContext)(i.F);(0,r.useEffect)((()=>{s(Pt.f.dashboard)}),[]);const{currentSchoolID:l,setCurrentSchoolID:c,schoolMetadata:d,setSchoolMetadata:u,current:h,setCurrent:p,allChartsData:m,setIndividualChartData:x,loadMoreCharts:g}=(0,r.useContext)(b.G),{user:f}=(0,r.useContext)(zt.S);(0,r.useEffect)((()=>{if("nyuad"===e)return v("nyuad"),void c("nyuad");!0===f.checkedAuthentication&&!1===f.authenticated&&t("".concat(Pt.f.login,"?").concat(Pt.f.redirectQuery,"=").concat(o));const r=f.allowedSchools;if(Array.isArray(r)&&r.length>0){if(!e){let e;const o=localStorage.getItem(It.m.schoolID);r.map((e=>e.school_id)).includes(o)?e=o:(e=r[0].school_id,c(e),localStorage.setItem(It.m.schoolID,e)),t(e,{replace:!0}),(d||h||m)&&v(e)}if(r.map((e=>e.school_id)).includes(e))return c(e),v(e),void localStorage.setItem(It.m.schoolID,e)}}),[f,e]);const v=async e=>{try{u(),p();const t=await Promise.all([(0,a.m)({url:(0,y.kG)({endpoint:y.a3.schoolmetadata,school_id:e}),extension:"json",needsAuthorization:!0}),(0,y.mQ)((0,y.kG)({endpoint:y.a3.current,school_id:e}))]);u(t[0]),p(t[1])}catch(t){console.log(t)}(g?y.UA:y.UA.slice(0,2)).forEach(((t,o)=>{x(o,{}),(0,a.m)({url:(0,y.kq)({endpoint:t,school_id:e}),extension:"json",needsAuthorization:!0}).then((e=>{x(o,e)})).catch((e=>{console.log(e)}))}))};return(0,r.useEffect)((()=>{if(!0===g){y.UA.slice(2).forEach(((e,t)=>{const o=2+t;x(o,{}),(0,a.m)({url:(0,y.Eh)({endpoint:e,school_id:l}),extension:"json",needsAuthorization:!0}).then((e=>{x(o,e)})).catch((e=>{console.log(e)}))}))}}),[g]),(0,z.jsx)(z.Fragment,{children:(0,z.jsx)(Nt,{})})}}}]);
//# sourceMappingURL=127.21e9a17e.chunk.js.map