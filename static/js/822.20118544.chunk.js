"use strict";(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[822],{35429:(e,t,n)=>{n.d(t,{Z:()=>x});var a=n(72791),r=n(20890),o=n(53540),i=n(69755),s=n(80223),l=n(7009),c=n(19132),d=n(80184);const u="Explanation of the US Air Quality Index (AQI) for PM2.5",h="CITIESair uses the <a href='https://www.airnow.gov/aqi/aqi-basics/'>Air Quality Index (AQI)</a> developed by the United States Environmental Protection Agency (EPA) to effectively communicate different levels of PM2.5 air pollution. To calculate the AQI from the raw measurement of PM2.5 concentration (\xb5g/m\xb3), different breakpoints and piecewise linear function are utilized (read more <a href='https://en.wikipedia.org/wiki/Air_quality_index#United_States'>here</a>). Higher AQI values correspond to poorer air quality and greater heath risks to humans.<br><br>The US EPA sets thresholds for PM2.5 concentration, recently updated in February 2024: <sup>[1]</sup><ul><li><b>Annual average</b>: 9.0 \xb5g/m\xb3, corresponding to US AQI <b>50</b></li><li><b>24-hour average</b>: 35.0 \xb5g/m\xb3, corresponding to US AQI <b>100</b></li></ul>In 2021, the World's Heath Organization (WHO) proposed a new guideline for PM2.5<sup>[2]</sup> with stricter thresholds than those of the US EPA:<ul><li><b>Annual average</b>: 5.0 \xb5g/m\xb3, corresponding to US AQI <b>21</b></li><li><b>24-hour average</b>: 15.0 \xb5g/m\xb3, corresponding to US AQI <b>56</b></li></ul>",p='[1] "National Ambient Air Quality Standards (NAAQS) for PM." EPA, Environmental Protection Agency, https://www.epa.gov/pm-pollution/national-ambient-air-quality-standards-naaqs-pm.<br>[2] World Health Organization. "WHO global air quality guidelines: particulate matter (PM2. 5 and PM10), ozone, nitrogen dioxide, sulfur dioxide and carbon monoxide: executive summary." (2021).',x=()=>{const{themePreference:e}=(0,a.useContext)(c.p);return(0,d.jsx)(l.Z,{title:u,content:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.Z,{themePreference:e}),(0,d.jsx)(r.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{mt:2},children:(0,o.ZP)(h,{replace:i.T1})}),(0,d.jsx)(l.Z,{title:"Reference",content:(0,d.jsx)(r.Z,{variant:"caption",color:"text.secondary",children:(0,o.ZP)(p,{replace:i.T1})})})]})})}},80223:(e,t,n)=>{n.d(t,{Z:()=>f});var a=n(66934),r=n(79836),o=n(697),i=n(56890),s=n(35855),l=n(53994),c=n(53382),d=n(53540),u=n(69755),h=n(44709),p=n(72791),x=n(19132),m=n(80184);const g=(0,a.ZP)(r.Z)((e=>{let{theme:t,isTiny:n}=e;return{minWidth:n||700,"& th, td":{fontSize:n?"0.625rem":"0.6875rem",color:t.palette.text.secondary,[t.breakpoints.down("sm")]:{fontSize:n?"0.5rem":"0.6875rem"}},"& th":{fontWeight:500,color:t.palette.text.primary,lineHeight:"1rem"}}}));const f=function(e){const{themePreference:t}=(0,p.useContext)(x.p),{isTiny:n,hideAQIDescription:a}=e,r=(e,t)=>t===1/0?"".concat(e,"+"):"".concat(e," - ").concat(t);return(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(o.Z,{overflow:"auto",children:(0,m.jsxs)(g,{size:"small",isTiny:n,children:[(0,m.jsx)(i.Z,{children:(0,m.jsxs)(s.Z,{children:[(0,m.jsx)(l.Z,{sx:{pr:0},children:(0,m.jsx)(o.Z,{sx:{width:"1em",height:"1em"}})}),(0,m.jsx)(l.Z,{sx:{pl:1},children:"Category"}),(0,m.jsx)(l.Z,{align:"right",children:"US AQI"}),(0,m.jsxs)(l.Z,{align:"right",children:["PM2.5 (\xb5g/m",(0,m.jsx)("sup",{children:"3"}),")"]}),!a&&(0,m.jsx)(l.Z,{align:"left",children:"Description"}),!a&&(0,m.jsx)(l.Z,{align:"left",children:"CITIESair' Suggested Actions"})]})}),(0,m.jsx)(c.Z,{children:h.Z.map(((e,n)=>(0,m.jsxs)(s.Z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[(0,m.jsx)(l.Z,{sx:{pr:0},children:(0,m.jsx)(o.Z,{sx:{width:"1em",height:"1em",backgroundColor:e.color[t]}})}),(0,m.jsx)(l.Z,{sx:{pl:1},children:e.category}),(0,m.jsx)(l.Z,{align:"right",sx:{whiteSpace:"nowrap"},children:r(e.aqiUS.low,e.aqiUS.high)}),(0,m.jsx)(l.Z,{align:"right",sx:{whiteSpace:"nowrap"},children:r(e.rawPM2_5.low,e.rawPM2_5.high)}),!a&&(0,m.jsx)(l.Z,{align:"left",children:e.description}),!a&&(0,m.jsx)(l.Z,{align:"left",children:(0,d.ZP)(e.healthSuggestions.outdoors,{replace:u.T1})})]},n)))})]})})})}},7009:(e,t,n)=>{n.d(t,{Z:()=>y});var a=n(72791),r=n(66934),o=n(40911),i=n(55818),s=n(3721),l=n(697),c=n(20068),d=n(20890),u=n(26759),h=n(25878),p=n(47438),x=n(80184);const m=(0,r.ZP)(o.Z)((e=>{let{theme:t,expanded:n}=e;return{color:t.palette.text.secondary,backgroundImage:"none",backgroundColor:n?t.palette.background.default:"transparent",boxShadow:n?t.shadows:"none",transition:"none"}})),g=(0,r.ZP)(i.Z)((e=>{let{theme:t,expanded:n}=e;return{marginTop:n?t.spacing(2):0,flexDirection:"row-reverse",paddingLeft:n?t.spacing(1):0,"& .MuiTypography-root":{color:t.palette.text.primary,textDecoration:"underline",transition:"none","&:hover":{color:t.palette.primary.main}},"& .MuiAccordionSummary-content.Mui-expanded":{marginTop:t.spacing(2),marginBottom:t.spacing(2)}}})),f="Click to expand section",v="Click to collapse section",y=e=>{let{title:t,content:n}=e;const[r,o]=(0,a.useState)(void 0);return(0,x.jsx)(l.Z,{children:(0,x.jsxs)(m,{expanded:"panel1"===r,onChange:(i="panel1",(e,n)=>{o(n?i:void 0),p.y(n?p.z.expandSection:p.z.collapseSection,{section:t})}),transitionDuration:0,children:[(0,x.jsx)(g,{expanded:r,expandIcon:(0,x.jsx)(u.Z,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,x.jsx)(c.Z,{title:r?v:f,enterDelay:0,leaveDelay:200,children:(0,x.jsxs)(d.Z,{component:"a",variant:"body1",children:[t,(0,x.jsx)(h.Z,{sx:{fontSize:"1rem",marginLeft:"0.25rem"}})]})})}),(0,x.jsx)(s.Z,{children:n})]})});var i}},80242:(e,t,n)=>{n.r(t),n.d(t,{default:()=>sn});var a=n(72791),r=n(57689),o=n(78914),i=n(75973),s=n(53540),l=n(66934),c=n(697),d=n(25228),u=n(5022),h=n(95193),p=n(36314),x=n(43896),m=n(65117),g=n(20890),f=n(47047),v=n(26935),y=n(67761),b=n(48206),j=n(83165),w=n(80184);const S=(0,a.createContext)();function D(e){let{children:t}=e;const[n,r]=(0,a.useState)([]),o=(0,a.useMemo)((()=>({yearRange:n,setYearRange:r})),[n]);return(0,w.jsx)(S.Provider,{value:o,children:t})}const Z=()=>(0,a.useContext)(S);var C=n(26084),T=n(19658),A=n(49768),k=n(61889),I=n(13967),P=n(68096),z=n(99321),R=n(94454),M=n(19055),E=n(9955),O=n(81918),W=n(3746);const _="Display All Series",L=48,B=8;function F(e){const{items:t,selectorID:n,allowMultiple:r,seriesLabel:o,onSeriesSelection:i,displayChip:s=!0}=e,l=(0,I.Z)(),c={PaperProps:{style:{maxHeight:5.55*L+B,overflow:"visible !important",background:l.palette.customAlternateBackground}},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},getContentAnchorEl:null},[d,h]=(0,a.useState)(t),[x,m]=(0,a.useState)(r);(0,a.useEffect)((()=>{h(t)}),[t]),(0,a.useEffect)((()=>{m(d.every((e=>e.selected)))}),[d]);const f=e=>{const{target:{value:t}}=e;if(t.includes(_)){const e=d.map(((e,t)=>({...e,selected:0==t||!x})));i({newDataColumns:e}),m(!x)}else{const e=d.filter((e=>t.includes(e.label))),n=d.map((t=>({...t,selected:e.some((e=>e.label===t.label))})));i({newDataColumns:n}),m(!1)}},v=e=>{const t=d.map((t=>t.label===e.label?{...t,selected:!t.selected}:t));i({newDataColumns:t})};return(0,w.jsxs)(p.Z,{spacing:1,direction:"row",alignItems:"center",children:[(0,w.jsx)(P.Z,{sx:{[l.breakpoints.down("sm")]:{width:"100%"},minWidth:"200px","& .MuiInputBase-root":{borderRadius:"".concat(l.shape.borderRadius,"px")}},size:"small",children:(0,w.jsxs)(z.Z,{labelId:"".concat(n,"-label"),id:n,multiple:r,value:d.filter((e=>e.selected)).map((e=>e.label)),onChange:f,MenuProps:c,renderValue:e=>(e=>(0,w.jsxs)(p.Z,{direction:"row",alignItems:"center",spacing:.5,children:[(0,w.jsx)(W.Z,{fontSize:"1.5rem",sx:{color:l.palette.text.secondary}}),(0,w.jsx)(g.Z,{variant:"caption",color:"text.secondary",children:r?"".concat(e.length,"/").concat(d.length," ").concat(o||""," displayed"):e})]}))(e),sx:{fontSize:"0.75em"},children:[d.map((e=>(0,w.jsxs)(u.Z,{disabled:!(1!==d.filter((e=>e.selected)).length||!e.selected),value:e.label,sx:{backgroundColor:"unset !important","&:hover":{backgroundColor:"inherit !important"}},children:[r?(0,w.jsx)(R.Z,{checked:e.selected,onClick:()=>v(e),sx:{p:.25,transform:"scale(0.8)"}}):(0,w.jsx)(M.Z,{checked:e.selected,onChange:()=>f(e),sx:{p:.25,transform:"scale(0.8)"}}),(0,w.jsx)(g.Z,{variant:"caption",children:e.label})]},e.label))),r&&(0,w.jsx)(u.Z,{value:_,sx:{borderTop:"solid 0.5px",borderColor:l.palette.text.secondary,position:"sticky",bottom:0,zIndex:99999,marginBottom:l.spacing(-1),background:l.palette.customAlternateBackground,"&:hover":{background:l.palette.customAlternateBackground}},children:(0,w.jsxs)(p.Z,{direction:"row",width:"100%",alignItems:"center",justifyContent:"space-between",children:[(0,w.jsx)(g.Z,{fontWeight:500,variant:"caption",sx:{pl:1},children:_}),(0,w.jsx)(E.Z,{checked:x,onClick:()=>v(_),sx:{transform:"scale(0.8)"}})]})},_)]})}),s&&r&&(0,w.jsx)(k.ZP,{container:!0,spacing:1,sx:{[l.breakpoints.down("sm")]:{display:"none"}},children:d.filter((e=>e.selected)).map((e=>(0,w.jsx)(k.ZP,{item:!0,children:(0,w.jsx)(O.Z,{label:(0,w.jsx)(g.Z,{variant:"caption",children:e.label}),size:"small",...1!==d.filter((e=>e.selected)).length&&{onDelete:()=>v(e)}})},e.label)))})]})}const U={CategoryFilter:{position:"top",stackDirection:"column"},DateRangeFilter:{position:"bottom",stackDirection:"column-reverse"},ChartRangeFilter:{position:"bottom",stackDirection:"column-reverse"},NumberRangeFilter:{position:"top",stackDirection:"column"}},N=e=>({min:e.reduce(((e,t)=>t<e?t:e)),max:e.reduce(((e,t)=>t>e?t:e))}),V=e=>({min:Math.min(...e),max:Math.max(...e)}),H=()=>Math.random().toString(36).substr(2,9),Q={stem:{length:0},textStyle:{opacity:0},boxStyle:null},Y=e=>{let{isPortrait:t,isSmaller:n}=e;return n?t?6:8:t?8:10},q=e=>{var t,n,a,r,o,i,s,l,c,d,u,h,p,x,m,g,f,v,y,b,j,w,S,D,Z,C,T,A,k,I,P,z,R,M,E,O,W,_,L,B,F,U,N,V,H,q,G,X,$;const{chartData:K,subchartIndex:J,isPortrait:ee,isHomepage:te,theme:ne}=e,ae={italic:!1,bold:!0,color:ne.palette.chart.axisTitle,fontSize:Y({isPortrait:ee})},re={color:ne.palette.chart.axisText,fontSize:Y({isPortrait:ee})};let oe=null!==(t=K.subcharts)&&void 0!==t&&t[J].options?{...K.subcharts[J].options}:{};if(oe={...oe,...K.options,theme:"material",curveType:oe.curveType||(null===(n=K.options)||void 0===n?void 0:n.curveType)||"function",crosshair:{orientation:"both",trigger:"focus",opacity:.5},backgroundColor:{fill:(null===(a=K.options)||void 0===a||null===(r=a.backgroundColor)||void 0===r?void 0:r.fill)||"transparent"},chartArea:{...null===(o=K.options)||void 0===o?void 0:o.chartArea,width:ee?(null===(i=K.options)||void 0===i||null===(s=i.chartArea)||void 0===s||null===(l=s.width)||void 0===l?void 0:l.portrait)||"80%":(null===(c=K.options)||void 0===c||null===(d=c.chartArea)||void 0===d||null===(u=d.width)||void 0===u?void 0:u.landscape)||"75%",height:ee?(null===(h=K.options)||void 0===h||null===(p=h.chartArea)||void 0===p||null===(x=p.height)||void 0===x?void 0:x.portrait)||"60%":(null===(m=K.options)||void 0===m||null===(g=m.chartArea)||void 0===g||null===(f=g.height)||void 0===f?void 0:f.landscape)||"70%"},width:ee?(null===(v=K.options)||void 0===v||null===(y=v.width)||void 0===y?void 0:y.portrait)||"100%":(null===(b=K.options)||void 0===b||null===(j=b.width)||void 0===j?void 0:j.landscape)||"100%",height:K.height||"100%",tooltip:{isHtml:!0,showColorCode:!1},legend:{alignment:ee?"center":"start",position:null!==(w=null===(S=K.options)||void 0===S||null===(D=S.legend)||void 0===D?void 0:D.position)&&void 0!==w?w:ee?"top":"right",scrollArrows:{activeColor:ne.palette.chart.axisTitle,inactiveColor:ne.palette.text.secondary},pagingTextStyle:{fontSize:10,color:ne.palette.chart.axisTitle,bold:!0}}},oe.vAxis={...oe.vAxis,format:null!==(Z=null===(C=oe.vAxis)||void 0===C?void 0:C.format)&&void 0!==Z?Z:"decimal",title:null!==(T=null===(A=oe.vAxis)||void 0===A?void 0:A.title)&&void 0!==T?T:"",viewWindow:{min:null!==(k=null===(I=oe.vAxis)||void 0===I||null===(P=I.viewWindow)||void 0===P?void 0:P.min)&&void 0!==k?k:0,max:null!==(z=null===(R=oe.vAxis)||void 0===R||null===(M=R.viewWindow)||void 0===M?void 0:M.max)&&void 0!==z?z:null,max:null!==(E=null===(O=oe.vAxis)||void 0===O||null===(W=O.viewWindow)||void 0===W?void 0:W.max)&&void 0!==E?E:null}},oe.hAxis={...oe.hAxis,title:null!==(_=null===(L=oe.hAxis)||void 0===L?void 0:L.title)&&void 0!==_?_:""},ee&&(oe.hAxis={...oe.hAxis,slantedText:!0,slantedTextAngle:30}),"string"!==typeof oe.colors&&oe.colors||(oe.colors=ne.palette.chart.optionsColors[oe.colors||"multiColor"]),oe.series&&Object.values(oe.series).forEach((e=>{const t=e;"default"===t.color&&(t.color=ne.palette.primary.main)})),oe.trendlines&&oe.trendlines.forEach((e=>{e.color=ne.palette.primary.main})),oe.colorAxis)switch(oe.colorAxis.colors){case"matchingColor":oe.colorAxis.colors=[ne.palette.chart.colorAxisFirstColor,ne.palette.chart.optionsColors.multiColor[oe.colorAxis.colorIndex]];break;case"default":oe.colorAxis.colors=[ne.palette.chart.colorAxisFirstColor,ne.palette.NYUpurple];break;default:try{oe.colorAxis=ne.palette.chart.colorAxes[oe.colorAxis.colors]}catch{oe.colorAxis=[]}}return oe.vAxis={...oe.vAxis,titleTextStyle:ae,textStyle:re,gridlines:{...null===(B=oe.vAxis)||void 0===B?void 0:B.gridlines,color:(null===(F=oe.vAxis)||void 0===F||null===(U=F.gridlines)||void 0===U?void 0:U.color)||ne.palette.chart.gridlines},minorGridlines:{count:0}},oe.hAxis={...oe.hAxis,titleTextStyle:ae,textStyle:re,gridlines:{...null===(N=oe.hAxis)||void 0===N?void 0:N.gridlines,color:(null===(V=oe.hAxis)||void 0===V||null===(H=V.gridlines)||void 0===H?void 0:H.color)||ne.palette.chart.gridlines},minorGridlines:{...null===(q=oe.hAxis)||void 0===q?void 0:q.minorGridlines,color:(null===(G=oe.hAxis)||void 0===G||null===(X=G.gridlines)||void 0===X?void 0:X.color)||ne.palette.chart.gridlines}},oe.legend={...oe.legend,textStyle:re},oe.annotations={...oe.annotations,highContrast:!0,textStyle:{color:ne.palette.primary.contrastText,fontSize:Y({isPortrait:ee,isSmaller:!0}),opacity:.8},stem:{...null===($=oe.annotations)||void 0===$?void 0:$.stem,color:ne.palette.chart.axisTitle,thickness:2},boxStyle:{rx:ne.shape.borderRadius,ry:ne.shape.borderRadius,fill:ne.palette.chart.annotationBoxFill,fillOpacity:.5}},te&&(oe={...oe,chartArea:{...oe.chartArea,width:"80%",height:"80%"},seriesSelector:!1,pointSize:0,enableInteractivity:!1,annotations:Q,legend:"none",vAxis:{...oe.vAxis,textPosition:"none",titleTextStyle:{...oe.vAxis.titleTextStyle,bold:!1},gridlines:{color:"transparent",count:0},viewWindowMode:"maximized"},hAxis:{...oe.hAxis,textPosition:"none",gridlines:{color:"transparent",count:0},titleTextStyle:{...oe.hAxis.titleTextStyle,bold:!1}}}),oe},G=e=>{const t=$({cellSizeMin:14,cellSizeMax:18});return{...e,width:t.chartWidth,calendar:{cellSize:t.cellSize,yearLabel:{fontSize:t.yearLabelFontSize}},noDataPattern:{backgroundColor:"none",color:"none"}}},X=e=>{var t;const{chartControl:n,mainChartData:a,mainChartOptions:r,subchartIndex:o,theme:i,isPortrait:s}=e;let l={...null===(t=n.options)||void 0===t?void 0:t.ui,snapToData:!0};return"ChartRangeFilter"===n.controlType&&(l={...l,chartType:a.chartType,chartView:{columns:a.columns||a.subcharts&&a.subcharts[o].columns||null},chartOptions:{...r,hAxis:{...r.hAxis,textPosition:"out",textStyle:{color:i.palette.chart.axisText,fontSize:Y({isPortrait:s,isSmaller:!0})},title:null},vAxis:{...r.vAxis,title:null},annotations:Q,legend:null}}),l},$=e=>{let{cellSizeMin:t,cellSizeMax:n}=e;const a=Math.min(Math.max(.9*window.innerWidth/58,t),n);return{chartWidth:56*a,cellSize:a,yearLabelFontSize:2*a}},K=e=>{let{controlWrapper:t,chartID:n}=e;const a=e=>{var t=e.changedTouches[0],n="";switch(e.type){case"touchstart":n="mousedown";break;case"touchmove":n="mousemove";break;case"touchend":n="mouseup";break;default:return}var a=new MouseEvent(n,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,button:0,relatedTarget:null});t.target.dispatchEvent(a),e.preventDefault()};let r=!0;if(!t)return;const o=document.querySelector("#control-".concat(n));return o?(["touchstart","touchmove","touchend","touchcancel"].forEach((e=>{o.addEventListener(e,a,{capture:!0})})),()=>{r=!1,["touchstart","touchmove","touchend","touchcancel"].forEach((e=>{o.removeEventListener(e,a,{capture:!0})}))}):void 0},J=(0,l.ZP)(c.Z,{shouldForwardProp:e=>"gradientBackgroundId"!==e&&"isPortrait"!==e})((e=>{let{theme:t,isPortrait:n,gradientBackgroundId:a}=e;return{"& svg>g:nth-of-type(2)>rect:first-of-type":{fill:"url(#".concat(a,")"),fillOpacity:1,filter:"contrast(0.4) brightness(1.4)"},"& .google-visualization-tooltip, .nivo-tooltip":{width:"unset !important",maxWidth:"350px",height:"unset",padding:"1em",boxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",mozBoxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",webkitBoxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",border:"solid 1px",borderColor:t.palette.text.secondaryRGB,fontSize:"".concat(n?9:12,"px"),color:t.palette.chart.tooltip.text,background:t.palette.chart.tooltip.background,borderRadius:t.shape.borderRadius,"& ul":{margin:"0 !important","& li":{margin:"0 !important",padding:"0 !important","& span":{fontSize:"".concat(n?9:12,"px !important"),color:"".concat(t.palette.chart.tooltip.text," !important")}}}},"& .goog-menuitem-highlight, .goog-menuitem-hover":{backgroundColor:"".concat(t.palette.primary," !important")},"& .google-visualization-controls-categoryfilter":{fontSize:"0.85rem",marginTop:"0.75rem",marginBottom:"-0.75rem","& .goog-inline-block > .goog-menu-button":{marginTop:0},"& .goog-menu-button-hover .goog-menu-button-outer-box, .goog-menu-button-hover .goog-menu-button-inner-box":{borderColor:"inherit !important"},"& .google-visualization-controls-label":{color:t.palette.text.secondary,fontWeight:500,verticalAlign:"middle",marginBottom:"0.25rem"},"& .goog-menu-button-outer-box":{backgroundColor:t.palette.background.paper,border:"unset","& .goog-menu-button-inner-box":{paddingTop:t.spacing(.5),paddingBottom:t.spacing(.5),paddingLeft:t.spacing(2),paddingRight:t.spacing(2),border:"solid",borderWidth:"0.5px",borderRadius:t.shape.borderRadius,borderColor:t.palette.text.secondary,"& .goog-menu-button-caption":{color:t.palette.text.secondary}}}},"& .google-visualization-controls-rangefilter":{width:"100%",fontSize:"0.75rem","& .goog-inline-block":{width:"100%"},"& .google-visualization-controls-slider-horizontal":{width:"90%",margin:"0 5%"},"& .google-visualization-controls-rangefilter-thumblabel:nth-of-type(1)":{position:"absolute",top:"1.5em",left:"5%"},"& .google-visualization-controls-rangefilter-thumblabel:nth-of-type(2)":{position:"absolute",top:"1.5em",right:"5%"},"& .google-visualization-controls-slider-handle":{background:t.palette.primary.main},"& .google-visualization-controls-rangefilter-thumblabel":{color:t.palette.text.secondary,padding:0,fontWeight:500},"& .google-visualization-controls-slider-thumb":{background:t.palette.primary.main,border:"unset",borderRadius:t.shape.borderRadius}},'& path[stroke-opacity="0.3"], path[stroke-opacity="0.1"], path[stroke-opacity="0.05"], rect[stroke-opacity]':{stroke:t.palette.text.primary,strokeWidth:3},"& [column-id]:not(:empty)":{cursor:"pointer",":hover":{fontWeight:600}}}}));var ee=n(6694),te=n(18970),ne=n(69755);const ae=e=>{let{colors:t,optionalMinValue:n,optionalMaxValue:a}=e;if(!(0,ne.qt)(t))return[{color:"#fff",offset:0},{color:"#fff",offset:1}];if("string"===typeof t[0]){const e=t.length;return t.map(((t,n)=>({color:t,offset:n/(e-1)})))}{let e=t;n&&(e=t.filter((e=>e.offset>=n))),a&&(e=t.filter((e=>e.offset<=a)));const r=e.map((e=>e.offset)),o=(e=>{let{offsets:t,minOffset:n,maxOffset:a}=e;return t.map((e=>(e-n)/(a-n)))})({offsets:r,minOffset:n||Math.min(...r),maxOffset:a||Math.max(...r)});return e.map(((e,t)=>({color:e.color,offset:o[t]})))}},re=e=>{let{colors:t,numSteps:n=100}=e;function a(e,t,n){return"#"+[e,t,n].map((e=>{const t=e.toString(16);return 1===t.length?"0"+t:t})).join("")}function r(e,t,n){if(e.every(((e,n)=>e===t[n])))return e;let a=e.slice();for(let r=0;r<3;r++)a[r]=Math.round(a[r]+n*(t[r]-e[r]));return a}const o=ae({colors:t});o.forEach((e=>{e.color=function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,n,a){return t+t+n+n+a+a}));const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[null,null,null]}(e.color)}));let i=[];const s=Array.from({length:n},((e,t)=>t/(n-1)));for(let l=0;l<s.length;l++){const e=s[l];let t,n,c,d;for(let a=0;a<o.length-1;a++)if(e>=o[a].offset&&e<=o[a+1].offset){t=o[a].color,n=o[a+1].color,c=o[a].offset,d=o[a+1].offset;break}const u=r(t,n,(e-c)/(d-c));i.push(a(...u))}return i},oe=e=>{let{gradientDirection:t,colors:n,optionalMinValue:a,optionalMaxValue:r}=e;const o=ae({colors:n,optionalMaxValue:r});return"linear-gradient(".concat(t,", ").concat(o.map((e=>"".concat(e.color," ").concat(100*e.offset,"%"))).join(", "),")")},ie=e=>{let{colors:t,optionalMinValue:n,optionalMaxValue:a}=e;return ae({colors:t,optionalMinValue:n,optionalMaxValue:a}).map((e=>({color:e.color,offset:100*e.offset+"%"})))},se=e=>{let{id:t,colors:n}=e;return(0,w.jsx)("svg",{width:0,height:0,visibility:"hidden",children:(0,w.jsx)("defs",{children:(0,w.jsx)("linearGradient",{id:t,x1:"0",y1:"1",x2:"0",y2:"0",children:n.map(((e,t)=>(0,w.jsx)("stop",{offset:e.offset,stopColor:e.color},t)))})})})},le=e=>e?{top:20,right:0,bottom:0,left:20}:{top:30,right:40,bottom:0,left:40},ce=(e,t,n)=>{const a=e[1]-e[0]+1;return 1===a?t+40+n.top+n.bottom:a*(t+40)+n.top+n.bottom},de=e=>{var t,n,a,r,o;const{data:i,dateRange:s,valueRangeBoxTitle:l,valueRange:c,yearRange:d,isPortrait:u,options:h}=e,p=le(u),x=(0,I.Z)(),m="".concat(d[0],"-01-01"),g="".concat(d[1],"-12-31"),f=i.filter((e=>{const t=new Date(e.day).getFullYear();return t>=d[0]&&t<=d[1]}));let v=c;f.length>0&&(v=(e=>{const t=e.map((e=>e.value));return{min:Math.min(...t),max:Math.max(...t)}})(f,null===h||void 0===h||h.colorAxis));const y=(e,t)=>{const n=new Date(e),a=n.getDay(),r=0===a||1===a,o=new Date(t.min).getFullYear(),i=n.getFullYear()===o;return r&&i},b=re({colors:null===h||void 0===h||null===(t=h.colorAxis)||void 0===t?void 0:t.colors,numSteps:null===h||void 0===h||null===(n=h.colorAxis)||void 0===n?void 0:n.gradientSteps}),j=()=>(0,w.jsx)(he,{title:l,valueRange:c,filteredValueRange:v,colorAxis:null===h||void 0===h?void 0:h.colorAxis,isPortrait:u});return(0,w.jsxs)(w.Fragment,{children:["none"!==(null===h||void 0===h||null===(a=h.legend)||void 0===a?void 0:a.position)&&j(),j(),(0,w.jsx)(te.DQ,{data:i,from:m,to:g,emptyColor:"transparent",theme:{text:{fill:x.palette.text.secondary},fontSize:"0.75rem",tooltip:{container:{background:"dark"===x.palette.mode?"#2b2b2b":"#fff",color:x.palette.text.primary}},axis:{ticks:{line:{stroke:"dark"===x.palette.mode?"#2b2b2b":"#fff"},text:{fill:x.palette.text.primary}}},grid:{line:{stroke:"dark"===x.palette.mode?"#2b2b2b":"#fff"}}},colors:b,minValue:null===h||void 0===h||null===(r=h.colorAxis)||void 0===r?void 0:r.minValue,maxValue:null===h||void 0===h||null===(o=h.colorAxis)||void 0===o?void 0:o.maxValue,margin:p,yearSpacing:40,monthBorderColor:x.palette.text.primary,monthBorderWidth:1,daySpacing:.25,dayBorderWidth:0,tooltip:e=>{let{day:t,value:n,color:a}=e;const r=i.find((e=>e.day===t)),o=r?(l=r.tooltip,(new DOMParser).parseFromString(l,"text/html").body.innerHTML):"";var l;return(0,w.jsx)(ue,{day:t,color:a,tooltipText:o,dateRange:s,inFirstTwoRowsOfChart:y})}})]})},ue=e=>{let{day:t,color:n,tooltipText:r,dateRange:o,inFirstTwoRowsOfChart:i}=e;const l=(0,a.useRef)(null);return(0,a.useEffect)((()=>{if(l.current&&i(t,o)){const e=l.current.parentElement;e&&(e.style.top="11vh")}}),[l,i]),(0,w.jsxs)(c.Z,{ref:l,className:"nivo-tooltip",children:[(0,w.jsx)(O.Z,{sx:{backgroundColor:n,mr:.5,height:"10px",width:"10px",borderRadius:"50%"}}),(0,s.ZP)(r,{replace:ne.T1})]})},he=e=>{let{title:t,filteredValueRange:n,valueRange:a,colorAxis:r,isPortrait:o}=e;if(null===(null===a||void 0===a?void 0:a.min)||null===(null===a||void 0===a?void 0:a.max))return null;const{colors:i,minValue:s,maxValue:l}=r;let d=s,u=l;void 0===s&&(d=a.min),void 0===l&&(u=a.max),a.min<d&&(d=a.min),a.max>u&&(u=a.max);const h=(0,I.Z)(),p=e=>"".concat((e-d)/(u-d)*100,"%"),x={position:"absolute",fontSize:"0.75rem",color:h.palette.text.secondary,lineHeight:1,textAlign:"center",transform:"translateX(-50%)",minWidth:"75px",whiteSpace:"nowrap"},m={bottom:"-1.25rem",transform:o?"translateX(-100%)":"translateX(-50%)"},f={position:"absolute",width:0,height:0,borderLeft:"0.25rem solid transparent",borderRight:"0.25rem solid transparent",transform:"translateX(-50%)"},v={top:"-0.5rem",borderTop:"0.25rem solid ".concat(h.palette.text.secondary)},y={bottom:"-0.5rem",borderBottom:"0.25rem solid ".concat(h.palette.text.secondary)};return(0,w.jsxs)(c.Z,{sx:{position:"sticky",width:"fit-content",marginTop:"1.5rem",float:"right",right:o?"0":"50px"},children:[(0,w.jsx)(g.Z,{sx:{display:"inline",position:"absolute",textAlign:"right",transform:"translateX(calc(-100% - 0.5rem))",fontSize:"0.75rem",lineHeight:1.25,fontWeight:500,color:"text.secondary"},children:t}),(0,w.jsxs)(c.Z,{sx:{background:oe({gradientDirection:"to right",colors:i,optionalMaxValue:u}),color:h.palette.text.secondary,border:"1px solid ".concat(h.palette.text.secondary),width:o?"250px":"300px",height:"1rem",position:"relative",justifyContent:"space-between"},children:[(0,w.jsxs)("span",{style:{...x,top:"-1.5rem",transform:"translateX(-50%)",left:p(n.min)},children:["min: ",Math.round(n.min)]}),(0,w.jsxs)("span",{style:{...x,...m,left:p(n.max)},children:["max: ",Math.round(n.max)]}),(0,w.jsx)("div",{style:{...f,...v,left:p(n.min)}}),(0,w.jsx)("div",{style:{...f,...y,left:p(n.max)}})]})]})};var pe=n(7161),xe=(n(42978),n(666),n(13239)),me=n(94294),ge=n(35527),fe=n(42755),ve=n(3874),ye=n(4531),be=n(87210),je=n(62573);const we=e=>{let{today:t,minDateOfDataset:n,aggregationType:a}=e;const r=[{label:"Last 14d",range:()=>({startDate:(0,fe.b)((0,ve.E)(t,-14)),endDate:(0,ye.i)(t)})},{label:"Last 30d",range:()=>({startDate:(0,fe.b)((0,ve.E)(t,-30)),endDate:(0,ye.i)(t)})}],o=[{label:"Last 90d",range:()=>({startDate:(0,fe.b)((0,ve.E)(t,-90)),endDate:(0,ye.i)(t)})},{label:"Last 365d",range:()=>({startDate:(0,fe.b)((0,ve.E)(t,-365)),endDate:(0,ye.i)(t)})},{label:"All Time",range:()=>({startDate:n,endDate:(0,ye.i)(t)})}];return a===je.Z.hourly?r:[...r,...o]},Se=(0,l.ZP)(ge.Z)((e=>{let{theme:t,showPickerPanel:n,smallScreen:a}=e;return{zIndex:!0===n&&1e3,position:"relative",padding:n?t.spacing(1):0,margin:n&&!a?t.spacing(-1):0,maxWidth:"100%",background:n?t.palette.customAlternateBackground:"transparent",boxShadow:!1===n&&"none","& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary},"& .rdrDateDisplayWrapper, .rdrCalendarWrapper, .rdrDefinedRangesWrapper, .rdrStaticRange, .rdrDateDisplayItem":{background:"transparent"},"& .rdrDateInput":{borderRadius:t.shape.borderRadius,boxShadow:"none"},"& .rdrDateDisplayItemActive":{border:!1===n&&"none"},"& .rdrDateDisplay":{margin:0,minWidth:"20rem"},"& .rdrDateDisplayItem":{margin:0,borderRadius:n?t.shape.borderRadius:0,"&:hover:not(.rdrDateDisplayItemActive)":{border:n?"1px solid ".concat(t.palette.action.disabled):"none"}},"& .rdrDateDisplayItem:hover:not(.rdrDateDisplayItemActive)":{border:!1===n&&"1px solid transparent"},"& .rdrDateDisplayItem + .rdrDateDisplayItem":{margin:0},"& .rdrDateDisplayItem:first-of-type":{borderRight:!1===n&&"1px solid ".concat(t.palette.action.disabled," !important")},"& .rdrMonthAndYearWrapper, .rdrInputRanges":{display:!1===n&&"none !important",padding:0},"& .rdrMonthName":{display:"none"},"& .rdrDefinedRangesWrapper, .rdrMonths":{display:!1===n&&"none"},"&  .rdrInfiniteMonths":{visibility:!1===n&&"hidden",width:"100% !important",maxWidth:"675px",margin:"auto"},"& .rdrDateDisplayWrapper":{minWidth:"18rem",borderRadius:t.shape.borderRadius,border:n?"none":"1px solid ".concat(t.palette.action.disabled),"&:hover":{border:n?"none":"1px solid ".concat(t.palette.text.primary)}},"& .rdrDateRangePickerWrapper":{width:"100%",flexDirection:"column-reverse"},"& .rdrStaticRanges":{flexDirection:"row",minWidth:"21rem"},"& .rdrStaticRangeLabel":{color:t.palette.text.secondary,borderRadius:t.shape.borderRadius,padding:"".concat(t.spacing(.5)," ").concat(t.spacing(1))},"& .rdrDefinedRangesWrapper":{border:"none",width:"100%"},"& .rdrNextPrevButton":{background:t.palette.primary.main,borderRadius:t.shape.borderRadius,opacity:1,"&:hover":{opacity:.5,background:t.palette.primary.main}},"& .rdrNextPrevButton > i":{color:"white"},"& .rdrNextButton > i":{borderColor:"transparent transparent transparent white"},"& .rdrPprevButton > i":{borderColor:"transparent white transparent transparent"},"& .rdrStaticRange":{border:"none"},"& .rdrStaticRangeSelected > .rdrStaticRangeLabel, .rdrMonthAndYearPickers":{color:t.palette.primary.main},"& .rdrMonthAndYearPickers":{fontSize:"1rem"},"& .rdrStaticRange:hover .rdrStaticRangeLabel, .rdrStaticRange:focus .rdrStaticRangeLabel":{background:t.palette.customBackground.toString()},"& .rdrDayNumber span":{color:t.palette.text.primary.toString()},"& .rdrDayPassive .rdrDayNumber span":{opacity:.5},"& .rdrMonthAndYearWrapper select":{color:t.palette.text.secondary.toString(),background:"none",padding:"".concat(t.spacing(1)," ").concat(t.spacing(2)),"&:hover":{border:"1px solid ".concat(t.palette.text.secondary)}},"& .rdrDateDisplayItem input":{color:t.palette.text.secondary},"& .rdrDayDisabled":{backgroundColor:t.palette.customBackground},"& .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfMonth .rdrStartEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge, .rdrEndEdge, .rdrDayEndOfMonth .rdrDayInPreview, .rdrDayEndOfMonth .rdrDayStartPreview, .rdrDayEndOfWeek .rdrDayInPreview, .rdrDayEndOfWeek .rdrDayStartPreview, .rdrDayEndPreview":{borderTopRightRadius:"2rem",borderBottomRightRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfWeek .rdrEndEdge, .rdrDayStartOfMonth .rdrDayInPreview, .rdrDayStartOfMonth .rdrDayEndPreview, .rdrDayStartOfWeek .rdrDayInPreview, .rdrDayStartOfWeek .rdrDayEndPreview, .rdrDayStartPreview":{borderTopLeftRadius:"2rem",borderBottomLeftRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrEndEdge":{left:0},"& .rdrEndEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge":{right:0},"& .rdrSelected, .rdrInRange, .rdrStartEdge, .rdrEndEdge":{top:"0px",bottom:"0px"},"& .rdrMonths":{justifyContent:"center",alignItems:"center"},"& .rdrDay":{marginBottom:"1px","& span":{top:"0px",bottom:"0px"}},"& .rdrMonthsHorizontal":{overflowY:"hidden"},"& .rdrDateInput:first-of-type:before":{content:'""',backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' class='MuiSvgIcon-root' focusable='false' aria-hidden='true' viewBox='0 0 24 24' data-testid='DateRangeIcon'%3E%3Cpath d='M9 11H7v2h2zm4 0h-2v2h2zm4 0h-2v2h2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V9h14z' fill='".concat(t.palette.text.secondary,"'/%3E%3C/svg%3E\")"),width:"0.75rem",height:"0.75rem",display:"block",position:"absolute",top:"50%",transform:"translateY(-50%)",left:"0.75rem"},"& .rdrStaticRangeSelected span":{color:t.palette.primary.main},"& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary.main,width:"0.25rem",height:"0.25rem",borderRadius:"50%"}}})),De=e=>{let{startDateObject:t,endDateObject:n}=e;return{startDate:(0,be.WU)(t,"yyyy-MM-dd"),endDate:(0,be.WU)(n,"yyyy-MM-dd")}};var Ze=n(77997),Ce=n(40630);function Te(e){let{aggregationType:t,setAggregationType:n,smallScreen:a}=e;return(0,w.jsxs)(p.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,w.jsx)(g.Z,{variant:"caption",display:"block",color:"text.secondary",children:"DATA AVERAGE"}),(0,w.jsxs)(Ze.Z,{color:"primary",value:t,exclusive:!0,onChange:(e,t)=>{null!==t&&n(t)},"aria-label":"aggregation type toggle for graph average",size:"small",children:[(0,w.jsx)(Ce.Z,{size:"small",sx:{textTransform:"capitalize !important",px:1.25,py:.5},value:je.Z.hourly,"aria-label":je.Z.hourly,children:je.Z.hourly}),(0,w.jsx)(Ce.Z,{size:"small",sx:{textTransform:"capitalize !important",px:1.25,py:.5},value:je.Z.daily,"aria-label":je.Z.daily,children:je.Z.daily})]})]})}var Ae=n(2165),ke=n(33026);const Ie=(0,a.createContext)(),Pe={startDate:null,endDate:null,key:"selection"};function ze(e){let{children:t}=e;const[n,r]=(0,a.useState)([Pe]),[o,i]=(0,a.useState)(je.Z.hourly),s=(0,a.useMemo)((()=>({dateRange:n,setDateRange:r,aggregationType:o,setAggregationType:i})),[n,o]);return(0,w.jsx)(Ie.Provider,{value:s,children:t})}const Re=()=>(0,a.useContext)(Ie),Me="HOURLY data is limited to max 30d",Ee="Start and end dates must be different",Oe=e=>(0,w.jsx)(T.Z,{severity:"error",sx:{py:.5,px:1,display:"flex",alignItems:"center","& div":{fontSize:"0.75rem",p:0},"& .MuiAlert-icon":{fontSize:"1rem",mr:.5}},children:e}),We=e=>{const{minDateOfDataset:t,dataType:n}=e,{currentSchoolID:r,setIndividualChartData:i}=(0,a.useContext)(j.G),[s,l]=(0,a.useState)(),c=new Date,d=(0,I.Z)(),u=(0,h.Z)(d.breakpoints.down("sm")),{dateRange:x,setDateRange:m,aggregationType:g,setAggregationType:f}=Re();(0,a.useEffect)((()=>{m({...we({today:c,minDateOfDataset:t})[0].range(),key:"selection"}),f(je.Z.hourly)}),[]);const[v,y]=(0,a.useState)(),[S,D]=(0,a.useState)(!1),Z=(0,a.useRef)(null),[C,T]=(0,a.useState)(!1);(0,a.useEffect)((()=>{const e=e=>{Z.current&&!Z.current.contains(e.target)&&D(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[Z]);const A=e=>{const{startDate:t,endDate:n}=e||{};if(t&&n)if((0,Ae.K)(t,n))l(Ee);else if(l(null),g===je.Z.hourly){const e=(0,ke.j)(n,t);l(e>30?Me:null)}else null!==s&&l(null)};(0,a.useEffect)((()=>{A(x)}),[g]);return(0,w.jsx)(Se,{showPickerPanel:S,smallScreen:u,ref:Z,elevation:8,onClick:()=>D(!0),children:(0,w.jsxs)(p.Z,{direction:"column",spacing:1,children:[(0,w.jsx)(pe.Dw,{ranges:[x],onChange:e=>{e&&(A(e.selection),m(e.selection))},staticRanges:(0,pe.$z)(we({today:c,minDateOfDataset:t,aggregationType:g})),inputRanges:[],rangeColors:[d.palette.primary.main,d.palette.secondary.main,d.palette.text.secondary],minDate:t,maxDate:c,months:1,showMonthAndYearPickers:!1,direction:"horizontal",fixedHeight:!0,preventSnapRefocus:!0,calendarFocus:"backwards",startDatePlaceholder:"Start Date",endDatePlaceholder:"End Date",editableDateInputs:!0,showMonthArrow:!0}),S&&(0,w.jsxs)(p.Z,{direction:"column",alignItems:"end",width:"100%",spacing:1,children:[(0,w.jsx)(Te,{aggregationType:g,setAggregationType:f,smallScreen:u}),(0,w.jsxs)(p.Z,{direction:"row",spacing:1,children:[s&&Oe(s),(0,w.jsx)(me.Z,{variant:"contained",size:"small",disabled:null!==s,onClick:e=>{if(null!==s)return;e.stopPropagation();const t=De({startDateObject:x.startDate,endDateObject:x.endDate}),a=(0,b.kq)({endpoint:b.ZU.historical,school_id:r,aggregationType:g,dataType:n,startDate:t.startDate,endDate:t.endDate});a!==v&&(T(!0),(0,o.m)({url:a,extension:"json",needsAuthorization:!0}).then((e=>{i(0,e),y(a),T(!1),D(!1)})).catch((e=>{console.log(e)})))},sx:{zIndex:1005,transform:"translateY(-1px)"},children:C?(0,w.jsx)(xe.Z,{disableShrink:!0,size:"1.4375rem",color:"inherit"}):"APPLY"})]})]})]})})};var _e=n(94925);const Le=(0,a.createContext)();function Be(e){let{children:t}=e;const[n,r]=(0,a.useState)(),[o,i]=(0,a.useState)(),s=(0,a.useMemo)((()=>({hAxis:n,setHAxis:r,vAxis:o,setVAxis:i})),[n,o]);return(0,w.jsx)(Le.Provider,{value:s,children:t})}const Fe=()=>(0,a.useContext)(Le),Ue=(0,l.ZP)(P.Z)((e=>{let{theme:t}=e;return{borderTopRightRadius:0,borderBottomRightRadius:0,textTransform:"capitalize",minWidth:"150px",maxWidth:"250px","& .MuiOutlinedInput-root":{borderTopRightRadius:0,borderBottomRightRadius:0},"& .MuiOutlinedInput-notchedOutline":{borderRight:"none"},"& .Mui-focused .MuiOutlinedInput-notchedOutline":{borderRight:"2px solid ".concat(t.palette.primary.main)}}})),Ne=(0,l.ZP)(P.Z)((e=>{let{theme:t}=e;return{borderTopLeftRadius:0,borderBottomLeftRadius:0,textTransform:"capitalize",minWidth:"150px",maxWidth:"250px","& .MuiOutlinedInput-root":{borderTopLeftRadius:0,borderBottomLeftRadius:0}}})),Ve=e=>{const{currentSchoolID:t,setIndividualChartData:n}=(0,a.useContext)(j.G),{allowedAxes:r,selectedAxes:i,dataType:s}=e,{hAxis:l,vAxis:c,setHAxis:d,setVAxis:h}=Fe(),[x,m]=(0,a.useState)(),[g,f]=(0,a.useState)(!1),[v,y]=(0,a.useState)(!0);(0,a.useEffect)((()=>{const{hAxis:e,vAxis:t}=i;e&&t?l===e&&c===t||(h(t),d(e)):y(!0)}),[i]);(0,a.useEffect)((()=>{const{hAxis:e,vAxis:t}=i;e&&t&&y(l===e&&c===t)}),[l,c,i]);const S=e=>!e.allowedDataTypes.includes(s);return(0,w.jsxs)(k.ZP,{container:!0,spacing:1,alignItems:"center",children:[(0,w.jsx)(k.ZP,{item:!0,xs:12,sm:"auto",children:(0,w.jsxs)(p.Z,{direction:"row",spacing:0,children:[(0,w.jsxs)(Ue,{fullWidth:!0,size:"small",children:[(0,w.jsx)(_e.Z,{id:"x-axis-select-label",children:"X Axis"}),(0,w.jsx)(z.Z,{labelId:"x-axis-select-label",value:l||(null===i||void 0===i?void 0:i.hAxis)||null,label:"X Axis",onChange:e=>{const t=e.target.value;d(t),t===c&&h("")},autoWidth:!0,children:null===r||void 0===r?void 0:r.map((e=>(0,w.jsxs)(u.Z,{value:e.sensor,disabled:e.sensor===c||S(e),sx:{textTransform:"capitalize"},children:[e.sensor,S(e)&&" (No Data)"]},e.sensor)))})]}),(0,w.jsxs)(Ne,{fullWidth:!0,size:"small",children:[(0,w.jsx)(_e.Z,{id:"y-axis-select-label",children:"Y Axis"}),(0,w.jsx)(z.Z,{labelId:"y-axis-select-label",value:c||(null===i||void 0===i?void 0:i.vAxis)||null,label:"Y Axis",onChange:e=>{h(e.target.value),e.target.value===l&&d("")},autoWidth:!0,children:null===r||void 0===r?void 0:r.map((e=>(0,w.jsxs)(u.Z,{value:e.sensor,disabled:e.sensor===l||S(e),sx:{textTransform:"capitalize"},children:[e.sensor,S(e)&&" (No Data)"]},e.sensor)))})]})]})}),(0,w.jsx)(k.ZP,{item:!0,xs:12,sm:"auto",children:(0,w.jsx)(me.Z,{variant:"contained",color:"primary",fullWidth:!0,sx:{height:"100%"},onClick:()=>{if(!c||!l)return;const e=(0,b.Qo)({endpoint:b.ZU.correlationDailyAverage,school_id:t,dataType:s,sensorX:l,sensorY:c});e!==x&&(f(!0),(0,o.m)({url:e,extension:"json",needsAuthorization:!0}).then((t=>{n(5,t),m(e),f(!1)})).catch((e=>{console.log(e)})))},disabled:v,children:g?(0,w.jsx)(xe.Z,{disableShrink:!0,size:"1.4375rem",color:"inherit"}):"APPLY"})})]})},He=e=>{let{dataType:t,height:n,selectableAxes:a}=e,r="This sensor ",o=" data. Please choose a different sensor.";return a&&(r="This pair of sensors ",o=" correlation data. Please choose another pair or a different data type."),(0,w.jsx)(c.Z,{height:n,children:(0,w.jsxs)(T.Z,{severity:"error",sx:{my:2},children:[r,"does not have\xa0",(0,w.jsx)(c.Z,{component:"span",textTransform:"capitalize",children:t}),o]})})};function Qe(e){var t,n=this;const{chartData:r,subchartIndex:o,windowSize:i,isPortrait:s,isHomepage:l,height:d,maxHeight:u,selectedDataType:h,allowedDataTypes:x,currentSubchart:m}=e,g=(0,a.useContext)(C.R),[f,v]=(0,a.useState)(),[b,j]=(0,a.useState)(),[S,D]=(0,a.useState)(),[T,P]=(0,a.useState)(),[z,R]=(0,a.useState)(),M=(0,I.Z)(),[E,O]=(0,a.useState)(!0),[W,_]=(0,a.useState)(!0),[L,B]=(0,a.useState)(!1),[Q,Y]=(0,a.useState)(),[$,te]=(0,a.useState)(),[ae,re]=(0,a.useState)(),[oe,ue]=(0,a.useState)(H()),[he,pe]=(0,a.useState)(200);let xe=(0,a.useMemo)((()=>{let t=q({...e,theme:M});return"Calendar"===r.chartType&&(t=G(t)),t}),[e,M,r.chartType]);const[me,ge]=(0,a.useState)(null),{yearRange:fe,setYearRange:ve}=Z(),[ye,be]=(0,a.useState)(200),[je,we]=(0,a.useState)(1200),[Se,De]=(0,a.useState)(!1),Ze=(0,a.useRef)(null);if("Calendar"===r.chartType){(0,a.useEffect)((()=>{const e=r.dataArray||r.subcharts&&r.subcharts[o].dataArray||null;if(console.log(r.title,e),!(0,ne.qt)(e))return void _(!1);const t=e.map((e=>e.day)),n=e.map((e=>e.value)),a=N(t);ge({data:e,dateRange:a,valueRange:V(n)});const i=new Date(a.max).getFullYear();ve([s?i-3:i-2,i]),De(new Date(a.min).getFullYear()<=i-2),_(!0)}),[r]);const e=Array.from({length:fe[1]-fe[0]+1},((e,t)=>({value:fe[0]+t,label:fe[0]+t}))),t=((e,t)=>{let a;return function(){for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];clearTimeout(a),a=setTimeout((()=>e.apply(n,o)),t)}})((()=>{if(me){const e=le(s),t=Math.min(je/60,20),n=ce(fe,7*t,e);if(be(n),Ze.current){let e=Ze.current,t=null;for(;e;){if(e.classList.contains("MuiBox-root")){let n=e.parentElement.firstChild;for(;n;){if(n!==e&&n.classList.contains("MuiTabs-root")){t=e;break}n=n.nextSibling}}if(t)break;e=e.parentElement}t&&(t.style.height="".concat(n+125,"px"))}}}),100);return(0,a.useEffect)((()=>{t()}),[fe,s,me]),me?W?(0,w.jsxs)(w.Fragment,{children:[Se&&(0,w.jsx)(c.Z,{ref:Ze,sx:{width:"100%",display:"flex",justifyContent:"center",mt:s?1:2,mb:s?3:4},children:(0,w.jsx)(A.ZP,{value:fe,min:new Date(me.dateRange.min).getFullYear(),max:new Date(me.dateRange.max).getFullYear(),onChange:(e,t)=>ve(t),valueLabelDisplay:"off","aria-labelledby":"calendar-chart-year-slider",marks:e,size:"small",sx:{width:"75%"}})}),(0,w.jsx)(J,{isPortrait:s,className:r.chartType,position:"relative",minWidth:"700px",height:ye+"px",minHeight:s?"200px":ye+"px",maxHeight:s&&"550px",children:(0,w.jsx)(de,{data:me.data,dateRange:me.dateRange,valueRangeBoxTitle:(0,y.U)({dataTypeKey:h,dataTypes:x,showUnit:!0}),valueRange:me.valueRange,yearRange:Se?fe:[new Date(me.dateRange.min),new Date(me.dateRange.max)],isPortrait:s,options:xe})})]}):(0,w.jsx)(He,{dataType:(0,y.U)({dataTypeKey:h,dataTypes:x})}):(0,w.jsx)(c.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,w.jsx)(ee.Z,{})})}let Ce,Te=!1,Ae=r.control||(null===(t=r.subcharts)||void 0===t?void 0:t[o].control);Ae&&!0!==l&&(Te=!0,Ce={...Ae.options,ui:X({chartControl:Ae,mainChartData:r,mainChartOptions:xe,subchartIndex:o,theme:M,isPortrait:s})},"ChartRangeFilter"===Ae.controlType&&(0,a.useEffect)((()=>K({controlWrapper:T,chartID:oe})),[T]));const ke=xe.seriesSelector||!1,Ie=xe.dateRangePicker||null,Pe=xe.formatters||null;let ze=r.selectableAxes||null;ze&&(0,ne.qt)(ze.allowedAxes)&&ze.allowedAxes.length<=2&&(ze=null),(0,a.useEffect)((()=>{ke?Ee({newDataColumns:$}):(null===b||void 0===b||b.setOptions({...xe,..."Calendar"===r.chartType&&{height:he}}),null===b||void 0===b||b.draw(),Te&&(null===T||void 0===T||T.setOptions(Ce),null===T||void 0===T||T.draw()))}),[M,s,i,he]),(0,a.useEffect)((()=>{$&&ke&&"setViewColumn"==ke.method&&(Re({dataColumns:$}),Ee({newDataColumns:$}))}),[M]);const Re=e=>{let{dataColumns:t}=e;t.forEach((e=>{var t;e.color=xe.colors[e.seriesIndex%xe.colors.length],e.serieAttribute=null===(t=xe.series)||void 0===t?void 0:t[e.seriesIndex]}))},Me=e=>{let t,n,{dataTable:a,allInitialColumns:r}=e;return r.forEach(((e,r)=>{if(0===r)return;const o=a.getColumnRange(e.sourceColumn);!isNaN(o.min)&&o.min&&(t=t?Math.min(t,o.min):o.min),!isNaN(o.max)&&o.max&&(n=n?Math.max(n,o.max):o.max)})),{min:t,max:n}},Ee=e=>{let{newDataColumns:t,_allInitialColumns:n=Q,_chartWrapper:a=b,_controlWrapper:r=T}=e;if(n){if(te(t),"toggleVisibility"===ke.method||null===ke.method){const e={};if(t.forEach((t=>{t.selected||(e[t.seriesIndex]={color:"transparent",enableInteractivity:!1,visibleInLegend:!1})})),null===a||void 0===a||a.setOptions({...xe,series:{...xe.series,...e}}),Te){const t=null===r||void 0===r?void 0:r.getOptions();null===r||void 0===r||r.setOptions({...t,ui:{...t.ui,chartOptions:{...t.ui.chartOptions,series:{...xe.series,...e}}}})}}else if("setViewColumn"===ke.method){let e=[];e.push(0),t.forEach((t=>{if(t.selected){e.push(t);for(let a=t.indexIn_+1;a<n.length&&"data"!==n[a].role;a++)e.push(n[a])}})),null===a||void 0===a||a.setView({columns:e});const o={...xe};o.colors=t.filter((e=>e.selected)).map((e=>e.color));const i={};let s=0;if(t.forEach((e=>{e.selected&&(null!=e.serieAttribute&&(i[s]=e.serieAttribute),s++)})),o.series=i,null===a||void 0===a||a.setOptions(o),Te){const t=null===r||void 0===r?void 0:r.getOptions();null===r||void 0===r||r.setOptions({...t,ui:{...t.ui,chartOptions:{...t.ui.chartOptions,colors:o.colors,series:o.series},chartView:{columns:e}}})}}null===a||void 0===a||a.draw(),Te&&(null===r||void 0===r||r.draw())}};(0,a.useEffect)((()=>{if(g&&r){if(JSON.stringify(r)===JSON.stringify(z))return;R(r);const e=r.dataArray||r.subcharts&&r.subcharts[o].dataArray||null,t=(0,ne.qt)(e);if(_(t),!0===t){B(!0);const t=g.visualization.arrayToDataTable(e);if(Pe&&"object"===typeof Pe&&Pe.hasOwnProperty("numberFormatter")){const e=new g.visualization.NumberFormat(Pe.numberFormatter.numberFormat);Pe.numberFormatter.columns.forEach((n=>e.format(t,n)))}v(t)}}}),[g,r]),(0,a.useEffect)((()=>{if(!0===L){const e=(e=>{if(!e)return;const t=[];for(const n of e)if("number"===typeof n)t.push(n);else if("object"===typeof n)if(n.calc&&"stringify"!==n.calc){const e=new Function("dataTable","rowNum",n.calc);t.push({...n,calc:e})}else t.push(n);return t})(r.columns||r.subcharts&&r.subcharts[o].columns||null),t=new g.visualization.ChartWrapper({chartType:r.chartType,dataTable:Te?void 0:f,options:xe,view:{columns:e},containerId:oe});let n;if(j(t),Te){const e=new g.visualization.Dashboard(document.getElementById("dashboard-".concat(oe)));D(e),g.visualization.events.addListener(e,"ready",Qe),n=new g.visualization.ControlWrapper({controlType:Ae.controlType,options:Ce,containerId:"control-".concat(oe)}),P(n),e.bind(n,t),e.draw(f)}else g.visualization.events.addListener(t,"ready",Qe),t.draw();if(ke){const{initAllInitialColumns:e,initDataColumns:a}=(e=>{let{chartWrapper:t,dataTable:n,seriesSelector:a}=e;var r=t.getView();if(null==r.columns){const e=new g.visualization.DataView(n);t.setView({columns:e.columns}),r=t.getView()}let o=!0,i=0;const s=r.columns.map(((e,t)=>("number"===typeof e&&(e={role:o?"domain":"data",sourceColumn:e}),e.label=n.getColumnLabel(e.sourceColumn),e.indexInAllInitialColumns=t,o=o&&!1,"data"===e.role&&(a.defaultSeriesToDisplayInitially?a.defaultSeriesToDisplayInitially.includes(t)?e.selected=!0:e.selected=!1:a.allowMultiple?e.selected=!0:e.selected=0===i,e.seriesIndex=i,i++),e)));Y(s);const l=Me({dataTable:n,allInitialColumns:s});re(l);const c=s.filter((e=>{var t,n;return"data"===e.role&&!1!==(null===(t=xe.series)||void 0===t||null===(n=t[e.seriesIndex])||void 0===n?void 0:n.visibleInLegend)}));return"setViewColumn"===a.method&&Re({dataColumns:c}),te(c),{initAllInitialColumns:s,initDataColumns:c}})({chartWrapper:t,dataTable:f,seriesSelector:ke});Ee({_allInitialColumns:e,newDataColumns:a,_chartWrapper:t,_controlWrapper:n})}B(!1)}}),[L]);const Oe=xe.gradientBackgroundColor;let _e,Le;var Be,Fe,Ue,Ne;Oe&&(_e="".concat(oe,"-backgroundGradient"),Le=ie({colors:M.palette.chart.colorAxes[Oe].colors,optionalMinValue:null===(Be=xe.vAxis)||void 0===Be||null===(Fe=Be.viewWindow)||void 0===Fe?void 0:Fe.min,optionalMaxValue:null===(Ue=xe.vAxis)||void 0===Ue||null===(Ne=Ue.viewWindow)||void 0===Ne?void 0:Ne.max}));const Qe=()=>{E&&O(!1)};return W?(0,w.jsxs)(J,{isPortrait:s,gradientBackgroundId:_e,className:r.chartType,position:"relative",height:"100%",minHeight:"Calendar"===r.chartType&&"200px",children:[E&&(0,w.jsx)(c.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,w.jsx)(ee.Z,{})}),E?null:(0,w.jsxs)(k.ZP,{container:!0,mt:1,sx:{gap:2,[M.breakpoints.down("sm")]:{gap:1}},children:[ke&&(0,w.jsx)(k.ZP,{item:!0,sx:{[M.breakpoints.down("sm")]:{width:"100%"}},children:(0,w.jsx)(F,{items:$,allowMultiple:ke.allowMultiple,seriesLabel:ke.seriesLabel,selectorID:"".concat(r.title,"-selector"),onSeriesSelection:Ee,displayChip:!1})}),Ie&&(0,w.jsx)(k.ZP,{item:!0,sx:{height:"2rem",width:{[M.breakpoints.down("sm")]:{width:"100%"}}},children:(0,w.jsx)(We,{dataType:h,minDateOfDataset:new Date(Ie.minDate)})}),ze&&(0,w.jsx)(Ve,{allowedAxes:ze.allowedAxes,selectedAxes:ze.selectedAxes,dataType:h})]}),(()=>{const e=(0,w.jsx)(c.Z,{id:oe,sx:{height:d,maxHeight:u}});var t;return Te?(0,w.jsxs)(p.Z,{id:"dashboard-".concat(oe),direction:(null===(t=U[Ae.controlType])||void 0===t?void 0:t.stackDirection)||"column-reverse",sx:{height:"100%"},children:[(0,w.jsx)(c.Z,{id:"control-".concat(oe),sx:{height:"calc(".concat(d," / 8)"),opacity:.8,filter:"saturate(0.3)"}}),e]}):e})(),Oe?(0,w.jsx)(se,{id:_e,colors:Le}):null]}):(0,w.jsxs)(w.Fragment,{children:[ze&&(0,w.jsx)(c.Z,{mt:1,children:(0,w.jsx)(Ve,{allowedAxes:ze.allowedAxes,selectedAxes:ze.selectedAxes,dataType:h})}),(0,w.jsx)(He,{dataType:(0,y.U)({dataTypeKey:h,dataTypes:x}),selectableAxes:ze,height:ke||Te?1.2*parseFloat(d)+"vw":d})]})}var Ye=n(53767);const qe=function(e){let{text:t,wordLimit:n=40,reference:r}=e;const[o,i]=(0,a.useState)(!1),l=(0,I.Z)(),d=(0,h.Z)(l.breakpoints.down("sm")),u=(0,a.useRef)(null),p=t.split(" ");if(!d||p.length/n<=1.4)return(0,w.jsxs)(c.Z,{children:[(0,w.jsx)(g.Z,{children:(0,s.ZP)(t,{replace:ne.T1})}),r&&(0,w.jsx)(g.Z,{variant:"caption",color:"text.secondary",children:(0,s.ZP)(r,{replace:ne.T1})})]});let x=p.slice(0,n).join(" ");const m=x.lastIndexOf(".");return-1!==m&&(x=x.slice(0,m+1)),(0,w.jsx)(Ye.d,{onClickAway:e=>{(e=>{let{target:t}=e;const n=u.current.closest(".MuiContainer-root"),a=new Set(["rect","path","svg","circle"]);for(;null!=t;){if(a.has(t.tagName))return t.closest(".MuiContainer-root")===n;t=t.parentNode}return!1})(e)||i(!1)},children:(0,w.jsx)(c.Z,{ref:u,onClick:()=>i(!o),style:{cursor:"pointer"},children:o?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(g.Z,{children:(0,s.ZP)(t,{replace:ne.T1})}),r&&(0,w.jsx)(g.Z,{variant:"caption",color:"text.secondary",children:(0,s.ZP)(r,{replace:ne.T1})})]}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(g.Z,{display:"inline",children:[(0,s.ZP)(x,{replace:ne.T1}),"..."]}),(0,w.jsx)(g.Z,{display:"inline",color:"text.primary",fontWeight:"500",sx:{ml:.5,"& :hover":{textDecoration:"underline"}},children:"See more"})]})})})};var Ge=n(26759);const Xe=e=>{let{selectedDataType:t,dataTypes:n,fetchChartDataType:r}=e;const[o,i]=(0,a.useState)(null);if(!(0,ne.qt)(n))return null;if(n.length<=1)return(0,w.jsx)(g.Z,{display:"inline",variant:"h6",color:"text.primary",children:n[0].name_title});const s=Boolean(o),l=()=>{i(null)};return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(me.Z,{id:"data-type-drop-down-menu-button","aria-controls":s?"data-type-drop-down-menu":void 0,"aria-haspopup":"true","aria-expanded":s?"true":void 0,onClick:e=>{i(e.currentTarget)},variant:"text",size:"small",sx:{p:0,minWidth:"unset",borderRadius:0,verticalAlign:"top",textTransform:"unset"},children:[(0,w.jsx)(g.Z,{display:"inline",variant:"h6",borderBottom:"dotted",children:(0,y.U)({dataTypeKey:t,dataTypes:n,showUnit:!0})}),(0,w.jsx)(Ge.Z,{})]}),(0,w.jsx)(m.Z,{id:"data-type-drop-down-menu",anchorEl:o,open:s,onClose:l,MenuListProps:{"aria-labelledby":"data-type-drop-down-menu-button"},children:n.map(((e,t)=>(0,w.jsx)(u.Z,{sx:{fontSize:"0.8rem"},onClick:()=>(e=>{r(e),l()})(e.key),children:e.name_title},t)))})]})},$e=(0,l.ZP)(c.Z)((e=>{let{theme:t}=e;return{..."dark"===t.palette.mode&&{filter:"saturate(0.85)","& .heat-map-iframe":{filter:"invert(0.848) hue-rotate(180deg)"}},"& .Calendar [dir]:not(:empty)":{margin:"auto"},"& .Calendar > div > div:last-of-type > div":{overflowX:"auto",overflowY:"hidden",scrollbarGutter:"stable"}}})),Ke=(0,l.ZP)(d.Z)((e=>{let{theme:t}=e;return{"& .MuiTabScrollButton-root":{color:t.palette.text.primary},"& .MuiTab-root":{[t.breakpoints.down("sm")]:{fontSize:"0.625rem",padding:t.spacing(.5)}},"& .MuiSvgIcon-root ":{[t.breakpoints.down("sm")]:{fontSize:"0.75rem"}}}})),Je=(0,l.ZP)(u.Z)((e=>{let{theme:t}=e;return{"& .MuiBox-root ":{[t.breakpoints.down("sm")]:{fontSize:"0.75rem"}}}}));const et=function(e){const{chartTitle:t,generalChartSubtitle:n,generalChartReference:r,chartData:i,chartHeight:s,chartID:l,chartIndex:d,isHomepage:u}=e,{currentSchoolID:S,setIndividualChartData:Z}=(0,a.useContext)(j.G),C=(0,h.Z)((e=>e.breakpoints.down("sm"))),[T,A]=(0,a.useState)(window.matchMedia("(orientation: portrait)").matches),[k,I]=(0,a.useState)([window.innerWidth,window.innerHeight]);let P,z=s;const R=i,[M,E]=(0,a.useState)(0),[O,_]=(0,a.useState)(0),[L,B]=(0,a.useState)(-1),[F,U]=(0,a.useState)(),[N,V]=(0,a.useState)(null),[H,Q]=(0,a.useState)([]),[Y,q]=(0,a.useState)(null),{dateRange:G,aggregationType:X}=Re(),{hAxis:$,vAxis:K}=Fe();return(0,a.useEffect)((()=>{if(R.allowedDataTypes){const e=[];for(let t of R.allowedDataTypes){const{name_title:n,name_short:a,unit:r}=y.Z[t];e.push({key:t,name_title:n,name_short:a,unit:r})}Q(e)}q(R.selectedDataType)}),[R]),(0,a.useEffect)((()=>{let e=null;const t=()=>{clearTimeout(e),e=setTimeout((()=>{A(window.matchMedia("(orientation: portrait)").matches),I([window.innerWidth,window.innerHeight])}),100)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}}),[R]),(0,a.useEffect)((()=>{_(M),E(0)}),[S]),"Calendar"===R.chartType||z||(z=T?"80vw":"35vw",P=T?"800px":"500px"),t?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(c.Z,{children:[(0,w.jsxs)(g.Z,{display:"inline",variant:"h6",color:"text.primary",children:[d+1,". ",t,"\xa0"]}),(0,w.jsx)(c.Z,{display:"inline",children:(0,w.jsx)(Xe,{selectedDataType:Y,dataTypes:H,fetchChartDataType:async e=>{const t=b.UA[l];let n;if(t===b.ZU.historical){const{startDate:a,endDate:r}=G||{};if(!a||!r)return;const o=De({startDateObject:a,endDateObject:r});n=(0,b.kq)({endpoint:t,school_id:S,startDate:o.startDate,endDate:o.endDate,aggregationType:X,dataType:e})}else n=t===b.ZU.correlationDailyAverage?(0,b.Qo)({endpoint:b.ZU.correlationDailyAverage,school_id:S,dataType:e,sensorX:$,sensorY:K}):(0,b.Eh)({endpoint:t,school_id:S,dataType:e});n&&(0,o.m)({url:n,extension:"json",needsAuthorization:!0}).then((e=>{Z(l,e),q(e.selectedDataType)})).catch((e=>{console.log(e)}))}})})]}),(0,w.jsxs)($e,{height:"100%",children:[(0,w.jsx)(D,{children:R.subcharts?(()=>{const e=R.subcharts.length>4,t=e?R.subcharts.slice(0,3):R.subcharts,n=e?R.subcharts.slice(3):null,a=e=>-1===M?O===e:M===e;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(Ke,{value:M,onChange:(t,n)=>{_(M),E(n),e&&n<3&&n!==L&&(U(),B(-1))},variant:C?"fullWidth":"standard",children:[t.map(((e,t)=>(0,w.jsx)(x.Z,{value:t,label:R.subcharts[t].subchartTitle,sx:{textDecoration:!(0,ne.qt)(R.subcharts[t].dataArray)&&"line-through"}},t))),e&&(0,w.jsx)(x.Z,{value:L,label:(0,w.jsxs)(p.Z,{direction:"row",justifyContent:"center",alignItems:"center",children:[(0,w.jsxs)(c.Z,{flex:1,children:["Other sensors",F&&" (".concat(F,")"),"\xa0"]}),(0,w.jsx)(v.Z,{})]}),"aria-controls":"submenu","aria-haspopup":"true",onClick:e=>V(e.currentTarget)})]}),e&&(0,w.jsx)(m.Z,{id:"submenu",anchorEl:N,open:Boolean(N),onClose:()=>{-1===M&&(_(M),E(O)),V(null)},children:n.map(((e,t)=>(0,w.jsx)(Je,{selected:t===M-3,onClick:()=>(e=>{_(M),E(3+e),B(3+e),U(n[e].subchartTitleShort),V(null)})(t),sx:{textDecoration:!(0,ne.qt)(R.subcharts[t+3].dataArray)&&"line-through"},children:(0,w.jsxs)(p.Z,{direction:"row",alignItems:"center",gap:1,children:[(0,w.jsx)(c.Z,{children:n[t].subchartTitle}),t===M-3&&(0,w.jsx)(W.Z,{fontSize:"1rem",sx:{color:"text.secondary"}})]})},t)))}),(0,w.jsx)(c.Z,{position:"relative",sx:{overflowX:T&&"auto",WebkitOverflowScrolling:T&&"touch",overflowY:"hidden"},children:R.subcharts.map(((e,t)=>(0,w.jsx)(c.Z,{width:"100%",height:"100%",role:"tabpanel",sx:{transition:"0.35s",position:0===t?"":"absolute",opacity:a(t)?"1":"0",pointerEvents:a(t)?"auto":"none",top:0===t?"":0},children:(0,w.jsx)(Qe,{selectedDataType:Y,allowedDataTypes:H,chartData:R,subchartIndex:t,isPortrait:T,isHomepage:u,windowSize:k,height:R.height?R.height:z,maxHeight:["Calendar"].includes(R.chartType)?"":P,currentSubchart:M})},t)))})]})})():(0,w.jsx)(Qe,{selectedDataType:Y,allowedDataTypes:H,chartData:R,isPortrait:T,isHomepage:u,windowSize:k,height:R.height?R.height:z})}),(0,w.jsx)(c.Z,{sx:{my:3},children:(0,w.jsx)(g.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{mb:1},children:(0,w.jsx)(qe,{text:(()=>{var e;let t=n||"";return R.subcharts&&null!==(e=R.subcharts[M])&&void 0!==e&&e.subchartSubtitle&&(t+="<br/>",t+=R.subcharts[M].subchartSubtitle),t})(),reference:(()=>{var e;let t=r||"";return R.subcharts&&null!==(e=R.subcharts[M])&&void 0!==e&&e.reference&&(t+="<br/>",t+=R.subcharts[M].reference),t})()})})})]})]}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(f.Z,{variant:"text",sx:{width:"100%",fontSize:"2rem"}}),(0,w.jsx)(f.Z,{variant:"rounded",width:"100%",height:300})]})};var tt=n(61745),nt=n(40472),at=n(20068),rt=n(89164),ot=n(94721),it=n(30604),st=n(60173),lt=n(49877),ct=n(55396),dt=n(60627),ut=n(61162),ht=n(53524),pt=n(47438),xt=n(80223);function mt(e){const[t,n]=(0,a.useState)(null),r=e=>{n(e.currentTarget),pt.y(pt.z.airQualityIndexLegendQuickGlance)},o=()=>{n(null)},i=Boolean(t);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(ht.TF,{...e,distanceFromBottomOfWindow:"5.5rem",children:(0,w.jsx)(lt.Z,{sx:{mt:1},"aria-owns":i?pt.z.airQualityIndexLegendQuickGlance:void 0,"aria-haspopup":"true",onMouseEnter:r,onMouseLeave:o,onClick:e=>st.tq&&(i?o():r(e)),"aria-label":pt.z.airQualityIndexLegendQuickGlance,color:"primary",children:(0,w.jsxs)(p.Z,{direction:"column",alignItems:"center",children:[(0,w.jsx)(ut.Z,{fontSize:"1rem"}),(0,w.jsx)(g.Z,{variant:"body2",fontWeight:"500",children:"AQI"})]})})}),(0,w.jsx)(ct.Z,{id:pt.z.airQualityIndexLegendQuickGlance,sx:{pointerEvents:"none",mt:-1},open:i,anchorEl:t,placement:"top-end",onClose:o,keepMounted:!0,disableRestoreFocus:!0,transition:!0,children:e=>{let{TransitionProps:t}=e;return(0,w.jsx)(dt.Z,{...t,timeout:350,children:(0,w.jsxs)(ge.Z,{elevation:8,sx:{py:.5,mb:1},children:[(0,w.jsx)(g.Z,{sx:{mx:2,mt:1},color:"text.disabled",variant:"body1",fontWeight:500,children:"AQI at quick glance"}),(0,w.jsx)(xt.Z,{isTiny:!0,hideAQIDescription:!0})]})})}})]})}var gt=n(71478),ft=n(40501),vt=n(44281),yt=(n(14058),n(4853)),bt=n(69161),jt=n(29818),wt=n(97123),St=n(30195),Dt=n(80043),Zt=n(79836),Ct=n(56890),Tt=n(35855),At=n(53994),kt=n(53382),It=n(73518),Pt=n(71566),zt=n(31009);function Rt(e){const{currentSchoolID:t,current:n}=(0,a.useContext)(j.G),[r,o]=(0,a.useState)({}),[i,s]=(0,a.useState)("placeholder");(0,a.useEffect)((()=>{if(!n)return;const e=n.filter((e=>e&&e.sensor)).reduce(((e,t)=>(e[t.sensor.location_short]={location_type:t.sensor.location_type,location_short:t.sensor.location_short,location_long:t.sensor.location_long,last_seen:t.sensor.last_seen.split("T")[0],rawDatasets:Object.keys(b.M$).reduce(((e,t)=>(e[b.M$[t]]={sample:null,full:null},e)),{})},e)),{});o(e)}),[n]);const l=(0,I.Z)(),c=(0,h.Z)(l.breakpoints.down("sm")),[d,u]=(0,a.useState)(!1),p=()=>{u(!1)};return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(me.Z,{onClick:()=>{s(null),u(!0),pt.y(pt.z.rawDatasetButtonClicked)},variant:"contained",children:[(0,w.jsx)(Pt.Z,{sx:{fontSize:"1rem"}}),"\xa0Raw Dataset"]}),(0,w.jsxs)(jt.Z,{open:d,onClose:p,maxWidth:"lg",fullWidth:!0,fullScreen:c,keepMounted:!0,zIndex:1e4,children:[c&&(0,w.jsx)(wt.Z,{sx:{justifyContent:"start"},children:(0,w.jsxs)(me.Z,{onClick:p,children:[(0,w.jsx)(zt.Z,{sx:{fontSize:"1rem"}}),"Back"]})}),(0,w.jsxs)(St.Z,{sx:{px:c?2:3,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"start"},children:[(0,w.jsx)(O.Z,{label:t?"School: ".concat(t.toUpperCase()):"No School",size:"small",sx:{mb:1}}),(0,w.jsx)(g.Z,{variant:"h6",zIndex:"10000",sx:{mb:1},children:"Preview and download raw dataset(s)"}),(0,w.jsx)(Mt,{sensorsDatasets:r,updateSensorsDatasets:o,previewingDataset:i,setPreviewingDataset:s,smallScreen:c,schoolID:t}),r&&(0,w.jsxs)(g.Z,{variant:"caption",sx:{my:3,fontStyle:"italic"},children:["These datasets are provided by CITIESair from sensors operated by CITIESair. Should you intend to utilize them for your project, research, or publication, we kindly request that you notify us at ",(0,w.jsx)(Dt.Z,{href:"mailto:nyuad.cities@nyu.edu",children:"nyuad.cities@nyu.edu"})," to discuss citation requirements."]})]})]})]})}const Mt=e=>{const{sensorsDatasets:t,updateSensorsDatasets:n,previewingDataset:r,setPreviewingDataset:i,smallScreen:s,schoolID:l}=e;return(0,a.useEffect)((()=>{if(Object.keys(t).length>0&&!r){const e=Object.keys(t)[0],a=b.M$.hourly;if(i({sensor:e,datasetType:a}),t[e].rawDatasets[a].sample)return;const r=(0,b.OM)({school_id:l,sensor_location_short:e,datasetType:a,isSample:!0});(0,o.m)({url:r,extension:"csv",needsAuthorization:!0}).then((r=>{const o={...t};o[e].rawDatasets[a].sample=r,n(o)})).catch((e=>console.log(e)))}}),[t,r]),(0,w.jsxs)(k.ZP,{container:!0,justifyContent:"center",alignItems:"start",spacing:s?1:2,sx:{mt:0},overflow:"scroll",children:[(0,w.jsx)(k.ZP,{item:!0,sm:12,md:6,children:(0,w.jsx)(Et,{schoolID:l,sensorsDatasets:t,updateSensorsDatasets:n,smallScreen:s,previewingDataset:r,setPreviewingDataset:i})}),(0,w.jsx)(k.ZP,{item:!0,sm:12,md:6,maxWidth:s?"100%":"unset",sx:{mt:1},children:(0,w.jsx)(Wt,{sensorsDatasets:t,updateSensorsDatasets:n,previewingDataset:r,schoolID:l,smallScreen:s})})]})},Et=e=>{const{schoolID:t,sensorsDatasets:n,smallScreen:a,previewingDataset:r,setPreviewingDataset:o,updateSensorsDatasets:i}=e;return(0,w.jsxs)(Zt.Z,{size:"small",sx:{tableLayout:"fixed","& td, div, .MuiMenuItem-root":{fontSize:a?"0.625rem":"0.8rem"}},children:[(0,w.jsx)(Ct.Z,{children:(0,w.jsxs)(Tt.Z,{children:[(0,w.jsx)(At.Z,{sx:{pl:1},children:"Sensor Location"}),(0,w.jsx)(At.Z,{sx:{width:a?"9.5rem":"11rem"},children:"Dataset Type"})]})}),(0,w.jsx)(kt.Z,{children:n&&Object.keys(n).map((e=>(0,w.jsx)(Ot,{schoolID:t,smallScreen:a,sensor:e,sensorsDatasets:n,previewingDataset:r,setPreviewingDataset:o,isPreviewing:e===(null===r||void 0===r?void 0:r.sensor),updateSensorsDatasets:i})))})]})},Ot=e=>{const{schoolID:t,sensorsDatasets:n,sensor:r,previewingDataset:i,setPreviewingDataset:s,isPreviewing:l,updateSensorsDatasets:c}=e,[d,h]=(0,a.useState)(b.M$.hourly);(0,a.useEffect)((()=>{d!==b.M$.hourly&&h(b.M$.hourly)}),[t]);const x=e=>{if(!n[r].rawDatasets[e].sample){const a=(0,b.OM)({school_id:t,sensor_location_short:n[r].location_short,datasetType:e,isSample:!0});(0,o.m)({url:a,extension:"csv",needsAuthorization:!0}).then((t=>{const a={...n};a[r].rawDatasets[e].sample=t,c(a)}))}},m=(0,I.Z)();return(0,w.jsx)(w.Fragment,{children:(0,w.jsxs)(Tt.Z,{children:[(0,w.jsx)(At.Z,{sx:{pl:1,cursor:"pointer",background:l&&m.palette.background.NYUpurpleLight},onClick:()=>{(null===i||void 0===i?void 0:i.sensor)!==r&&(s({datasetType:d,sensor:r}),x(d))},children:n[r].location_long}),(0,w.jsx)(At.Z,{sx:{position:"relative",background:l&&m.palette.background.NYUpurpleLight},children:(0,w.jsx)(P.Z,{size:"small",children:(0,w.jsx)(z.Z,{value:d,onChange:e=>{const t=e.target.value;h(t),s({datasetType:t,sensor:r}),x(t)},variant:"standard",MenuProps:{disablePortal:!0},children:Object.keys(n[r].rawDatasets).reverse().map(((e,t)=>(0,w.jsx)(u.Z,{value:e,children:(0,w.jsx)(p.Z,{direction:"row",alignItems:"center",children:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()})},t)))})})})]},r)})},Wt=e=>{const{sensorsDatasets:t,updateSensorsDatasets:n,previewingDataset:r,schoolID:i,smallScreen:s}=e,l=(0,I.Z)(),[d,u]=(0,a.useState)("Not previewing any dataset"),[h,x]=(0,a.useState)("No dataset"),[m,f]=(0,a.useState)(!1),v=e=>{const t=new Blob([e],{type:"application/octet-stream"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=h,document.body.appendChild(a),a.click(),URL.revokeObjectURL(n),document.body.removeChild(a)},[y,j]=(0,a.useState)(""),[S,D]=(0,a.useState)("");return(0,a.useEffect)((()=>{var e,n;if(!r)return;u("Previewing: ".concat(r.sensor," (").concat(r.datasetType,")"));const a=null===(e=t[r.sensor])||void 0===e||null===(n=e.rawDatasets[r.datasetType])||void 0===n?void 0:n.sample;if(!a)return D(null),j(null),x("Loading..."),void f(!0);m&&f(!1);const o=a.split("\n"),s=o[0].split(","),l=o.slice(1);let c;if(D(["",...l.map((e=>e.split(",")[0]))].join("\n")),j([s.slice(1).join(","),...l.map((e=>e.split(",").slice(1).join(",")))].join("\n")),l.length>0){const e=l[l.length-1].split(",");if(e.length>=2){c=e[1].split("T")[0]}}const d="".concat(i,"-").concat(r.sensor,"-").concat(r.datasetType,"-").concat(c,".csv");x(d)}),[r,t]),(0,w.jsxs)(p.Z,{spacing:1,children:[(0,w.jsxs)(c.Z,{sx:{"& *":{fontFamily:"monospace !important"}},children:[(0,w.jsx)(p.Z,{direction:"row",children:(0,w.jsx)(g.Z,{variant:"body2",gutterBottom:!0,fontWeight:500,children:d})}),(0,w.jsx)(c.Z,{component:"pre",sx:{overflowX:"auto",color:l.palette.text.secondary,backgroundColor:l.palette.customBackground,p:2,pt:1.5,borderRadius:l.shape.borderRadius,borderTopLeftRadius:0,height:s?"11.8rem":"14rem",width:s?"100%":"unset",marginTop:0},children:(0,w.jsx)(p.Z,{direction:"row",sx:{fontSize:s?"0.625rem !important":"0.8rem !important"},children:y?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(c.Z,{sx:{mr:2,userSelect:"none"},children:S}),(0,w.jsx)(c.Z,{children:y})]}):(0,w.jsx)(ee.Z,{optionalText:"Loading"})})})]}),(0,w.jsx)(c.Z,{textAlign:"center",children:(0,w.jsxs)(me.Z,{variant:"contained",sx:{textTransform:"none",textAlign:"left",lineHeight:1.1,px:1.5,py:1},onClick:()=>{(()=>{if(!r)return;const e=t[r.sensor].rawDatasets[r.datasetType].full;if(e)v(e);else{const e=(0,b.OM)({school_id:i,sensor_location_short:r.sensor,datasetType:r.datasetType,isSample:!1});(0,o.m)({url:e,extension:"csv",needsAuthorization:!0}).then((e=>{const a={...t};a[r.sensor].rawDatasets[r.datasetType].full=e,n(a),v(e)}))}})(),pt.y(pt.z.rawDatasetDownloaded,{dataset_type:null===r||void 0===r?void 0:r.datasetType,sensor:null===r||void 0===r?void 0:r.sensor})},disabled:m,children:[(0,w.jsx)(It.Z,{sx:{fontSize:"1.25rem",mr:.5}}),h]})})]})};var _t=n(11087),Lt=n(22981),Bt=n(81131),Ft=n(51440);const Ut=()=>{const[e,t]=(0,a.useState)(null),{currentSchoolID:n,schoolMetadata:r}=(0,a.useContext)(j.G);if(!r)return;const o=r.screens;if(!(0,ne.qt)(o))return null;if(o.length<=1)return(0,w.jsxs)(me.Z,{variant:"contained",component:_t.rU,to:"/screen/".concat(n),children:[(0,w.jsx)(Lt.Z,{sx:{fontSize:"1rem"}}),"\xa0TV Screen"]});const i=Boolean(e);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(me.Z,{id:"basic-button","aria-controls":i?"tv-screen-list-menu":void 0,"aria-haspopup":"true","aria-expanded":i?"true":void 0,onClick:e=>{t(e.currentTarget)},variant:"contained",children:[(0,w.jsx)(Lt.Z,{sx:{fontSize:"1rem"}}),"\xa0 TV Screens List"]}),(0,w.jsx)(m.Z,{id:"tv-screen-list-menu",anchorEl:e,open:i,onClose:()=>{t(null)},MenuListProps:{"aria-labelledby":"basic-button"},children:o.map(((e,t)=>(0,w.jsx)(Bt.ZP,{behavior:Ft.Z.toNewPage,to:"/screen/".concat(n,"/").concat(e.screen_name),label:e.location_long,sx:{fontSize:"0.8rem"}},t)))})]})};var Nt=n(16344),Vt=n(1414),Ht=n(25028),Qt=n(58562),Yt=n(16071),qt=n(18610),Gt=n(31781),Xt=n(70366);const $t=()=>{const{currentSchoolID:e,schoolMetadata:t}=(0,a.useContext)(j.G),{user:n}=(0,a.useContext)(Gt.S);if(!Array.isArray(n.allowedSchools)||n.allowedSchools.length<=1)return(0,w.jsx)(rn,{icon:(0,w.jsx)(Qt.Z,{}),label:(null===t||void 0===t?void 0:t.name)||"N/A",tooltipTitle:"School"});const[o,i]=(0,a.useState)(""),[s,l]=(0,a.useState)(null),d=()=>{l(null)},h=(0,r.s0)(),p=t=>()=>{e!==t&&(localStorage.setItem(Yt.m.schoolID,t),i(t),pt.y(pt.z.internalNavigation,{origin_school:e,destination_school_id:t,origin_id:"school_selector"}),h("".concat(qt.f.dashboard,"/").concat(t))),d()};return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(rn,{icon:(0,w.jsx)(Qt.Z,{}),label:(0,w.jsxs)(c.Z,{sx:{"& svg":{fontSize:"1rem",verticalAlign:"sub",marginLeft:"0.25rem"}},children:[(null===t||void 0===t?void 0:t.name)||"N/A",Boolean(s)?(0,w.jsx)(Xt.Z,{}):(0,w.jsx)(Ge.Z,{})]}),tooltipTitle:"Click to Select School",clickable:!0,onClick:e=>{l(e.currentTarget)},"aria-controls":open?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":open?"true":void 0}),(0,w.jsx)(m.Z,{anchorEl:s,open:Boolean(s),onClose:d,MenuListProps:{"aria-labelledby":"basic-button"},children:(0,w.jsx)(Ht.Z,{dense:!0,children:n.allowedSchools.map(((e,t)=>(0,w.jsx)(u.Z,{onClick:p(e.school_id),children:e.name},t)))})})]})};var Kt=n(70445),Jt=n(26459),en=n(19132),tn=n(85172);const nn=()=>{const{setLoadMoreCharts:e}=(0,a.useContext)(j.G);return(0,w.jsx)(p.Z,{sx:{mt:6,mx:"auto",maxWidth:"sm"},children:(0,w.jsxs)(me.Z,{variant:"contained",onClick:()=>{e(!0)},children:[(0,w.jsx)(tn.Z,{sx:{fontSize:"1rem"}}),"\xa0Load More Charts"]})})};var an=n(35429);const rn=e=>{const{tooltipTitle:t,label:n,...a}=e;return(0,w.jsx)(at.Z,{title:t,enterDelay:0,leaveDelay:200,children:(0,w.jsx)(O.Z,{size:"small",label:n||(0,w.jsx)(f.Z,{variant:"text",sx:{minWidth:"5rem"}}),...a})})},on=()=>{let e;const{setChartsTitlesList:t}=(0,a.useContext)(i.F),{commentCounts:n,fetchCommentCounts:r,setCommentCounts:o}=(0,a.useContext)(Kt.c),{schoolMetadata:l,current:d,allChartsData:u,loadMoreCharts:h}=(0,a.useContext)(j.G),{themePreference:x,temperatureUnitPreference:m}=(0,a.useContext)(en.p),[v,y]=(0,a.useState)(!1),[b,S]=(0,a.useState)(!1);(0,a.useEffect)((()=>{if(!l)return;const e="nyuad"===l.school_id;y(e),S(e),e&&!n&&r().then((e=>{o(e)}))}),[l]),(0,a.useEffect)((()=>{if(null===u||void 0===u||!u.charts)return;const e=null===u||void 0===u?void 0:u.charts.map(((e,t)=>({chartTitle:e.title,chartID:"chart-".concat(t+1)})));t(e)}),[u]);const D=(0,I.Z)(),Z=e=>!0===e&&!1===h?(0,w.jsx)(nn,{}):null,C=()=>(0,w.jsxs)(k.ZP,{container:!0,spacing:1,sx:{mt:-3,pb:3},children:[(0,w.jsx)(k.ZP,{item:!0,children:(0,w.jsx)($t,{})}),(0,w.jsx)(k.ZP,{item:!0,children:(0,w.jsx)(rn,{icon:(0,w.jsx)(ft.Z,{}),label:null===l||void 0===l?void 0:l.contactPerson,tooltipTitle:"Contact Person"})}),(0,w.jsx)(k.ZP,{item:!0,children:(0,w.jsx)(rn,{icon:(0,w.jsx)(vt.Z,{}),label:null===l||void 0===l?void 0:l.contactEmail,tooltipTitle:"Contact Email",component:"a",href:"mailto:".concat(null===l||void 0===l?void 0:l.contactEmail),clickable:!0})}),(0,w.jsx)(k.ZP,{item:!0,children:(0,w.jsx)(rn,{icon:(0,w.jsx)(yt.Z,{}),label:"".concat(Object.keys(u).length||"..."," Chart").concat(1!==Object.keys(u).length?"s":""),tooltipTitle:"Number of Charts",onClick:()=>{var e;(0,Bt.Qj)(gt.O3.id),pt.y(pt.z.internalNavigation,{destination_id:gt.O3.id,destination_label:null===(e=gt.chartData)||void 0===e?void 0:e.toString(),origin_id:"chip"})}})}),e,!0===v&&null!==n&&(0,w.jsx)(k.ZP,{item:!0,children:(0,w.jsx)(rn,{icon:(0,w.jsx)(bt.Z,{}),label:"".concat(n[nt.Hf]," Comment").concat(n[nt.Hf]>1?"s":""),tooltipTitle:"Number of Comments",onClick:()=>{(0,Bt.Qj)(gt.Sf.id),pt.y(pt.z.internalNavigation,{destination_id:gt.Sf.id,destination_label:gt.Sf.toString(),origin_id:"chip"})}})})]});return(0,w.jsxs)(c.Z,{width:"100%",children:[(0,w.jsx)(mt,{}),(0,w.jsx)(Nt.Z,{backgroundColor:"customAlternateBackground",children:(0,w.jsxs)(rt.Z,{sx:{pt:2,pb:2},children:[(0,w.jsx)(tt.Z,{text:(()=>{if(null!==l&&void 0!==l&&l.school_id)return"Air Quality | ".concat(null===l||void 0===l?void 0:l.school_id)})()}),(0,w.jsx)(C,{}),!0===b&&(0,w.jsx)(Jt.Z,{initialNyuadCurrentData:d,isOnBannerPage:!1,themePreference:x,minMapHeight:"250px"}),!1===b&&(0,w.jsx)(c.Z,{textAlign:"center",sx:{mb:2},children:(0,w.jsx)(Vt.Z,{currentSensorsData:d,isScreen:!1,temperatureUnitPreference:m})}),l?(0,w.jsx)(g.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{textAlign:"justify",pb:2,mb:0,"& table *":{color:"".concat(D.palette.text.secondary)}},gutterBottom:!0,children:(0,s.ZP)(l.description||"",{replace:ne.T1})}):Array.from({length:3}).map(((e,t)=>(0,w.jsx)(f.Z,{variant:"text"},t))),(0,w.jsxs)(p.Z,{direction:"row",spacing:2,children:[(0,w.jsx)(Ut,{}),(0,w.jsx)(Rt,{})]}),(0,w.jsx)(an.Z,{})]})}),(0,w.jsx)(c.Z,{id:gt.O3.id,children:Object.keys(u).length>0?(0,w.jsx)(w.Fragment,{children:Object.keys(u).map(((e,t)=>(0,w.jsx)(Nt.Z,{backgroundColor:t%2!==0?"customAlternateBackground":"",children:(0,w.jsxs)(rt.Z,{sx:{pt:4,pb:4},height:"auto",className:x===it.Z.dark?"dark":"",id:"chart-".concat(t+1),children:[(0,w.jsx)(Be,{children:(0,w.jsx)(ze,{children:(0,w.jsx)(et,{chartTitle:u[e].title,generalChartSubtitle:u[e].subtitle,generalChartReference:u[e].reference,chartData:{chartIndex:t,...u[e]},chartID:e,chartIndex:t})})}),Z(t===Object.keys(u).length-1)]})},e)))}):(0,w.jsx)(ee.Z,{optionalText:"Loading Visualizations"})}),(0,w.jsx)(ot.Z,{}),!0===v&&(0,w.jsx)(Nt.Z,{id:gt.Sf.id,sx:{pt:3,pb:4},children:(0,w.jsx)(nt.ZP,{pageID:nt.Hf})})]})},sn=()=>{const{school_id_param:e}=(0,r.UO)(),t=(0,r.s0)(),n=(0,r.TH)().pathname;(0,a.useEffect)((()=>{e&&(document.title="CITIESair | ".concat(e.toUpperCase()))}),[e]);const{setCurrentPage:s}=(0,a.useContext)(i.F);(0,a.useEffect)((()=>{s(qt.f.dashboard)}),[]);const{currentSchoolID:l,setCurrentSchoolID:c,schoolMetadata:d,setSchoolMetadata:u,current:h,setCurrent:p,allChartsData:x,setIndividualChartData:m,loadMoreCharts:g}=(0,a.useContext)(j.G),{user:f}=(0,a.useContext)(Gt.S);(0,a.useEffect)((()=>{if("nyuad"===e)return v("nyuad"),void c("nyuad");!0===f.checkedAuthentication&&!1===f.authenticated&&t("".concat(qt.f.login,"?").concat(qt.f.redirectQuery,"=").concat(n));const a=f.allowedSchools;if(Array.isArray(a)&&a.length>0){if(!e){let e;const n=localStorage.getItem(Yt.m.schoolID);a.map((e=>e.school_id)).includes(n)?e=n:(e=a[0].school_id,c(e),localStorage.setItem(Yt.m.schoolID,e)),t(e,{replace:!0}),(d||h||x)&&v(e)}if(a.map((e=>e.school_id)).includes(e))return c(e),v(e),void localStorage.setItem(Yt.m.schoolID,e)}}),[f,e]);const v=async e=>{try{u(),p();const t=await Promise.all([(0,o.m)({url:(0,b.kG)({endpoint:b.a3.schoolmetadata,school_id:e}),extension:"json",needsAuthorization:!0}),(0,b.mQ)((0,b.kG)({endpoint:b.a3.current,school_id:e}))]);u(t[0]),p(t[1])}catch(t){console.log(t)}(g?b.UA:b.UA.slice(0,2)).forEach(((t,n)=>{m(n,{}),(0,o.m)({url:(0,b.kq)({endpoint:t,school_id:e}),extension:"json",needsAuthorization:!0}).then((e=>{m(n,e)})).catch((e=>{console.log(e)}))}))};return(0,a.useEffect)((()=>{if(!0===g){b.UA.slice(2).forEach(((e,t)=>{const n=2+t;m(n,{}),(0,o.m)({url:(0,b.Eh)({endpoint:e,school_id:l}),extension:"json",needsAuthorization:!0}).then((e=>{m(n,e)})).catch((e=>{console.log(e)}))}))}}),[g]),(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(on,{})})}}}]);
//# sourceMappingURL=822.20118544.chunk.js.map