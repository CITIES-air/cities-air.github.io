"use strict";(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[429],{35429:(e,t,r)=>{r.d(t,{Z:()=>m});var a=r(72791),o=r(20890),n=r(53540),i=r(69755),l=r(80223),s=r(7009),d=r(19132),c=r(80184);const u="Explanation of the US Air Quality Index (AQI) for PM2.5",p="CITIESair uses the <a href='https://www.airnow.gov/aqi/aqi-basics/'>Air Quality Index (AQI)</a> developed by the United States Environmental Protection Agency (EPA) to effectively communicate different levels of PM2.5 air pollution. To calculate the AQI from the raw measurement of PM2.5 concentration (\xb5g/m\xb3), different breakpoints and piecewise linear function are utilized (read more <a href='https://en.wikipedia.org/wiki/Air_quality_index#United_States'>here</a>). Higher AQI values correspond to poorer air quality and greater heath risks to humans.<br><br>The US EPA sets thresholds for PM2.5 concentration, recently updated in February 2024: <sup>[1]</sup><ul><li><b>Annual average</b>: 9.0 \xb5g/m\xb3, corresponding to US AQI <b>50</b></li><li><b>24-hour average</b>: 35.0 \xb5g/m\xb3, corresponding to US AQI <b>100</b></li></ul>In 2021, the World's Heath Organization (WHO) proposed a new guideline for PM2.5<sup>[2]</sup> with stricter thresholds than those of the US EPA:<ul><li><b>Annual average</b>: 5.0 \xb5g/m\xb3, corresponding to US AQI <b>21</b></li><li><b>24-hour average</b>: 15.0 \xb5g/m\xb3, corresponding to US AQI <b>56</b></li></ul>",h='[1] "National Ambient Air Quality Standards (NAAQS) for PM." EPA, Environmental Protection Agency, https://www.epa.gov/pm-pollution/national-ambient-air-quality-standards-naaqs-pm.<br>[2] World Health Organization. "WHO global air quality guidelines: particulate matter (PM2. 5 and PM10), ozone, nitrogen dioxide, sulfur dioxide and carbon monoxide: executive summary." (2021).',m=()=>{const{themePreference:e}=(0,a.useContext)(d.p);return(0,c.jsx)(s.Z,{title:u,content:(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(l.Z,{themePreference:e}),(0,c.jsx)(o.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{mt:2},children:(0,n.ZP)(p,{replace:i.T1})}),(0,c.jsx)(s.Z,{title:"Reference",content:(0,c.jsx)(o.Z,{variant:"caption",color:"text.secondary",children:(0,n.ZP)(h,{replace:i.T1})})})]})})}},80223:(e,t,r)=>{r.d(t,{Z:()=>y});var a=r(66934),o=r(79836),n=r(697),i=r(56890),l=r(35855),s=r(53994),d=r(53382),c=r(53540),u=r(69755),p=r(57120),h=r(44709),m=r(30604),g=r(72791),x=r(19132),v=r(80184);const b=(0,a.ZP)(o.Z)((e=>{let{theme:t,isTiny:r}=e;return{minWidth:r||700,"& th, td":{fontSize:r?"0.625rem":"0.6875rem",color:t.palette.text.secondary,[t.breakpoints.down("sm")]:{fontSize:r?"0.5rem":"0.6875rem"}},"& th":{fontWeight:500,color:t.palette.text.primary,lineHeight:"1rem"}}}));const y=function(e){const{themePreference:t}=(0,g.useContext)(x.p),{isTiny:r,hideAQIDescription:a}=e,o=(e,t)=>t===1/0?"".concat(e,"+"):"".concat(e," - ").concat(t);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(n.Z,{overflow:"auto",children:(0,v.jsxs)(b,{size:"small",isTiny:r,children:[(0,v.jsx)(i.Z,{children:(0,v.jsxs)(l.Z,{children:[(0,v.jsx)(s.Z,{sx:{pr:0},children:(0,v.jsx)(n.Z,{sx:{width:"1em",height:"1em"}})}),(0,v.jsx)(s.Z,{sx:{pl:1},children:"Category"}),(0,v.jsx)(s.Z,{align:"right",children:"US AQI"}),(0,v.jsxs)(s.Z,{align:"right",children:["PM2.5 Concentration (\xb5g/m",(0,v.jsx)("sup",{children:"3"}),")"]}),!a&&(0,v.jsx)(s.Z,{align:"left",children:"Description"}),!a&&(0,v.jsx)(s.Z,{align:"left",children:"CITIESair' Suggested Actions"})]})}),(0,v.jsx)(d.Z,{children:h.Z.map(((e,r)=>(0,v.jsxs)(l.Z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[(0,v.jsx)(s.Z,{sx:{pr:0},children:(0,v.jsx)(n.Z,{sx:{width:"1em",height:"1em",backgroundColor:t===m.Z.light?e.lightThemeColor:e.darkThemeColor}})}),(0,v.jsx)(s.Z,{sx:{pl:1},children:e.category}),(0,v.jsx)(s.Z,{align:"right",children:o(e.aqiUS.low,e.aqiUS.high)}),(0,v.jsx)(s.Z,{align:"right",children:o(e.rawPM2_5.low,e.rawPM2_5.high)}),!a&&(0,v.jsx)(s.Z,{align:"left",children:e.description}),!a&&(0,v.jsx)(s.Z,{align:"left",children:(0,c.ZP)(e.healthSuggestions.outdoors,{replace:u.T1})})]},r)))})]})}),(e=>{let{shouldRender:t}=e,r=null,a=[];if(t){const e=[["category"],["US AQI"]];for(let t=0;t<h.Z.length;t+=1){e[0].push(h.Z[t].category);let r=h.Z[t].aqiUS.high,o=h.Z[t].aqiUS.low;r===1/0&&(r=400),e[1].push(50*Math.ceil((r-h.Z[t].aqiUS.low)/50)),400===r&&(o={v:o,f:"".concat(o,"+")}),a.push(o)}r=(0,v.jsx)(p.Z,{chartHeight:"4rem",chartData:{dataArray:e,chartType:"BarChart",options:{enableInteractivity:!1,legend:{position:"none"},hAxis:{ticks:a},chartArea:{width:{portrait:"98%",landscape:"50%"},height:{portrait:"20%",landscape:"30%"}},isStacked:!0,colors:"aqi",bar:{groupWidth:"100%"}}}})}return r})({shouldRender:!a})]})}},7009:(e,t,r)=>{r.d(t,{Z:()=>y});var a=r(72791),o=r(66934),n=r(40911),i=r(55818),l=r(3721),s=r(697),d=r(20068),c=r(20890),u=r(26759),p=r(25878),h=r(47438),m=r(80184);const g=(0,o.ZP)(n.Z)((e=>{let{theme:t,expanded:r}=e;return{color:t.palette.text.secondary,backgroundImage:"none",backgroundColor:r?t.palette.background.default:"transparent",boxShadow:r?t.shadows:"none",transition:"none"}})),x=(0,o.ZP)(i.Z)((e=>{let{theme:t,expanded:r}=e;return{marginTop:r?t.spacing(2):0,flexDirection:"row-reverse",paddingLeft:r?t.spacing(1):0,"& .MuiTypography-root":{color:t.palette.text.primary,textDecoration:"underline",transition:"none","&:hover":{color:t.palette.primary.main}},"& .MuiAccordionSummary-content.Mui-expanded":{marginTop:t.spacing(2),marginBottom:t.spacing(2)}}})),v="Click to expand section",b="Click to collapse section",y=e=>{let{title:t,content:r}=e;const[o,n]=(0,a.useState)(void 0);return(0,m.jsx)(s.Z,{children:(0,m.jsxs)(g,{expanded:"panel1"===o,onChange:(i="panel1",(e,r)=>{n(r?i:void 0),h.y(r?h.z.expandSection:h.z.collapseSection,{section:t})}),transitionDuration:0,children:[(0,m.jsx)(x,{expanded:o,expandIcon:(0,m.jsx)(u.Z,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,m.jsx)(d.Z,{title:o?b:v,enterDelay:0,leaveDelay:200,children:(0,m.jsxs)(c.Z,{component:"a",variant:"body1",children:[t,(0,m.jsx)(p.Z,{sx:{fontSize:"1rem",marginLeft:"0.25rem"}})]})})}),(0,m.jsx)(l.Z,{children:r})]})});var i}},57120:(e,t,r)=>{r.d(t,{Z:()=>Re});var a=r(72791),o=r(66934),n=r(697),i=r(25228),l=r(5022),s=r(95193),d=r(36314),c=r(43896),u=r(65117),p=r(20890),h=r(47047),m=r(26935),g=r(78914),x=r(48206),v=r(83165),b=r(26084),y=r(19658),f=r(61889),w=r(13967),S=r(68096),D=r(99321),Z=r(94454),j=r(19055),A=r(9955),C=r(81918),k=r(3746),T=r(80184);const I="Display All Series",R=48,P=8;function E(e){const{items:t,selectorID:r,allowMultiple:o,seriesLabel:n,onSeriesSelection:i,displayChip:s=!0}=e,c=(0,w.Z)(),u={PaperProps:{style:{maxHeight:5.55*R+P,overflow:"visible !important",background:c.palette.customAlternateBackground}},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},getContentAnchorEl:null},[h,m]=(0,a.useState)(t),[g,x]=(0,a.useState)(o);(0,a.useEffect)((()=>{m(t)}),[t]),(0,a.useEffect)((()=>{x(h.every((e=>e.selected)))}),[h]);const v=e=>{const{target:{value:t}}=e;if(t.includes(I)){const e=h.map(((e,t)=>({...e,selected:0==t||!g})));i({newDataColumns:e}),x(!g)}else{const e=h.filter((e=>t.includes(e.label))),r=h.map((t=>({...t,selected:e.some((e=>e.label===t.label))})));i({newDataColumns:r}),x(!1)}},b=e=>{const t=h.map((t=>t.label===e.label?{...t,selected:!t.selected}:t));i({newDataColumns:t})};return(0,T.jsxs)(d.Z,{spacing:1,direction:"row",alignItems:"center",children:[(0,T.jsx)(S.Z,{sx:{[c.breakpoints.down("sm")]:{width:"100%"},minWidth:"200px","& .MuiInputBase-root":{borderRadius:"".concat(c.shape.borderRadius,"px")}},size:"small",children:(0,T.jsxs)(D.Z,{labelId:"".concat(r,"-label"),id:r,multiple:o,value:h.filter((e=>e.selected)).map((e=>e.label)),onChange:v,MenuProps:u,renderValue:e=>(e=>(0,T.jsxs)(d.Z,{direction:"row",alignItems:"center",spacing:.5,children:[(0,T.jsx)(k.Z,{fontSize:"1.5rem",sx:{color:c.palette.text.secondary}}),(0,T.jsx)(p.Z,{variant:"caption",color:"text.secondary",children:o?"".concat(e.length,"/").concat(h.length," ").concat(n||""," displayed"):e})]}))(e),sx:{fontSize:"0.75em"},children:[h.map((e=>(0,T.jsxs)(l.Z,{disabled:!(1!==h.filter((e=>e.selected)).length||!e.selected),value:e.label,sx:{backgroundColor:"unset !important","&:hover":{backgroundColor:"inherit !important"}},children:[o?(0,T.jsx)(Z.Z,{checked:e.selected,onClick:()=>b(e),sx:{p:.25,transform:"scale(0.8)"}}):(0,T.jsx)(j.Z,{checked:e.selected,onChange:()=>v(e),sx:{p:.25,transform:"scale(0.8)"}}),(0,T.jsx)(p.Z,{variant:"caption",children:e.label})]},e.label))),o&&(0,T.jsx)(l.Z,{value:I,sx:{borderTop:"solid 0.5px",borderColor:c.palette.text.secondary,position:"sticky",bottom:0,zIndex:99999,marginBottom:c.spacing(-1),background:c.palette.customAlternateBackground,"&:hover":{background:c.palette.customAlternateBackground}},children:(0,T.jsxs)(d.Z,{direction:"row",width:"100%",alignItems:"center",justifyContent:"space-between",children:[(0,T.jsx)(p.Z,{fontWeight:500,variant:"caption",sx:{pl:1},children:I}),(0,T.jsx)(A.Z,{checked:g,onClick:()=>b(I),sx:{transform:"scale(0.8)"}})]})},I)]})}),s&&o&&(0,T.jsx)(f.ZP,{container:!0,spacing:1,sx:{[c.breakpoints.down("sm")]:{display:"none"}},children:h.filter((e=>e.selected)).map((e=>(0,T.jsx)(f.ZP,{item:!0,children:(0,T.jsx)(C.Z,{label:(0,T.jsx)(p.Z,{variant:"caption",children:e.label}),size:"small",...1!==h.filter((e=>e.selected)).length&&{onDelete:()=>b(e)}})},e.label)))})]})}const z={CategoryFilter:{position:"top",stackDirection:"column"},DateRangeFilter:{position:"bottom",stackDirection:"column-reverse"},ChartRangeFilter:{position:"bottom",stackDirection:"column-reverse"},NumberRangeFilter:{position:"top",stackDirection:"column"}},M=e=>({min:e.reduce(((e,t)=>t<e?t:e)),max:e.reduce(((e,t)=>t>e?t:e))}),W=e=>({min:Math.min(...e),max:Math.max(...e)}),O=()=>Math.random().toString(36).substr(2,9),B={stem:{length:0},textStyle:{opacity:0},boxStyle:null},L=e=>{let{isPortrait:t,isSmaller:r}=e;return r?t?6:8:t?8:10},H=e=>{var t,r,a,o,n,i,l,s,d,c,u,p,h,m,g,x,v,b,y,f,w,S,D,Z,j,A,C,k,T,I,R,P,E,z,M,W,O,H,F,N,V,q,U,Y,_,Q,G;const{chartData:X,subchartIndex:$,isPortrait:J,isHomepage:K,theme:ee}=e,te={italic:!1,bold:!0,color:ee.palette.chart.axisTitle,fontSize:L({isPortrait:J})},re={color:ee.palette.chart.axisText,fontSize:L({isPortrait:J})};let ae=null!==(t=X.subcharts)&&void 0!==t&&t[$].options?{...X.subcharts[$].options}:{};if(ae={...ae,...X.options,theme:"material",curveType:ae.curveType||(null===(r=X.options)||void 0===r?void 0:r.curveType)||"function",crosshair:{orientation:"both",trigger:"focus",opacity:.5},backgroundColor:{fill:"transparent"},chartArea:{...null===(a=X.options)||void 0===a?void 0:a.chartArea,width:J?(null===(o=X.options)||void 0===o||null===(n=o.chartArea)||void 0===n||null===(i=n.width)||void 0===i?void 0:i.portrait)||"80%":(null===(l=X.options)||void 0===l||null===(s=l.chartArea)||void 0===s||null===(d=s.width)||void 0===d?void 0:d.landscape)||"75%",height:J?(null===(c=X.options)||void 0===c||null===(u=c.chartArea)||void 0===u||null===(p=u.height)||void 0===p?void 0:p.portrait)||"60%":(null===(h=X.options)||void 0===h||null===(m=h.chartArea)||void 0===m||null===(g=m.height)||void 0===g?void 0:g.landscape)||"70%"},width:J?(null===(x=X.options)||void 0===x||null===(v=x.width)||void 0===v?void 0:v.portrait)||"100%":(null===(b=X.options)||void 0===b||null===(y=b.width)||void 0===y?void 0:y.landscape)||"100%",height:X.height||"100%",tooltip:{isHtml:!0,showColorCode:!1},legend:{alignment:J?"center":"start",position:null!==(f=null===(w=X.options)||void 0===w||null===(S=w.legend)||void 0===S?void 0:S.position)&&void 0!==f?f:J?"top":"right",scrollArrows:{activeColor:ee.palette.chart.axisTitle,inactiveColor:ee.palette.text.secondary},pagingTextStyle:{fontSize:10,color:ee.palette.chart.axisTitle,bold:!0}}},ae.vAxis={...ae.vAxis,format:null!==(D=null===(Z=ae.vAxis)||void 0===Z?void 0:Z.format)&&void 0!==D?D:"decimal",title:null!==(j=null===(A=ae.vAxis)||void 0===A?void 0:A.title)&&void 0!==j?j:"",viewWindow:{min:null!==(C=null===(k=ae.vAxis)||void 0===k||null===(T=k.viewWindow)||void 0===T?void 0:T.min)&&void 0!==C?C:0,max:null!==(I=null===(R=ae.vAxis)||void 0===R||null===(P=R.viewWindow)||void 0===P?void 0:P.max)&&void 0!==I?I:null,max:null!==(E=null===(z=ae.vAxis)||void 0===z||null===(M=z.viewWindow)||void 0===M?void 0:M.max)&&void 0!==E?E:null}},ae.hAxis={...ae.hAxis,title:null!==(W=null===(O=ae.hAxis)||void 0===O?void 0:O.title)&&void 0!==W?W:""},J&&(ae.hAxis={...ae.hAxis,slantedText:!0,slantedTextAngle:30}),"string"!==typeof ae.colors&&ae.colors||(ae.colors=ee.palette.chart.optionsColors[ae.colors||"multiColor"]),ae.series&&Object.values(ae.series).forEach((e=>{const t=e;"default"===t.color&&(t.color=ee.palette.primary.main)})),ae.trendlines&&ae.trendlines.forEach((e=>{e.color=ee.palette.primary.main})),ae.colorAxis)switch(ae.colorAxis.colors){case"matchingColor":ae.colorAxis.colors=[ee.palette.chart.colorAxisFirstColor,ee.palette.chart.optionsColors.multiColor[ae.colorAxis.colorIndex]];break;case"default":ae.colorAxis.colors=[ee.palette.chart.colorAxisFirstColor,ee.palette.NYUpurple];break;default:try{ae.colorAxis=ee.palette.chart.colorAxes[ae.colorAxis.colors]}catch{ae.colorAxis=[]}}return ae.vAxis={...ae.vAxis,titleTextStyle:te,textStyle:re,gridlines:{...null===(H=ae.vAxis)||void 0===H?void 0:H.gridlines,color:(null===(F=ae.vAxis)||void 0===F||null===(N=F.gridlines)||void 0===N?void 0:N.color)||ee.palette.chart.gridlines},minorGridlines:{count:0}},ae.hAxis={...ae.hAxis,titleTextStyle:te,textStyle:re,gridlines:{...null===(V=ae.hAxis)||void 0===V?void 0:V.gridlines,color:(null===(q=ae.hAxis)||void 0===q||null===(U=q.gridlines)||void 0===U?void 0:U.color)||ee.palette.chart.gridlines},minorGridlines:{...null===(Y=ae.hAxis)||void 0===Y?void 0:Y.minorGridlines,color:(null===(_=ae.hAxis)||void 0===_||null===(Q=_.gridlines)||void 0===Q?void 0:Q.color)||ee.palette.chart.gridlines}},ae.legend={...ae.legend,textStyle:re},ae.annotations={...ae.annotations,highContrast:!0,textStyle:{color:ee.palette.primary.contrastText,fontSize:L({isPortrait:J,isSmaller:!0}),opacity:.8},stem:{...null===(G=ae.annotations)||void 0===G?void 0:G.stem,color:ee.palette.chart.axisTitle,thickness:2},boxStyle:{rx:ee.shape.borderRadius,ry:ee.shape.borderRadius,fill:ee.palette.chart.annotationBoxFill,fillOpacity:.5}},K&&(ae={...ae,chartArea:{...ae.chartArea,width:"80%",height:"80%"},seriesSelector:!1,pointSize:0,enableInteractivity:!1,annotations:B,legend:"none",vAxis:{...ae.vAxis,textPosition:"none",titleTextStyle:{...ae.vAxis.titleTextStyle,bold:!1},gridlines:{color:"transparent",count:0},viewWindowMode:"maximized"},hAxis:{...ae.hAxis,textPosition:"none",gridlines:{color:"transparent",count:0},titleTextStyle:{...ae.hAxis.titleTextStyle,bold:!1}}}),ae},F=e=>{const t=V({cellSizeMin:14,cellSizeMax:18});return{...e,width:t.chartWidth,calendar:{cellSize:t.cellSize,yearLabel:{fontSize:t.yearLabelFontSize}},noDataPattern:{backgroundColor:"none",color:"none"}}},N=e=>{var t;const{chartControl:r,mainChartData:a,mainChartOptions:o,subchartIndex:n,theme:i,isPortrait:l}=e;let s={...null===(t=r.options)||void 0===t?void 0:t.ui,snapToData:!0};return"ChartRangeFilter"===r.controlType&&(s={...s,chartType:a.chartType,chartView:{columns:a.columns||a.subcharts&&a.subcharts[n].columns||null},chartOptions:{...o,hAxis:{...o.hAxis,textPosition:"out",textStyle:{color:i.palette.chart.axisText,fontSize:L({isPortrait:l,isSmaller:!0})},title:null},vAxis:{...o.vAxis,title:null},annotations:B,legend:null}}),s},V=e=>{let{cellSizeMin:t,cellSizeMax:r}=e;const a=Math.min(Math.max(.9*window.innerWidth/58,t),r);return{chartWidth:56*a,cellSize:a,yearLabelFontSize:2*a}},q=e=>{let{controlWrapper:t,chartID:r}=e;const a=e=>{var t=e.changedTouches[0],r="";switch(e.type){case"touchstart":r="mousedown";break;case"touchmove":r="mousemove";break;case"touchend":r="mouseup";break;default:return}var a=new MouseEvent(r,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,button:0,relatedTarget:null});t.target.dispatchEvent(a),e.preventDefault()};let o=!0;if(!t)return;const n=document.querySelector("#control-".concat(r));return n?(["touchstart","touchmove","touchend","touchcancel"].forEach((e=>{n.addEventListener(e,a,{capture:!0})})),()=>{o=!1,["touchstart","touchmove","touchend","touchcancel"].forEach((e=>{n.removeEventListener(e,a,{capture:!0})}))}):void 0},U=(0,o.ZP)(n.Z)((e=>{let{theme:t,isPortrait:r}=e;return{"& .google-visualization-tooltip, .nivo-tooltip":{width:"unset !important",maxWidth:"350px",height:"unset",padding:"1em",boxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",mozBoxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",webkitBoxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",border:"solid 1px",borderColor:t.palette.text.secondaryRGB,fontSize:"".concat(r?9:12,"px"),color:t.palette.chart.tooltip.text,background:t.palette.chart.tooltip.background,borderRadius:t.shape.borderRadius,"& ul":{margin:"0 !important","& li":{margin:"0 !important",padding:"0 !important","& span":{fontSize:"".concat(r?9:12,"px !important"),color:"".concat(t.palette.chart.tooltip.text," !important")}}}},"& .goog-menuitem-highlight, .goog-menuitem-hover":{backgroundColor:"".concat(t.palette.primary," !important")},"& .google-visualization-controls-categoryfilter":{fontSize:"0.85rem",marginTop:"0.75rem",marginBottom:"-0.75rem","& .goog-inline-block > .goog-menu-button":{marginTop:0},"& .goog-menu-button-hover .goog-menu-button-outer-box, .goog-menu-button-hover .goog-menu-button-inner-box":{borderColor:"inherit !important"},"& .google-visualization-controls-label":{color:t.palette.text.secondary,fontWeight:500,verticalAlign:"middle",marginBottom:"0.25rem"},"& .goog-menu-button-outer-box":{backgroundColor:t.palette.background.paper,border:"unset","& .goog-menu-button-inner-box":{paddingTop:t.spacing(.5),paddingBottom:t.spacing(.5),paddingLeft:t.spacing(2),paddingRight:t.spacing(2),border:"solid",borderWidth:"0.5px",borderRadius:t.shape.borderRadius,borderColor:t.palette.text.secondary,"& .goog-menu-button-caption":{color:t.palette.text.secondary}}}},"& .google-visualization-controls-rangefilter":{width:"100%",fontSize:"0.75rem","& .goog-inline-block":{width:"100%"},"& .google-visualization-controls-slider-horizontal":{width:"90%",margin:"0 5%"},"& .google-visualization-controls-rangefilter-thumblabel:nth-of-type(1)":{position:"absolute",top:"1.5em",left:"5%"},"& .google-visualization-controls-rangefilter-thumblabel:nth-of-type(2)":{position:"absolute",top:"1.5em",right:"5%"},"& .google-visualization-controls-slider-handle":{background:t.palette.primary.main},"& .google-visualization-controls-rangefilter-thumblabel":{color:t.palette.text.secondary,padding:0,fontWeight:500},"& .google-visualization-controls-slider-thumb":{background:t.palette.primary.main,border:"unset",borderRadius:t.shape.borderRadius}},'& path[stroke-opacity="0.3"], path[stroke-opacity="0.1"], path[stroke-opacity="0.05"], rect[stroke-opacity]':{stroke:t.palette.text.primary,strokeWidth:3},"& [column-id]:not(:empty)":{cursor:"pointer",":hover":{fontWeight:600}}}}));var Y=r(6694),_=r(18970),Q=r(53540),G=r(69755);const X=40,$=e=>e?{top:20,right:0,bottom:0,left:20}:{top:30,right:40,bottom:0,left:40},J=e=>{var t,r,a,o,n,i;const{data:l,dateRange:s,valueRange:d,isPortrait:c,options:u}=e,p=$(c),h=(0,w.Z)(),m=(e,t)=>{const r=new Date(e),a=r.getDay(),o=0===a||1===a,n=new Date(t.min).getFullYear(),i=r.getFullYear()===n;return o&&i},g=null!==u&&void 0!==u&&null!==(t=u.colorAxis)&&void 0!==t&&t.isGradient?te(null===u||void 0===u||null===(r=u.colorAxis)||void 0===r?void 0:r.colors,100):null===u||void 0===u||null===(a=u.colorAxis)||void 0===a?void 0:a.colors,x=()=>(0,T.jsx)(ee,{valueRange:d,colorAxis:null===u||void 0===u?void 0:u.colorAxis,isPortrait:c});return(0,T.jsxs)(T.Fragment,{children:["none"!==(null===u||void 0===u||null===(o=u.legend)||void 0===o?void 0:o.position)&&x(),x(),(0,T.jsx)(_.DQ,{data:l,from:null===s||void 0===s?void 0:s.min,to:null===s||void 0===s?void 0:s.max,emptyColor:"transparent",theme:{text:{fill:h.palette.text.secondary},fontSize:"0.75rem",tooltip:{container:{background:"dark"===h.palette.mode?"#2b2b2b":"#fff",color:h.palette.text.primary}},axis:{ticks:{line:{stroke:"dark"===h.palette.mode?"#2b2b2b":"#fff"},text:{fill:h.palette.text.primary}}},grid:{line:{stroke:"dark"===h.palette.mode?"#2b2b2b":"#fff"}}},colors:g,minValue:null===u||void 0===u||null===(n=u.colorAxis)||void 0===n?void 0:n.minValue,maxValue:null===u||void 0===u||null===(i=u.colorAxis)||void 0===i?void 0:i.maxValue,margin:p,yearSpacing:X,monthBorderColor:h.palette.text.primary,monthBorderWidth:1,daySpacing:.25,dayBorderWidth:0,tooltip:e=>{let{day:t,value:r,color:a}=e;const o=l.find((e=>e.day===t)),n=o?(i=o.tooltip,(new DOMParser).parseFromString(i,"text/html").body.innerHTML):"";var i;return(0,T.jsx)(K,{day:t,color:a,tooltipText:n,dateRange:s,inFirstTwoRowsOfChart:m})}})]})},K=e=>{let{day:t,color:r,tooltipText:o,dateRange:i,inFirstTwoRowsOfChart:l}=e;const s=(0,a.useRef)(null);return(0,a.useEffect)((()=>{if(s.current&&l(t,i)){const e=s.current.parentElement;e&&(e.style.top="11vh")}}),[s,l]),(0,T.jsxs)(n.Z,{ref:s,className:"nivo-tooltip",children:[(0,T.jsx)(C.Z,{sx:{backgroundColor:r,mr:.5,height:"10px",width:"10px",borderRadius:"50%"}}),(0,Q.ZP)(o,{replace:G.T1})]})},ee=e=>{let{valueRange:t,colorAxis:r,isPortrait:a}=e;if(null===(null===t||void 0===t?void 0:t.min)||null===(null===t||void 0===t?void 0:t.max))return null;const{colors:o,isGradient:i,minValue:l,maxValue:s}=r,d=(0,w.Z)(),c=(()=>{if(i){if("string"===typeof o[0])return"linear-gradient(to right, ".concat(o.map(((e,t,r)=>{const a=t/(r.length-1)*100;return"".concat(e," ").concat(a,"%")})).join(", "),")");{const e=o.map((e=>e.stop)),t=Math.min(...e),r=Math.max(...e),a=o.map((e=>({color:e.color,stop:(e.stop-t)/(r-t)*100})));return"linear-gradient(to right, ".concat(a.map((e=>"".concat(e.color," ").concat(e.stop,"%"))).join(", "),")")}}return o.map((e=>e.color||e)).join(", ")})(),u=e=>"".concat((e-l)/(s-l)*100,"%"),p={position:"sticky",width:"fit-content",marginTop:"1.5rem",float:"right",right:a?"0":"5%"},h={background:i?c:void 0,color:d.palette.text.secondary,border:"1px solid ".concat(d.palette.text.secondary),width:"300px",height:"1rem",position:"relative",display:i?"block":"flex",justifyContent:"space-between"},m={flex:1,height:"100%"},g={position:"absolute",fontSize:"0.75rem",color:d.palette.text.secondary},x={position:"absolute",width:0,height:0,borderLeft:"0.25rem solid transparent",borderRight:"0.25rem solid transparent",transform:"translateX(-50%)"},v={top:"-0.5rem",borderTop:"0.25rem solid ".concat(d.palette.text.secondary)},b={bottom:"-0.5rem",borderBottom:"0.25rem solid ".concat(d.palette.text.secondary)};return(0,T.jsx)(n.Z,{style:p,children:(0,T.jsxs)(n.Z,{style:h,children:[i?null:o.map(((e,t)=>(0,T.jsx)(n.Z,{style:{...m,backgroundColor:e.color||e}},t))),(0,T.jsxs)("span",{style:{...g,top:"-1.5rem",transform:"translateX(-100%)",left:u(t.min)},children:["min: ",t.min]}),(0,T.jsxs)("span",{style:{...g,bottom:"-1.5rem",left:u(t.max)},children:["max: ",t.max]}),(0,T.jsx)("div",{style:{...x,...v,left:u(t.min)}}),(0,T.jsx)("div",{style:{...x,...b,left:u(t.max)}})]})})},te=(e,t)=>{function r(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,r,a){return t+t+r+r+a+a}));const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[null,null,null]}function a(e,t,r){return"#"+[e,t,r].map((e=>{const t=e.toString(16);return 1===t.length?"0"+t:t})).join("")}function o(e,t,r){let a=e.slice();for(let o=0;o<3;o++)a[o]=Math.round(a[o]+r*(t[o]-e[o]));return a}let n;if("string"===typeof e[0]){const t=e.length;n=e.map(((e,a)=>({color:r(e),stop:a/(t-1)})))}else{let t=e.map((e=>e.stop));t=function(e){const t=Math.min(...e),r=Math.max(...e);return e.map((e=>(e-t)/(r-t)))}(t),n=e.map(((e,a)=>({color:r(e.color),stop:t[a]})))}let i=[],l=Array.from({length:t},((e,r)=>r/(t-1)));for(let s=0;s<l.length;s++){let e,t,r,d,c=l[s];for(let a=0;a<n.length-1;a++)if(c>=n[a].stop&&c<=n[a+1].stop){e=n[a].color,t=n[a+1].color,r=n[a].stop,d=n[a+1].stop;break}let u=o(e,t,(c-r)/(d-r));i.push(a(...u))}return i};var re=r(7161),ae=(r(42978),r(666),r(13239)),oe=r(94294),ne=r(35527),ie=r(42755),le=r(3874),se=r(4531),de=r(62573);const ce=e=>{let{today:t,minDateOfDataset:r,aggregationType:a}=e;const o=[{label:"Last 14d",range:()=>({startDate:(0,ie.b)((0,le.E)(t,-14)),endDate:(0,se.i)(t)})},{label:"Last 30d",range:()=>({startDate:(0,ie.b)((0,le.E)(t,-30)),endDate:(0,se.i)(t)})}],n=[{label:"Last 90d",range:()=>({startDate:(0,ie.b)((0,le.E)(t,-90)),endDate:(0,se.i)(t)})},{label:"Last 365d",range:()=>({startDate:(0,ie.b)((0,le.E)(t,-365)),endDate:(0,se.i)(t)})},{label:"All Time",range:()=>({startDate:r,endDate:(0,se.i)(t)})}];return a===de.Z.hourly?o:[...o,...n]},ue=(0,o.ZP)(ne.Z)((e=>{let{theme:t,showPickerPanel:r,smallScreen:a}=e;return{zIndex:!0===r&&1e3,position:"relative",padding:r?t.spacing(1):0,margin:r&&!a?t.spacing(-1):0,maxWidth:"100%",background:r?t.palette.customAlternateBackground:"transparent",boxShadow:!1===r&&"none","& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary},"& .rdrDateDisplayWrapper, .rdrCalendarWrapper, .rdrDefinedRangesWrapper, .rdrStaticRange, .rdrDateDisplayItem":{background:"transparent"},"& .rdrDateInput":{borderRadius:t.shape.borderRadius,boxShadow:"none"},"& .rdrDateDisplayItemActive":{border:!1===r&&"none"},"& .rdrDateDisplay":{margin:0,minWidth:"20rem"},"& .rdrDateDisplayItem":{margin:0,borderRadius:r?t.shape.borderRadius:0,"&:hover:not(.rdrDateDisplayItemActive)":{border:r?"1px solid ".concat(t.palette.action.disabled):"none"}},"& .rdrDateDisplayItem:hover:not(.rdrDateDisplayItemActive)":{border:!1===r&&"1px solid transparent"},"& .rdrDateDisplayItem + .rdrDateDisplayItem":{margin:0},"& .rdrDateDisplayItem:first-of-type":{borderRight:!1===r&&"1px solid ".concat(t.palette.action.disabled," !important")},"& .rdrMonthAndYearWrapper, .rdrInputRanges":{display:!1===r&&"none !important",padding:0},"& .rdrMonthName":{display:"none"},"& .rdrDefinedRangesWrapper, .rdrMonths":{display:!1===r&&"none"},"&  .rdrInfiniteMonths":{visibility:!1===r&&"hidden",width:"100% !important",maxWidth:"675px",margin:"auto"},"& .rdrDateDisplayWrapper":{minWidth:"18rem",borderRadius:t.shape.borderRadius,border:r?"none":"1px solid ".concat(t.palette.action.disabled),"&:hover":{border:r?"none":"1px solid ".concat(t.palette.text.primary)}},"& .rdrDateRangePickerWrapper":{width:"100%",flexDirection:"column-reverse"},"& .rdrStaticRanges":{flexDirection:"row",minWidth:"21rem"},"& .rdrStaticRangeLabel":{color:t.palette.text.secondary,borderRadius:t.shape.borderRadius,padding:"".concat(t.spacing(.5)," ").concat(t.spacing(1))},"& .rdrDefinedRangesWrapper":{border:"none",width:"100%"},"& .rdrNextPrevButton":{background:t.palette.primary.main,borderRadius:t.shape.borderRadius,opacity:1,"&:hover":{opacity:.5,background:t.palette.primary.main}},"& .rdrNextPrevButton > i":{color:"white"},"& .rdrNextButton > i":{borderColor:"transparent transparent transparent white"},"& .rdrPprevButton > i":{borderColor:"transparent white transparent transparent"},"& .rdrStaticRange":{border:"none"},"& .rdrStaticRangeSelected > .rdrStaticRangeLabel, .rdrMonthAndYearPickers":{color:t.palette.primary.main},"& .rdrMonthAndYearPickers":{fontSize:"1rem"},"& .rdrStaticRange:hover .rdrStaticRangeLabel, .rdrStaticRange:focus .rdrStaticRangeLabel":{background:t.palette.customBackground.toString()},"& .rdrDayNumber span":{color:t.palette.text.primary.toString()},"& .rdrDayPassive .rdrDayNumber span":{opacity:.5},"& .rdrMonthAndYearWrapper select":{color:t.palette.text.secondary.toString(),background:"none",padding:"".concat(t.spacing(1)," ").concat(t.spacing(2)),"&:hover":{border:"1px solid ".concat(t.palette.text.secondary)}},"& .rdrDateDisplayItem input":{color:t.palette.text.secondary},"& .rdrDayDisabled":{backgroundColor:t.palette.customBackground},"& .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfMonth .rdrStartEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge, .rdrEndEdge, .rdrDayEndOfMonth .rdrDayInPreview, .rdrDayEndOfMonth .rdrDayStartPreview, .rdrDayEndOfWeek .rdrDayInPreview, .rdrDayEndOfWeek .rdrDayStartPreview, .rdrDayEndPreview":{borderTopRightRadius:"2rem",borderBottomRightRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfWeek .rdrEndEdge, .rdrDayStartOfMonth .rdrDayInPreview, .rdrDayStartOfMonth .rdrDayEndPreview, .rdrDayStartOfWeek .rdrDayInPreview, .rdrDayStartOfWeek .rdrDayEndPreview, .rdrDayStartPreview":{borderTopLeftRadius:"2rem",borderBottomLeftRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrEndEdge":{left:0},"& .rdrEndEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge":{right:0},"& .rdrSelected, .rdrInRange, .rdrStartEdge, .rdrEndEdge":{top:"0px",bottom:"0px"},"& .rdrMonths":{justifyContent:"center",alignItems:"center"},"& .rdrDay":{marginBottom:"1px","& span":{top:"0px",bottom:"0px"}},"& .rdrMonthsHorizontal":{overflowY:"hidden"},"& .rdrDateInput:first-of-type:before":{content:'""',backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' class='MuiSvgIcon-root' focusable='false' aria-hidden='true' viewBox='0 0 24 24' data-testid='DateRangeIcon'%3E%3Cpath d='M9 11H7v2h2zm4 0h-2v2h2zm4 0h-2v2h2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V9h14z' fill='".concat(t.palette.text.secondary,"'/%3E%3C/svg%3E\")"),width:"0.75rem",height:"0.75rem",display:"block",position:"absolute",top:"50%",transform:"translateY(-50%)",left:"0.75rem"},"& .rdrStaticRangeSelected span":{color:t.palette.primary.main},"& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary.main,width:"0.25rem",height:"0.25rem",borderRadius:"50%"}}}));var pe=r(77997),he=r(40630);function me(e){let{aggregationType:t,setAggregationType:r,smallScreen:a}=e;return(0,T.jsxs)(d.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,T.jsx)(p.Z,{variant:"caption",display:"block",color:"text.secondary",children:"DATA AVERAGE"}),(0,T.jsxs)(pe.Z,{color:"primary",value:t,exclusive:!0,onChange:(e,t)=>{null!==t&&r(t)},"aria-label":"aggregation type toggle for graph average",size:"small",children:[(0,T.jsx)(he.Z,{size:"small",sx:{textTransform:"capitalize !important",px:1.25,py:.5},value:de.Z.hourly,"aria-label":de.Z.hourly,children:de.Z.hourly}),(0,T.jsx)(he.Z,{size:"small",sx:{textTransform:"capitalize !important",px:1.25,py:.5},value:de.Z.daily,"aria-label":de.Z.daily,children:de.Z.daily})]})]})}var ge=r(2165),xe=r(33026),ve=r(87210);const be="HOURLY data is limited to max 30d",ye="Start and end dates must be different",fe=e=>(0,T.jsx)(y.Z,{severity:"error",sx:{py:.5,px:1,display:"flex",alignItems:"center","& div":{fontSize:"0.75rem",p:0},"& .MuiAlert-icon":{fontSize:"1rem",mr:.5}},children:e}),we=e=>{const{minDateOfDataset:t}=e,{currentSchoolID:r,setIndividualChartData:o}=(0,a.useContext)(v.G),[n,i]=(0,a.useState)(de.Z.hourly),l=new Date,[c,u]=(0,a.useState)(),p=(0,w.Z)(),h=(0,s.Z)(p.breakpoints.down("sm")),[m,b]=(0,a.useState)([{...ce({today:l,minDateOfDataset:t})[0].range(),key:"selection"}]),[y,f]=(0,a.useState)(),[S,D]=(0,a.useState)(!1),Z=(0,a.useRef)(null),[j,A]=(0,a.useState)(!1);(0,a.useEffect)((()=>{const e=e=>{Z.current&&!Z.current.contains(e.target)&&D(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[Z]);const C=e=>{const{startDate:t,endDate:r}=e;if((0,ge.K)(t,r))u(ye);else if(u(null),n===de.Z.hourly){const e=(0,xe.j)(r,t);u(e>30?be:null)}else null!==c&&u(null)};(0,a.useEffect)((()=>{C(m[0])}),[n]);return(0,T.jsx)(ue,{showPickerPanel:S,smallScreen:h,ref:Z,elevation:8,onClick:()=>D(!0),children:(0,T.jsxs)(d.Z,{direction:"column",spacing:1,children:[(0,T.jsx)(re.Dw,{ranges:m,onChange:e=>{e&&(C(e.selection),b([e.selection]))},staticRanges:(0,re.$z)(ce({today:l,minDateOfDataset:t,aggregationType:n})),inputRanges:[],rangeColors:[p.palette.primary.main,p.palette.secondary.main,p.palette.text.secondary],minDate:t,maxDate:l,months:1,showMonthAndYearPickers:!1,direction:"horizontal",fixedHeight:!0,preventSnapRefocus:!0,calendarFocus:"backwards",startDatePlaceholder:"Start Date",endDatePlaceholder:"End Date",editableDateInputs:!0,showMonthArrow:!0}),S&&(0,T.jsxs)(d.Z,{direction:"column",alignItems:"end",width:"100%",spacing:1,children:[(0,T.jsx)(me,{aggregationType:n,setAggregationType:i,smallScreen:h}),(0,T.jsxs)(d.Z,{direction:"row",spacing:1,children:[c&&fe(c),(0,T.jsx)(oe.Z,{variant:"contained",size:"small",disabled:null!==c,onClick:e=>{if(null!==c)return;e.stopPropagation();const t=(0,x.kq)({endpoint:x.ZU.historical,school_id:r,aggregationType:n,startDate:(0,ve.WU)(m[0].startDate,"yyyy-MM-dd"),endDate:(0,ve.WU)(m[0].endDate,"yyyy-MM-dd")});t!==y&&(A(!0),(0,g.m)({url:t,extension:"json",needsAuthorization:!0}).then((e=>{o(0,e),f(t),A(!1),D(!1)})).catch((e=>{console.log(e)})))},sx:{zIndex:1005,transform:"translateY(-1px)"},children:j?(0,T.jsx)(ae.Z,{disableShrink:!0,size:"1.4375rem",color:"inherit"}):"APPLY"})]})]})]})})},Se=e=>{let{dataType:t}=e;return(0,T.jsxs)(y.Z,{severity:"error",sx:{my:2},children:["This sensor does not have\xa0",(0,T.jsx)(n.Z,{component:"span",textTransform:"capitalize",children:t}),"\xa0data"]})};function De(e){var t;const{chartData:r,subchartIndex:o,windowSize:i,isPortrait:l,isHomepage:s,height:c,maxHeight:u,selectedDataType:p}=e,h=r.customClassName?"".concat(r.chartType," ").concat(r.customClassName):r.chartType,m=(0,a.useContext)(b.R),[g,x]=(0,a.useState)(),[v,y]=(0,a.useState)(),[S,D]=(0,a.useState)(),[Z,j]=(0,a.useState)(),[A,C]=(0,a.useState)(),k=(0,w.Z)(),[I,R]=(0,a.useState)(!0),[P,B]=(0,a.useState)(!0),[L,V]=(0,a.useState)(),[_,Q]=(0,a.useState)(),[K,ee]=(0,a.useState)(),[te,re]=(0,a.useState)(O()),[ae,oe]=(0,a.useState)(200);let ne=(0,a.useMemo)((()=>{let t=H({...e,theme:k});return"Calendar"===r.chartType&&(t=F(t)),t}),[e,k,r.chartType]);const[ie,le]=(0,a.useState)(null),[se,de]=(0,a.useState)(200),[ce,ue]=(0,a.useState)(1200);if("Calendar"===r.chartType)return(0,a.useEffect)((()=>{const e=r.dataArray||r.subcharts&&r.subcharts[o].dataArray||null;if(!(0,G.qt)(e))return void B(!1);const t=e.map((e=>e.day)),a=e.map((e=>e.value)),n=M(t);le({data:e,dateRange:n,valueRange:W(a)});const i=new Date(n.min).getFullYear(),s=new Date(n.max).getFullYear()-i+1,d=7*Math.min(ce/60,20),c=$(l);let u;u=1==s?d+X+c.top+c.bottom:s*(d+X)+c.top+c.bottom,de(u),B(!0)}),[r]),P?(0,T.jsx)(U,{isPortrait:l,className:h,style:{position:"relative",minWidth:"700px",minHeight:l?"200px":"".concat(se,"px"),height:"".concat(se,"px"),maxHeight:l?"550px":"none"},children:ie?(0,T.jsx)(J,{data:ie.data,dateRange:ie.dateRange,valueRange:ie.valueRange,isPortrait:l,options:ne}):(0,T.jsx)(n.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,T.jsx)(Y.Z,{})})}):(0,T.jsx)(Se,{dataType:p});let pe,he=!1,me=r.control||(null===(t=r.subcharts)||void 0===t?void 0:t[o].control);me&&!0!==s&&(he=!0,pe={...me.options,ui:N({chartControl:me,mainChartData:r,mainChartOptions:ne,subchartIndex:o,theme:k,isPortrait:l})},"ChartRangeFilter"===me.controlType&&(0,a.useEffect)((()=>q({controlWrapper:Z,chartID:te})),[Z]));const ge=ne.seriesSelector||!1,xe=ne.dateRangePicker||null;(0,a.useEffect)((()=>{ge?ye({newDataColumns:_}):(null===v||void 0===v||v.setOptions({...ne,..."Calendar"===r.chartType&&{height:ae}}),null===v||void 0===v||v.draw(),he&&(null===Z||void 0===Z||Z.setOptions(pe),null===Z||void 0===Z||Z.draw()))}),[k,l,i,ae]),(0,a.useEffect)((()=>{_&&ge&&"setViewColumn"==ge.method&&(ve({dataColumns:_}),ye({newDataColumns:_}))}),[k]);const ve=e=>{let{dataColumns:t}=e;t.forEach((e=>{var t;e.color=ne.colors[e.seriesIndex%ne.colors.length],e.serieAttribute=null===(t=ne.series)||void 0===t?void 0:t[e.seriesIndex]}))},be=e=>{let t,r,{dataTable:a,allInitialColumns:o}=e;return o.forEach(((e,o)=>{if(0===o)return;const n=a.getColumnRange(e.sourceColumn);!isNaN(n.min)&&n.min&&(t=t?Math.min(t,n.min):n.min),!isNaN(n.max)&&n.max&&(r=r?Math.max(r,n.max):n.max)})),{min:t,max:r}},ye=e=>{let{newDataColumns:t,_allInitialColumns:r=L,_chartWrapper:a=v,_controlWrapper:o=Z}=e;if(r){if(Q(t),"toggleVisibility"===ge.method||null===ge.method){const e={};if(t.forEach((t=>{t.selected||(e[t.seriesIndex]={color:"transparent",enableInteractivity:!1,visibleInLegend:!1})})),null===a||void 0===a||a.setOptions({...ne,series:{...ne.series,...e}}),he){const t=null===o||void 0===o?void 0:o.getOptions();null===o||void 0===o||o.setOptions({...t,ui:{...t.ui,chartOptions:{...t.ui.chartOptions,series:{...ne.series,...e}}}})}}else if("setViewColumn"===ge.method){let e=[];e.push(0),t.forEach((t=>{if(t.selected){e.push(t);for(let a=t.indexIn_+1;a<r.length&&"data"!==r[a].role;a++)e.push(r[a])}})),null===a||void 0===a||a.setView({columns:e});const n={...ne};n.colors=t.filter((e=>e.selected)).map((e=>e.color));const i={};let l=0;if(t.forEach((e=>{e.selected&&(null!=e.serieAttribute&&(i[l]=e.serieAttribute),l++)})),n.series=i,null===a||void 0===a||a.setOptions(n),he){const t=null===o||void 0===o?void 0:o.getOptions();null===o||void 0===o||o.setOptions({...t,ui:{...t.ui,chartOptions:{...t.ui.chartOptions,colors:n.colors,series:n.series},chartView:{columns:e}}})}}null===a||void 0===a||a.draw(),he&&(null===o||void 0===o||o.draw())}};(0,a.useEffect)((()=>{if(m&&r){if(JSON.stringify(r)===JSON.stringify(A))return;C(r);const e=r.dataArray||r.subcharts&&r.subcharts[o].dataArray||null;if(!(0,G.qt)(e))return void B(!1);const t=m.visualization.arrayToDataTable(e);x(t);const a=(e=>{if(!e)return;const t=[];for(const r of e)if("number"===typeof r)t.push(r);else if("object"===typeof r)if(r.calc&&"stringify"!==r.calc){const e=new Function("dataTable","rowNum",r.calc);t.push({...r,calc:e})}else t.push(r);return t})(r.columns||r.subcharts&&r.subcharts[o].columns||null),n=new m.visualization.ChartWrapper({chartType:r.chartType,dataTable:he?void 0:t,options:ne,view:{columns:a},containerId:te});let i;if(y(n),he){const e=new m.visualization.Dashboard(document.getElementById("dashboard-".concat(te)));D(e),m.visualization.events.addListener(e,"ready",fe),i=new m.visualization.ControlWrapper({controlType:me.controlType,options:pe,containerId:"control-".concat(te)}),j(i),e.bind(i,n),e.draw(t)}else m.visualization.events.addListener(n,"ready",fe),n.draw();if(ge){const{initAllInitialColumns:e,initDataColumns:r}=(e=>{let{chartWrapper:t,dataTable:r,seriesSelector:a}=e;var o=t.getView();if(null==o.columns){const e=new m.visualization.DataView(r);t.setView({columns:e.columns}),o=t.getView()}let n=!0,i=0;const l=o.columns.map(((e,t)=>("number"===typeof e&&(e={role:n?"domain":"data",sourceColumn:e}),e.label=r.getColumnLabel(e.sourceColumn),e.indexInAllInitialColumns=t,n=n&&!1,"data"===e.role&&(a.defaultSeriesToDisplayInitially?a.defaultSeriesToDisplayInitially.includes(t)?e.selected=!0:e.selected=!1:a.allowMultiple?e.selected=!0:e.selected=0===i,e.seriesIndex=i,i++),e)));V(l);const s=be({dataTable:r,allInitialColumns:l});ee(s);const d=l.filter((e=>{var t,r;return"data"===e.role&&!1!==(null===(t=ne.series)||void 0===t||null===(r=t[e.seriesIndex])||void 0===r?void 0:r.visibleInLegend)}));return"setViewColumn"===a.method&&ve({dataColumns:d}),Q(d),{initAllInitialColumns:l,initDataColumns:d}})({chartWrapper:n,dataTable:t,seriesSelector:ge});ye({_allInitialColumns:e,newDataColumns:r,_chartWrapper:n,_controlWrapper:i})}B(!0)}}),[m,r]);const fe=()=>{I&&R(!1)};return P?(0,T.jsxs)(U,{isPortrait:l,className:h,position:"relative",height:"100%",minHeight:"Calendar"===r.chartType&&"200px",children:[I&&(0,T.jsx)(n.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,T.jsx)(Y.Z,{})}),I?null:(0,T.jsxs)(f.ZP,{container:!0,mt:1,sx:{gap:2,[k.breakpoints.down("sm")]:{gap:1}},children:[ge&&(0,T.jsx)(f.ZP,{item:!0,sx:{[k.breakpoints.down("sm")]:{width:"100%"}},children:(0,T.jsx)(E,{items:_,allowMultiple:ge.allowMultiple,seriesLabel:ge.seriesLabel,selectorID:"".concat(r.title,"-selector"),onSeriesSelection:ye,displayChip:!1})}),xe&&(0,T.jsx)(f.ZP,{item:!0,sx:{height:"2rem",width:{[k.breakpoints.down("sm")]:{width:"100%"}}},children:(0,T.jsx)(we,{minDateOfDataset:new Date(xe.minDate)})})]}),(()=>{var e;return he?(0,T.jsxs)(d.Z,{id:"dashboard-".concat(te),direction:(null===(e=z[me.controlType])||void 0===e?void 0:e.stackDirection)||"column-reverse",sx:{height:"100%"},children:[(0,T.jsx)(n.Z,{id:"control-".concat(te),sx:{height:"calc(".concat(c," / 8)"),opacity:.8,filter:"saturate(0.3)"}}),(0,T.jsx)(n.Z,{id:te,sx:{height:c,maxHeight:u}})]}):(0,T.jsx)(n.Z,{id:te,sx:{height:c,maxHeight:u}})})()]}):(0,T.jsx)(Se,{dataType:p})}var Ze=r(53767);const je=function(e){let{text:t,wordLimit:r=40,reference:o}=e;const[i,l]=(0,a.useState)(!1),d=(0,w.Z)(),c=(0,s.Z)(d.breakpoints.down("sm")),u=(0,a.useRef)(null),h=t.split(" ");if(!c||h.length/r<=1.4)return(0,T.jsxs)(n.Z,{children:[(0,T.jsx)(p.Z,{children:(0,Q.ZP)(t,{replace:G.T1})}),o&&(0,T.jsx)(p.Z,{variant:"caption",color:"text.secondary",children:(0,Q.ZP)(o,{replace:G.T1})})]});let m=h.slice(0,r).join(" ");const g=m.lastIndexOf(".");return-1!==g&&(m=m.slice(0,g+1)),(0,T.jsx)(Ze.d,{onClickAway:e=>{(e=>{let{target:t}=e;const r=u.current.closest(".MuiContainer-root"),a=new Set(["rect","path","svg","circle"]);for(;null!=t;){if(a.has(t.tagName))return t.closest(".MuiContainer-root")===r;t=t.parentNode}return!1})(e)||l(!1)},children:(0,T.jsx)(n.Z,{ref:u,onClick:()=>l(!i),style:{cursor:"pointer"},children:i?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(p.Z,{children:(0,Q.ZP)(t,{replace:G.T1})}),o&&(0,T.jsx)(p.Z,{variant:"caption",color:"text.secondary",children:(0,Q.ZP)(o,{replace:G.T1})})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(p.Z,{display:"inline",children:[(0,Q.ZP)(m,{replace:G.T1}),"..."]}),(0,T.jsx)(p.Z,{display:"inline",color:"text.primary",fontWeight:"500",sx:{ml:.5,"& :hover":{textDecoration:"underline"}},children:"See more"})]})})})};var Ae=r(26759);const Ce=e=>{let{selectedDataType:t,dataTypes:r,fetchChartDataType:o}=e;const[n,i]=(0,a.useState)(null);if(!(0,G.qt)(r))return null;if(r.length<=1)return(0,T.jsx)(p.Z,{display:"inline",variant:"h6",color:"text.primary",children:r[0].name_title});const s=Boolean(n),d=()=>{i(null)};return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(oe.Z,{id:"data-type-drop-down-menu-button","aria-controls":s?"data-type-drop-down-menu":void 0,"aria-haspopup":"true","aria-expanded":s?"true":void 0,onClick:e=>{i(e.currentTarget)},variant:"text",size:"small",sx:{p:0,minWidth:"unset",borderRadius:0,verticalAlign:"top",textTransform:"capitalize"},children:[(0,T.jsx)(p.Z,{display:"inline",variant:"h6",borderBottom:"dotted",children:r.filter((e=>e.key===t)).map((e=>e.name_title))}),(0,T.jsx)(Ae.Z,{})]}),(0,T.jsx)(u.Z,{id:"data-type-drop-down-menu",anchorEl:n,open:s,onClose:d,MenuListProps:{"aria-labelledby":"data-type-drop-down-menu-button"},children:r.map(((e,t)=>(0,T.jsx)(l.Z,{sx:{fontSize:"0.8rem"},onClick:()=>(e=>{o(e),d()})(e.key),children:e.name_title},t)))})]})},ke=(0,o.ZP)(n.Z)((e=>{let{theme:t}=e;return{..."dark"===t.palette.mode&&{filter:"saturate(0.85)","& .heat-map-iframe":{filter:"invert(0.848) hue-rotate(180deg)"}},'& .historical-snapshot-aqi svg [clip-path*="ABSTRACT_RENDERER"] > g:nth-of-type(1), .historical-snapshot-aqi [id*="googlechart-control"] svg [clip-path*="ABSTRACT_RENDERER"] > g:nth-of-type(2)':{opacity:.6},"& .Calendar [dir]:not(:empty)":{margin:"auto"},"& .Calendar > div > div:last-of-type > div":{overflowX:"auto",overflowY:"hidden",scrollbarGutter:"stable"}}})),Te=(0,o.ZP)(i.Z)((e=>{let{theme:t}=e;return{"& .MuiTabScrollButton-root":{color:t.palette.text.primary},"& .MuiTab-root":{[t.breakpoints.down("sm")]:{fontSize:"0.625rem",padding:t.spacing(.5)}},"& .MuiSvgIcon-root ":{[t.breakpoints.down("sm")]:{fontSize:"0.75rem"}}}})),Ie=(0,o.ZP)(l.Z)((e=>{let{theme:t}=e;return{"& .MuiBox-root ":{[t.breakpoints.down("sm")]:{fontSize:"0.75rem"}}}}));const Re=function(e){const{chartTitle:t,generalChartSubtitle:r,generalChartReference:o,chartData:i,chartHeight:l,chartID:b,chartIndex:y,isHomepage:f}=e,{currentSchoolID:w,setIndividualChartData:S}=(0,a.useContext)(v.G),D=(0,s.Z)((e=>e.breakpoints.down("sm"))),[Z,j]=(0,a.useState)(window.matchMedia("(orientation: portrait)").matches),[A,C]=(0,a.useState)([window.innerWidth,window.innerHeight]);let I,R=l;const P=i,[E,z]=(0,a.useState)(0),[M,W]=(0,a.useState)(0),[O,B]=(0,a.useState)(-1),[L,H]=(0,a.useState)(),[F,N]=(0,a.useState)(null),{allowedDataTypes:V}=P,[q,U]=(0,a.useState)(null);return(0,a.useEffect)((()=>{U(P.selectedDataType)}),[P]),(0,a.useEffect)((()=>{let e=null;const t=()=>{clearTimeout(e),e=setTimeout((()=>{j(window.matchMedia("(orientation: portrait)").matches),C([window.innerWidth,window.innerHeight])}),100)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}}),[P]),(0,a.useEffect)((()=>{W(E),z(0)}),[w]),"Calendar"===P.chartType||R||(R=Z?"80vw":"35vw",I=Z?"800px":"500px"),t?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(n.Z,{children:[(0,T.jsxs)(p.Z,{display:"inline",variant:"h6",color:"text.primary",children:[y+1,". ",t,"\xa0"]}),(0,T.jsx)(n.Z,{display:"inline",children:(0,T.jsx)(Ce,{selectedDataType:q,dataTypes:V,fetchChartDataType:async e=>{const t=x.UA[b];(0,g.m)({url:(0,x.Eh)({endpoint:t,school_id:w,dataType:e}),extension:"json",needsAuthorization:!0}).then((e=>{S(b,e),U(e.selectedDataType)})).catch((e=>{console.log(e)}))}})})]}),(0,T.jsxs)(ke,{height:"100%",children:[P.subcharts?(()=>{const e=P.subcharts.length>4,t=e?P.subcharts.slice(0,3):P.subcharts,r=e?P.subcharts.slice(3):null,a=e=>-1===E?M===e:E===e;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(Te,{value:E,onChange:(t,r)=>{W(E),z(r),e&&r<3&&r!==O&&(H(),B(-1))},variant:D?"fullWidth":"standard",children:[t.map(((e,t)=>(0,T.jsx)(c.Z,{value:t,label:P.subcharts[t].subchartTitle,sx:{textDecoration:!(0,G.qt)(P.subcharts[t].dataArray)&&"line-through"}},t))),e&&(0,T.jsx)(c.Z,{value:O,label:(0,T.jsxs)(d.Z,{direction:"row",justifyContent:"center",alignItems:"center",children:[(0,T.jsxs)(n.Z,{flex:1,children:["Other sensors",L&&" (".concat(L,")"),"\xa0"]}),(0,T.jsx)(m.Z,{})]}),"aria-controls":"submenu","aria-haspopup":"true",onClick:e=>N(e.currentTarget)})]}),e&&(0,T.jsx)(u.Z,{id:"submenu",anchorEl:F,open:Boolean(F),onClose:()=>{-1===E&&(W(E),z(M)),N(null)},children:r.map(((e,t)=>(0,T.jsx)(Ie,{selected:t===E-3,onClick:()=>(e=>{W(E),z(3+e),B(3+e),H(r[e].subchartTitleShort),N(null)})(t),sx:{textDecoration:!(0,G.qt)(P.subcharts[t+3].dataArray)&&"line-through"},children:(0,T.jsxs)(d.Z,{direction:"row",alignItems:"center",gap:1,children:[(0,T.jsx)(n.Z,{children:r[t].subchartTitle}),t===E-3&&(0,T.jsx)(k.Z,{fontSize:"1rem",sx:{color:"text.secondary"}})]})},t)))}),(0,T.jsx)(n.Z,{position:"relative",sx:{overflowX:Z&&"auto",WebkitOverflowScrolling:Z&&"touch",overflowY:"hidden"},children:P.subcharts.map(((e,t)=>(0,T.jsx)(n.Z,{width:"100%",height:"100%",role:"tabpanel",sx:{transition:"0.35s",position:0===t?"":"absolute",opacity:a(t)?"1":"0",pointerEvents:a(t)?"auto":"none",top:0===t?"":0},children:(0,T.jsx)(De,{selectedDataType:q,chartData:P,subchartIndex:t,isPortrait:Z,isHomepage:f,windowSize:A,height:P.height?P.height:R,maxHeight:["Calendar"].includes(P.chartType)?"":I})},t)))})]})})():(0,T.jsx)(De,{selectedDataType:q,chartData:P,isPortrait:Z,isHomepage:f,windowSize:A,height:P.height?P.height:R}),(0,T.jsx)(n.Z,{sx:{my:3},children:(0,T.jsx)(p.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{mb:1},children:(0,T.jsx)(je,{text:(()=>{var e;let t=r||"";return P.subcharts&&null!==(e=P.subcharts[E])&&void 0!==e&&e.subchartSubtitle&&(t+="<br/>",t+=P.subcharts[E].subchartSubtitle),t})(),reference:(()=>{var e;let t=o||"";return P.subcharts&&null!==(e=P.subcharts[E])&&void 0!==e&&e.reference&&(t+="<br/>",t+=P.subcharts[E].reference),t})()})})})]})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(h.Z,{variant:"text",sx:{width:"100%",fontSize:"2rem"}}),(0,T.jsx)(h.Z,{variant:"rounded",width:"100%",height:300})]})}}}]);
//# sourceMappingURL=429.a5ed0d5f.chunk.js.map